"use strict";(function(d,h,j){var e=d(".wk-release").attr("data-userid");var c=1;var a=5;var g=1;var b=5;var m;var k;function o(){f(0);f(1)}function i(u,t){var r=[];if(u.length){for(var s=0;s<u.length;s++){var v=u[s].stock;var x=u[s].advance_or_decline;var w=v.split(",");var y=x.split(",");if(u[s].is_ymd){r.push(' <div class="date">'+u[s].is_ymd+'<div class="circle"></div></div>')}r.push('<div class="one_msg">');r.push('<div class="time fl">'+u[s].show_time+'<div class="circle"></div></div>');r.push('<div class="release_usericon fl"></div>');r.push('<div class="release_content fl">');r.push('<div class="content_user">'+u[s].user_name);if(u[s].user_id==e){if(u[s].is_end==1){r.push('<span class="release_end">已结束</span>')}else{r.push('<div class="click_end_release"><i class="glyphicon glyphicon-menu-down release_own"><div class="release_own_end" data-task-id="'+u[s].task_id+'">结束发布</div></i></div>')}}else{if(u[s].is_end==1){r.push('<span class="release_end">已结束</span>')}}r.push('</div><div class="content_main">');r.push('<div class="content_main_text">'+u[s].message+"</div>");r.push('<div class="content_support" data-support-taskid="'+u[s].task_id+'">');if(u[s].self_follow==0){r.push('<span class="support"><img src="../static/plugins/webim/imgs/icon_add_unselect.png" width="15px">&nbsp;跟 ( <span class="follow_num">'+u[s].follow_num+'</span> )</span>&nbsp;&nbsp; <span class="nosupport"><img src="../static/plugins/webim/imgs/icon_noadd_unselect.png" width="15px">&nbsp;不跟(  <span class="unfollow_num">'+u[s].not_follow_num+"</span> ) </span>&nbsp;")}else{if(u[s].self_follow==1){r.push('<span class="follow_select"><img src="../static/plugins/webim/imgs/icon_add_select.png" width="15px">&nbsp;跟 ( '+u[s].follow_num+' )</span>&nbsp;&nbsp; <span class="nosupport"><img src="../static/plugins/webim/imgs/icon_noadd_unselect.png" width="15px">&nbsp;不跟(  <span class="unfollow_num">'+u[s].not_follow_num+"</span> ) </span>&nbsp;")}else{if(u[s].self_follow==2){r.push('<span class="support"><img src="../static/plugins/webim/imgs/icon_add_unselect.png" width="15px">&nbsp;跟 (  <span class="follow_num">'+u[s].follow_num+'</span> )</span>&nbsp;&nbsp; <span class="follow_select"><img src="../static/plugins/webim/imgs/icon_noadd_select.png" width="15px">&nbsp;不跟( '+u[s].not_follow_num+" ) </span>&nbsp;")}}}r.push("</div></div>");r.push('<div class="content_bottom"><span class="stock">股票：</span><span class="stock_name">');for(var q=0;q<w.length;q++){r.push('<span class="'+Utility.getPriceColor(parseInt(y[q]))+'">'+w[q]+"</span>&nbsp;&nbsp;")}r.push("</span></div>");r.push('</div><div class="clear"></div></div></div>')}}d("#"+t+" .get_release_content").append(r.join(""));l()}function f(q){if(q==0){webim.getReleaseInfo({query_type:"alltask"},function(){d(".all_load").html("<div class=\"wk-user-no\"><i class='fa fa-refresh fa-spin'></i>&nbsp;正在加载...</div>")},function(r){console.log(r);d(".all_load").html("").removeClass("all_load");d("#release_all_info .reload_more").show();if(r.status==1&&r.result.length){k=p(r.result);var s=n(c,a,k);i(s,"release_all_info")}else{d("#release_all_info").html("<img src='../../static/imgs/i/index_nodata.png'>&nbsp;&nbsp;暂无数据").css({"margin-top":"90px","text-align":"center"})}})}if(q>0){webim.getReleaseInfo({query_type:"mytask"},function(){d(".own_load").html("<div class=\"wk-user-no\"><i class='fa fa-refresh fa-spin'></i>&nbsp;正在加载...</div>")},function(s){d(".own_load").html("").removeClass("own_load");d("#release_own_info .reload_more").show();if(s.status==1&&s.result.length){m=p(s.result);var r=n(g,b,m);i(r,"release_own_info")}else{d("#release_own_info").html("<img src='../../static/imgs/i/index_nodata.png'>&nbsp;&nbsp;暂无数据").css({"margin-top":"90px","text-align":"center"})}})}}function n(v,s,q){var w=(v-1)*s;var r=[];if(q&&q.length<=w){return r}if(q&&q.length>w){if(q.length-w<s){s=q.length-w}var t=0;for(var u=w;u<w+s;u++){r[t]=q[u];t++}}return r}function p(q){var s=[];for(var u=0;u<q.length;u++){var r=Utility.getYmd(q[u]["time"]);var t=Utility.getHis(q[u]["time"]);if(!Utility.in_array(r,s)){s.push(r);q[u]["show_time"]=t;q[u]["is_ymd"]=r}else{q[u]["show_time"]=t;q[u]["is_ymd"]=0}}return q}d(".release_info").click(function(){var q=d(".release_frame textarea").val();if(q){webim.setReleaseInfo({message:q},function(){d(".release_ing").html('<i class="fa fa-refresh fa-spin"></i>&nbsp;发送中...&nbsp;&nbsp;');d(".release_info").attr("disabled",true)},function(r){d(".release_ing").html("");d(".release_info").attr("disabled",false);if(r.status==1){swal({title:"发送成功",type:"success",timer:1000,showConfirmButton:false},function(){h.location.reload()})}else{swal("发送失败","","error")}})}else{swal("发送内容不要为空","","warning")}});d("#release_all_info .reload_more").click(function(){c++;var q=n(c,a,k);if(q.length<=0){d("#release_all_info .reload_more").hide()}i(q,"release_all_info")});d("#release_own_info .reload_more").click(function(){g++;var q=n(g,b,m);if(q.length<=0){d("#release_own_info .reload_more").hide()}i(q,"release_own_info")});d(h).scroll(function(){var u=d(this);var t=u.scrollTop();var s=d(j).height();var v=u.height();var q=s-t-v;var r=d(".nav-tabs").find(".active").attr("data-type");r=parseInt(r);if(q===0){if(r==0){d("#release_all_info .reload_more").click()}if(r==1){d("#release_own_info .reload_more").click()}}});function l(){d(".release_own_end").on("click",function(){var q=d(this).attr("data-task-id");d(this).parent().parent(".click_end_release").html('<span class="release_end">已结束</span>')});d(".release_own").click(function(){d(this).find(".release_own_end").show()});d(".release_own").mouseleave(function(){d(this).find(".release_own_end").hide()});d(".support").click(function(){var s=d(this);var q=s.parent().attr("data-support-taskid");if(!s.siblings().hasClass("follow_select")){var r=parseInt(s.find(".follow_num").html())+1;s.addClass("follow_select").find("img").attr("src","../static/plugins/webim/imgs/icon_add_select.png");s.find(".follow_num").html(r).removeClass("follow_num")}});d(".nosupport").click(function(){var s=d(this);var q=s.parent().attr("data-support-taskid");if(!s.siblings().hasClass("follow_select")){var r=parseInt(s.find(".unfollow_num").html())+1;s.addClass("follow_select").find("img").attr("src","../static/plugins/webim/imgs/icon_noadd_select.png");s.find(".unfollow_num").html(r).removeClass("unfollow_num")}webim.follow({follow:2})})}o()})(jQuery,window,document);