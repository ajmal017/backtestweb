"use strict";$(function(){var c;var h=0;var d="http://"+window.location.host+"/";$(".wk-trade-search").typeahead({minLength:2,maxItem:20,order:"asc",hint:true,group:true,maxItemPerGroup:5,backdrop:false,dynamic:true,filter:false,emptyTemplate:'未找到 "{{query}}" 的相关信息',source:{"股票":{url:[d+"ajax/trade/ajax_search.php?message={{query}},&type=1","stock"]}},callback:{onClickAfter:function(){var j=$(".wk-trade-search").val();var i=j.substring(j.indexOf("(")+1,j.indexOf(")"));f(i);a("#buy",i);$("#buy .buy-wrong").hide().attr("data-wrong-type",-1)}}});$(".trade-reset").click(function(){var i=$(this);i.parent().find(".trade-info li input").val("");i.parent().find(".trade-info li .num-scale  input").prop("checked",false);i.parent().find(".trade-info li>span").html("");i.parent().find(".trade-info li .buy-wrong").hide().attr("data-wrong-type",-1);i.parent().find(".trade-info li .buy-price,.trade-info li .buy-num").attr("readonly","readonly");i.parent().find(".trade-info li .num-scale input").attr("disabled",true);i.parent().find(".trade-info .user-group option").eq(0).prop("selected",true);i.parent().find(".trade-info li .sale-stock").html("").append('<option value="-1">请选择</option>')});$(".buy-price,.buy-num").change(function(){var k=$(this).parent().parent();var l=parseFloat(k.find("li .now-num").html());var i=parseFloat(k.find("li .buy-price").val());var j=parseInt(k.find("li .buy-num").val());if(i){var m=i.toString().split(".")[1];if(i==0||i<c-c*0.1||i>c+c*0.1){$(this).parent().find(".buy-wrong").show().attr("data-wrong-type",1)}else{if(m&&m.length>2){$(this).parent().find(".buy-wrong").show().attr("data-wrong-type",1)}else{$(this).parent().find(".buy-wrong").hide().attr("data-wrong-type",-1)}}}else{$(this).parent().find(".buy-wrong").show().attr("data-wrong-type",1)}if(j&&l){if(j==0||j>l||j%100!=0){k.find(".num .buy-wrong").show().attr("data-wrong-type",1)}else{k.find(".num .buy-wrong").hide().attr("data-wrong-type",-1)}}else{k.find(".num .buy-wrong").show().attr("data-wrong-type",1)}k.find(".buy-total").html((i.toFixed(2))*j)});$(".num-scale input").click(function(){var i=$(this).parent().parent().parent();var k=parseFloat($(this).attr("data-scale"));var j=parseFloat(i.find("li .now-num").html());i.find("li .buy-num").val(j*k);$(this).parent().parent().find(".buy-num").trigger("change")});function a(i,j){trade.getStockInfo({code:j},null,function(o){if(o.status==1){var q=o.real_info.now_price;var n=o.buy;var p=o.sell;var k=o.real_info;var m=$(i+" .buy-num").val();c=k.open_price;for(var l=0;l<5;l++){$(i+" .table2 tr").eq(l).find("td").eq(1).html(p[l].price.toFixed(2)).addClass(Utility.getPriceColor(p[l].price-q));$(i+" .table2 tr").eq(l).find("td").eq(2).html(parseInt(p[l].vol));$(i+" .table2 tr").eq(6+l).find("td").eq(1).html(n[l].price.toFixed(2)).addClass(Utility.getPriceColor(n[l].price-q));$(i+" .table2 tr").eq(6+l).find("td").eq(2).html(parseInt(n[l].vol))}$(i+" .table2 tr").eq(5).find("td").eq(1).html(q.toFixed(2)).addClass(Utility.getPriceColor(q-k.yesterday_close_price));$(i+" .table1 tr").eq(0).find("td span").html(k.now_price.toFixed(2)).addClass(Utility.getPriceColor(k.now_price-q));$(i+" .table1 tr").eq(1).find("td span").html(k.open_price.toFixed(2)).addClass(Utility.getPriceColor(k.open_price-q));$(i+" .table1 tr").eq(2).find("td span").html(k.yesterday_close_price.toFixed(2));$(i+" .table1 tr").eq(3).find("td span").html(k.high_price.toFixed(2)).addClass(Utility.getPriceColor(k.high_price-q));$(i+" .table1 tr").eq(4).find("td span").html(k.low_price.toFixed(2)).addClass(Utility.getPriceColor(k.low_price-q));$(i+" .table1 tr").eq(5).find("td span").html(k.limit_up.toFixed(2)).addClass(Utility.getPriceColor(k.limit_up-q));$(i+" .table1 tr").eq(6).find("td span").html(k.limit_down.toFixed(2)).addClass(Utility.getPriceColor(k.limit_down-q));$(i+" .table1 tr").eq(7).find("td span").html(k.turnover_rate.toFixed(2)+"%");$(i+" .table1 tr").eq(8).find("td span").html(parseInt(k.vol));$(i+" .now-price").html(k.now_price.toFixed(2));$(i+" .buy-price").val(k.now_price.toFixed(2));$(i+" .buy-total").html(k.now_price.toFixed(2)*m);$(i+" .right-infos").show();$(i+" .buy-price").removeAttr("readonly")}})}function g(){trade.getUserRelatedOp({opcode:104},null,function(l){if(l.status==0){var j=[];var m=l.group_list;j.push('<option value="-1">请选择</option>');for(var k=0;k<m.length;k++){j.push('<option value ="'+m[k].id+'">'+m[k].name+"</option>")}$(".user-group").html(j.join(""))}})}$(".sale-stock-group").change(function(){var j=$(this).find("option:selected").val();if(j!=="-1"){var i=[];trade.getUserRelatedOp({gid:j,opcode:112},null,function(l){if(l.status==0){var m=l.stock_list;i.push('<option value="-1">请选择</option>');for(var k=0;k<m.length;k++){i.push('<option value ="'+m[k].code+'" data-name="'+m[k].name+'" data-num="'+m[k].holding+'">'+m[k].name+"("+m[k].code+")</option>")}$("#sale .sale-stock").html(i.join(""))}})}else{var i=[];i.push('<option value="-1">请选择</option>');$("#sale .sale-stock").html(i.join(""))}});$(".sale-stock").change(function(){var m=$(this).find("option:selected");var l=m.val();var j=m.attr("data-name");var k=m.attr("data-price");var i=m.attr("data-num");if(l!=="0"){$("#sale .buy-num").removeAttr("readonly");$("#sale .num-scale input").eq(0).prop("checked",true);$("#sale .trade-info li .num-scale input").removeAttr("disabled");$("#sale .stock-name").html(j);$("#sale .stock-code").html(l+",");$("#sale .now-num").html(i);$("#sale .buy-num").val(i);a("#sale",l)}$("#sale .buy-wrong").hide().attr("data-wrong-type",-1)});$(".trade-btn").click(function(){var j=$(this).attr("data-type");var l=$(this).parent().find(".trade-info .user-group option:selected").val();var o=$(this).parent().find(".stock-code").html();var i=Number($(this).parent().find("li .buy-price").val()).toFixed(2);var p=Number($(this).parent().find(".stop-price input").val()).toFixed(2);var k=$(this).parent().find("li .buy-num").val();var n=$(this).parent().find(".price .buy-wrong").attr("data-wrong-type");var m=$(this).parent().find(".num .buy-wrong").attr("data-wrong-type");if(i*k==0){swal({title:"买入金额为0，不可买入",type:"warning",timer:1200,showConfirmButton:false});return false}if(!i||!k){swal({title:"输入信息不完整，请补全信息",type:"warning",timer:1200,showConfirmButton:false});return false}if(n=="-1"&&m=="-1"){trade.getUserRelatedOp({opcode:111,gid:l,code:o,order_price:i,expected_price:p,order_nums:k,order_operation:j},null,function(q){if(q.status==0){swal({title:"下单成功！",type:"success",timer:1200,showConfirmButton:false});b()}else{swal({title:"下单失败！",type:"error",timer:1200,showConfirmButton:false})}})}else{swal({title:"输入信息有误，请重新输入",type:"warning",timer:1200,showConfirmButton:false})}});$("body").on("click",".call-back",function(){var i=$(this).attr("data-order-id");trade.getUserRelatedOp({opcode:114,order_id:i},null,function(j){if(j.status==0){swal({title:"撤单成功！",type:"success",timer:1200,showConfirmButton:false});b()}else{swal({title:"撤单失败！",type:"error",timer:1200,showConfirmButton:false})}})});function b(){trade.getUserRelatedOp({opcode:107},function(){if(h==0){$(".day_orders table tbody").html("<tr><td colspan='8'><i class='fa fa-refresh fa-spin'></i>&nbsp;正在加载...</td></tr>")}},function(k){if(k.status==0){var m=[];var l=k.order_list;if(l.length!==0){for(var j=0;j<l.length;j++){m.push("<tr>");m.push("<td>"+(j+1)+"</td>");m.push('<td><a href="http://stock.iwookong.com/ajax/login/nologin.php?stock='+l[j].code+"&uid="+uid+'&token=token" target="_blank">'+l[j].name+"("+l[j].code+")</a></td>");if(l[j].order_operation){m.push("<td>卖出</td>")}else{m.push("<td>买入</td>")}m.push("<td>"+l[j].order_price+"</td>");m.push("<td>"+l[j].order_nums+"</td>");m.push("<td>"+Utility.unixToDate4(l[j].order_time*1000)+"</td>");if(l[j].status){m.push("<td>已成交</td>")}else{m.push("<td>未成交</td>")}m.push('<td class="call-back" data-order-id="'+l[j].id+'">撤销</td>');m.push("</tr>")}}else{m.push('<tr><td colspan="8">暂无数据</td></tr>')}$(".day_orders table tbody").html(m.join(""));h++}})}function f(i){trade.getUserRelatedOp({code:i,opcode:113},null,function(j){if(j.status==0){$("#buy .stock-name").html(j.name);$("#buy .stock-code").html(j.code);$("#buy .now-num").html(j.count);$("#buy .buy-num").val(j.count);$("#buy .right-infos").show();$("#buy .trade-info li .num-scale input").attr("disabled",false);$("#buy .num-scale input").eq(0).prop("checked",true);$("#buy .num-scale input").removeAttr("readonly")}})}function e(){g();b()}e()});