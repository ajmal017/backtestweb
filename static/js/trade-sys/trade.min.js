"use strict";$(function(){var c;$(function(){var f="http://"+window.location.host+"/";$(".wk-head-search2").typeahead({minLength:2,maxItem:20,order:"asc",hint:true,group:true,maxItemPerGroup:5,backdrop:false,dynamic:true,filter:false,emptyTemplate:'未找到 "{{query}}" 的相关信息',source:{"股票":{url:[f+"ajax/trade/ajax_search.php?message={{query}},&type=1","stock"]}},callback:{onClickAfter:function(){var h=$(".wk-head-search2").val();var g=h.substring(h.indexOf("(")+1,h.indexOf(")"));d(g);a("#buy",g);$("#buy .buy-wrong").hide().attr("data-wrong-type",-1)}}})});$(".trade-reset").click(function(){var f=$(this);f.parent().find(".trade-info li input").val("");f.parent().find(".trade-info li .num-scale  input").prop("checked",false);f.parent().find(".trade-info li>span").html("");f.parent().find(".trade-info li .buy-wrong").hide().attr("data-wrong-type",-1);f.parent().find(".trade-info li .buy-price,.trade-info li .buy-num").attr("readonly","readonly");f.parent().find(".trade-info li .num-scale input").attr("disabled",true);f.parent().find(".trade-info .sale-stock-group option").eq(0).prop("selected",true);f.parent().find(".trade-info li .sale-stock").html("").append('<option value="-1">请选择</option>')});$(".buy-price,.buy-num").change(function(){var h=$(this).parent().parent();var i=parseFloat(h.find("li .now-num").html());var f=parseFloat(h.find("li .buy-price").val());var g=parseInt(h.find("li .buy-num").val());if(f){var j=f.toString().split(".")[1];if(f==0||f<c-c*0.1||f>c+c*0.1){$(this).parent().find(".buy-wrong").show().attr("data-wrong-type",1)}else{if(j&&j.length>2){$(this).parent().find(".buy-wrong").show().attr("data-wrong-type",1)}else{$(this).parent().find(".buy-wrong").hide().attr("data-wrong-type",-1)}}}else{$(this).parent().find(".buy-wrong").show().attr("data-wrong-type",1)}if(g&&i){if(g==0||g>i||g%100!=0){h.find(".num .buy-wrong").show().attr("data-wrong-type",1)}else{h.find(".num .buy-wrong").hide().attr("data-wrong-type",-1)}}else{h.find(".num .buy-wrong").show().attr("data-wrong-type",1)}h.find(".buy-total").html((f.toFixed(2))*g)});$(".num-scale input").click(function(){var f=$(this).parent().parent().parent();var h=parseFloat($(this).attr("data-scale"));var g=parseFloat(f.find("li .now-num").html());f.find("li .buy-num").val(g*h);$(this).parent().parent().find(".buy-num").trigger("change")});$(".trade-btn").click(function(f){var i=$(this).parent().find("ul li .buy-price");var g=$(this).parent().find("ul li .buy-num");var h=$(this).parent().find("ul li .stop-price")});function a(f,g){trade.getStockInfo({code:g},null,function(m){console.log(m);if(m.status==1){var o=m.real_info.now_price;var l=m.buy;var n=m.sell;var h=m.real_info;var k=$(f+" .buy-num").val();c=h.open_price;for(var j=0;j<5;j++){$(f+" .table2 tr").eq(j).find("td").eq(1).html(n[j].price).addClass(Utility.getPriceColor(n[j].price-o));$(f+" .table2 tr").eq(j).find("td").eq(2).html(n[j].amount);$(f+" .table2 tr").eq(6+j).find("td").eq(1).html(l[j].price).addClass(Utility.getPriceColor(l[j].price-o));$(f+" .table2 tr").eq(6+j).find("td").eq(2).html(l[j].amount)}$(f+" .table2 tr").eq(5).find("td").eq(1).html(o).addClass(Utility.getPriceColor(o-h.yesterday_close_price));$(f+" .table1 tr").eq(0).find("td span").html(h.now_price).addClass(Utility.getPriceColor(h.now_price-o));$(f+" .table1 tr").eq(1).find("td span").html(h.open_price).addClass(Utility.getPriceColor(h.open_price-o));$(f+" .table1 tr").eq(2).find("td span").html(h.yesterday_close_price);$(f+" .table1 tr").eq(3).find("td span").html(h.high_price).addClass(Utility.getPriceColor(h.high_price-o));$(f+" .table1 tr").eq(4).find("td span").html(h.low_price).addClass(Utility.getPriceColor(h.low_price-o));$(f+" .table1 tr").eq(5).find("td span").html(h.limit_up).addClass(Utility.getPriceColor(h.limit_up-o));$(f+" .table1 tr").eq(6).find("td span").html(h.limit_down).addClass(Utility.getPriceColor(h.limit_down-o));$(f+" .table1 tr").eq(7).find("td span").html(h.turnover_rate+"%");$(f+" .table1 tr").eq(8).find("td span").html(h.amount);$(f+" .now-price").html(h.now_price);$(f+" .buy-price").val(h.now_price);$(f+" .buy-total").html(h.now_price*k);$(f+" .right-infos").show();$(f+" .buy-price").removeAttr("readonly")}})}function e(){trade.getUserRelatedOp({opcode:104},null,function(h){if(h.status==0){var f=[];var j=h.group_list;for(var g=0;g<j.length;g++){f.push('<option value ="'+j[g].id+'">'+j[g].name+"</option>")}$("#sale .sale-stock-group").append(f.join(""))}})}$(".sale-stock-group").change(function(){var g=$(this).find("option:selected").val();if(g!=="-1"){var f=[];trade.getUserRelatedOp({gid:g,opcode:112},null,function(j){if(j.status==0){var k=j.stock_list;f.push('<option value="-1">请选择</option>');for(var h=0;h<k.length;h++){f.push('<option value ="'+k[h].code+'" data-name="'+k[h].name+'" data-num="'+k[h].holding+'">'+k[h].name+"("+k[h].code+")</option>")}$("#sale .sale-stock").html(f.join(""))}})}else{var f=[];f.push('<option value="-1">请选择</option>');$("#sale .sale-stock").html(f.join(""))}});$(".sale-stock").change(function(){var j=$(this).find("option:selected");var i=j.val();var g=j.attr("data-name");var h=j.attr("data-price");var f=j.attr("data-num");if(i!=="0"){$("#sale .buy-num").removeAttr("readonly");$("#sale .num-scale input").eq(0).prop("checked",true);$("#sale .trade-info li .num-scale input").removeAttr("disabled");$("#sale .stock-name").html(g);$("#sale .stock-code").html(i+",");$("#sale .now-num").html(f);$("#sale .buy-num").val(f);a("#sale",i)}$("#sale .buy-wrong").hide().attr("data-wrong-type",-1)});$(".trade-btn").click(function(){var g=$(this).attr("data-type");var l=$(this).parent().find(".stock-code").html();var f=$(this).parent().find("li .buy-price").val();var m=$(this).parent().find(".stop-price input").val();var h=$(this).parent().find("li .buy-num").val();var k=$(this).parent().find(".price .buy-wrong").attr("data-wrong-type");var j=$(this).parent().find(".num .buy-wrong").attr("data-wrong-type");if(g=="0"){var i=$(this).attr("data-buy-gid")}else{var i=$("#sale .sale-stock-group option:selected").val()}if(m){if(!(m.split(".")[1])){m=m+".00"}}else{m="0.00"}if(f&&!(f.split(".")[1])){f=f+".00"}if(!f||!h){swal({title:"输入信息不完整，请补全信息",type:"warning",timer:1200,showConfirmButton:false});return false}if(k=="-1"&&j=="-1"){trade.getUserRelatedOp({opcode:111,gid:i,code:l,order_price:f,expected_price:m,order_nums:h,order_operation:g},null,function(n){if(n.status==0){swal({title:"下单成功！",type:"success",timer:1200,showConfirmButton:false});b()}else{swal({title:"下单失败！",type:"error",timer:1200,showConfirmButton:false})}})}else{swal({title:"输入信息有误，请重新输入",type:"warning",timer:1200,showConfirmButton:false})}});$("body").on("click",".call-back",function(){var f=$(this).attr("data-order-id");trade.getUserRelatedOp({opcode:114,order_id:f},null,function(g){if(g.status==0){swal({title:"撤单成功！",type:"success",timer:1200,showConfirmButton:false});b()}else{swal({title:"撤单失败！",type:"error",timer:1200,showConfirmButton:false})}})});function b(){trade.getUserRelatedOp({opcode:107},function(){$(".day_orders table tbody").append("<tr><td colspan='8'><i class='fa fa-refresh fa-spin'></i>&nbsp;正在加载...</td></tr>")},function(g){if(g.status==0){var j=[];var h=g.order_list;if(h.length!==0){for(var f=0;f<h.length;f++){j.push("<tr>");j.push("<td>"+(f+1)+"</td>");j.push('<td><a href="http://stock.iwookong.com/ajax/login/nologin.php?stock='+h[f].code+"&uid="+uid+'&token=token" target="_blank">'+h[f].name+"("+h[f].code+")</a></td>");if(h[f].order_operation){j.push("<td>卖出</td>")}else{j.push("<td>买入</td>")}j.push("<td>"+h[f].order_price+"</td>");j.push("<td>"+h[f].order_nums+"</td>");j.push("<td>"+Utility.unixToDate4(h[f].order_time)+"</td>");if(h[f].status){j.push("<td>已成交</td>")}else{j.push("<td>未成交</td>")}j.push('<td class="call-back" data-order-id="'+h[f].id+'">撤销</td>');j.push("</tr>")}}else{j.push('<tr><td colspan="8">暂无数据</td></tr>')}$(".day_orders table tbody").html(j.join(""))}})}function d(f){trade.getUserRelatedOp({code:f,opcode:113},null,function(g){if(g.status==0){$("#buy .stock-name").html(g.name);$("#buy .stock-code").html(g.code);$("#buy .now-num").html(g.count);$("#buy .buy-num").val(g.count);$("#buy .right-infos").show();$("#buy .trade-info li .num-scale input").attr("disabled",false);$("#buy .num-scale input").eq(0).prop("checked",true);$("#buy .num-scale input").removeAttr("readonly")}})}e();b()});