"use strict";$(function(){var h=0;var b="http://"+window.location.host+"/";var e;var i;var k;$(".wk-attention-search").typeahead({minLength:2,maxItem:20,order:"asc",hint:true,group:true,maxItemPerGroup:5,backdrop:false,dynamic:true,filter:false,emptyTemplate:'未找到 "{{query}}" 的相关信息',source:{"股票":{url:[b+"ajax/trade/ajax_search.php?message={{query}},&type=1","stock"]}},callback:{onClickAfter:function(){var m=$(".wk-attention-search").val();var l=m.substring(m.indexOf("(")+1,m.indexOf(")"));if(e&&l){trade.getUserRelatedOp({opcode:102,gid:e,code_list:l},null,function(n){if(n.status==0){$(".wk-attention-search").val("");g(e)}})}}}});function a(){trade.getUserRelatedOp({opcode:104},function(){$(".group-name-list").html('<li style="border:none">加载中...</li>')},function(m){if(m.status==0){var l=[];if(m.group_list.length>0){for(var n=0;n<m.group_list.length;n++){if(n==0){e=m.group_list[0].id;i=m.group_list[0].name;l.push('<li class="left gp-active" data-gid="'+m.group_list[0].id+'">'+m.group_list[0].name+"</li>")}else{l.push('<li class="left" data-gid="'+m.group_list[n].id+'">'+m.group_list[n].name+"</li>")}}l.push('<li class="left add-group trade-add-group" data-gid="-1">自定义<i class="fa fa-plus"></i></li>');l.push('<div class="clear"></div>')}else{l.push('<li style="border:none">无添加的账号</li>')}$(".group-name-list").html(l.join(""));f();g(e)}})}$("body").on("click","#attention .add-group",function(){swal({title:"添加账户",text:"账户名称不能超过6个汉字或12个字符",type:"input",html:true,showCancelButton:true,closeOnConfirm:false,confirmButtonText:"确定",cancelButtonText:"取消",animation:"slide-from-top",inputPlaceholder:"请输入账户名称"},function(l){if(l===false){return false}if(l===""){swal.showInputError("请输入账户名称");return false}if(Utility.getByteLen(l)>12){swal.showInputError("字符数超过限制");return false}trade.getUserRelatedOp({opcode:101,group_name:l},null,function(m){console.log(m);if(m.status==0){swal({title:"",text:"添加<span style='color: #F8BB86'>"+l+"</span>账户成功",html:true,timer:1000,showConfirmButton:false});a()}else{swal({title:"",text:"添加<span style='color: #F8BB86'>"+l+"</span>账户异常,"+m.msg+"",html:true,timer:1000,showConfirmButton:false})}})})});function f(){$("#attention .group-name-list li").on("click",function(){$(this).not(".add-group").addClass("gp-active").siblings().removeClass("gp-active");var m=$(this).attr("data-gid");var l=$(this).html();if(m!=-1){e=m;i=l;g(m)}})}function g(){trade.getUserRelatedOp({opcode:105,gid:e},function(){if(h==0){$(".group-stock-list table tbody").html('<tr><td colspan="9">加载中...</td></tr>')}},function(m){if(m.status==0){var l=[];var o=m.stock_list;k=m.stock_list;if(o.length>0){for(var n=0;n<o.length;n++){l.push("<tr>");l.push("<td>"+(n+1)+"</td>");l.push('<td><input type="checkbox" class="left"><span class="left">'+o[n].code+"</span></td>");l.push("<td>"+o[n].name+"</td>");l.push("<td>"+o[n].visit_heat+"</td>");l.push('<td class="'+Utility.getPriceColor(o[n].change)+'">'+o[n].price+"</td>");l.push('<td class="'+Utility.getPriceColor(o[n].change)+'">'+o[n].change.toFixed(2)+"%"+Utility.getHotUpDown(o[n].change)+"</td>");l.push("<td>"+(o[n].volume/10000).toFixed(2)+"</td>");l.push("<td>"+o[n].industry+"</td>");l.push('<td><img src="../static/imgs/trade/op_buy.png" class="one-stock-trade" data-trade-type="1" href="#trade" data-toggle="tab">&nbsp;<img src="../static/imgs/trade/op_sale.png" class="one-stock-trade" data-trade-type="2" href="#trade" data-toggle="tab"></td>');l.push('<td><i class="fa fa-minus-circle text-danger btn-del-stock" data-stock-code="'+o[n].code+'" data-stock-gid="'+e+'"></i></td>');l.push("</tr>")}}else{l.push('<tr><td colspan="9">暂无关注的股票</td></tr>')}$(".group-stock-list table tbody").html(l.join(""));d();h++}})}function c(n){if(n.length>0){var l=[];for(var m=0;m<n.length;m++){l.push("<tr>");l.push("<td>"+(m+1)+"</td>");l.push('<td><input type="checkbox" class="left"><span class="left">'+n[m].code+"</span></td>");l.push("<td>"+n[m].name+"</td>");l.push("<td>"+n[m].visit_heat+"</td>");l.push('<td class="'+Utility.getPriceColor(n[m].change)+'">'+n[m].price+"</td>");l.push('<td class="'+Utility.getPriceColor(n[m].change)+'">'+n[m].change.toFixed(2)+"%"+Utility.getHotUpDown(n[m].change)+"</td>");l.push("<td>"+n[m].volume+"</td>");l.push("<td>"+n[m].industry+"</td>");l.push('<td><img src="../static/imgs/trade/op_buy.png">&nbsp<img src="../static/imgs/trade/op_sale.png"></td>');l.push("</tr>")}$(".group-stock-list table tbody").html(l.join(""))}}function d(){$(".group-stock-list table>tbody tr").hover(function(){var l=$(this).find("td:nth-child(3)").html();$(this).find(".btn-del-stock").show().bind("click",function(){var n=$(this).attr("data-stock-code");var m=$(this).attr("data-stock-gid");swal({title:"",text:"确定删除<span style='color: #F8BB86'>"+l+"("+n+")</span>吗?此操作将无法恢复!",type:"warning",html:true,showCancelButton:true,confirmButtonColor:"#DD6B55",confirmButtonText:"确定",cancelButtonText:"取消",closeOnConfirm:false,closeOnCancel:true},function(o){if(o){trade.getUserRelatedOp({opcode:103,code_list:n,gid:m},null,function(p){if(p.status==0){swal({title:"",text:"<span style='color:#F8BB86'>"+l+"("+n+")</span>已被删除",html:true,timer:1000,showConfirmButton:false});g()}})}})})},function(){$(this).find(".btn-del-stock").hide()})}$("#attention .checkedAll").click(function(){Utility.allcheckOrNot($(this),"#attention .group-stock-list")});$("body").on("click","#attention .group-stock-list td .sort_img",function(){var n;var m=$(this).attr("data-sort-type");var l=$(this).attr("data-hot-sort");if(m=="desc"){$(this).attr({src:"/static/imgs/trade/arrow_up.png","data-sort-type":"ase"}).parent().siblings().find(".sort_img").attr("src","/static/imgs/trade/arrow_down.png");n=k.sort(Utility.asc_by(l))}else{$(this).attr({src:"/static/imgs/trade/arrow_down.png","data-sort-type":"desc"});n=k.sort(Utility.desc_by(l))}c(n)});$(".bulk-trade-btn").click(function(){var n=$(this).parent().find(".modal-trade-num input").val();var m=$(this).attr("data-trade-type");var q=0;var l=j();var p={};var o=0;$(".group-stock-list tbody input[type='checkbox']:checked").each(function(){var s=$(this).parent().find("span").html();var r=$(this).parent().parent().find("td:nth-child(5)").html();p[o]={code:s,price:r,num:n};q=q+r*n;o++});if(Object.keys(p).length!=0&&Number(n)!=0&&l){if(m==1){if(q<l){swal({title:"剩余可买资金不足！",type:"warning",timer:1200,showConfirmButton:false});return false}}}else{if(Object.keys(p).length==0){swal({title:"请选择模拟的股票",type:"warning",timer:1200,showConfirmButton:false})}else{if(Number(n)==0){swal({title:"请输入交易的数量",type:"warning",timer:1200,showConfirmButton:false});return false}else{if(!l){swal({title:"获取初始资金失败",type:"error",timer:1200,showConfirmButton:false})}}}}});$("body").on("click","#attention .one-stock-trade",function(){var l=$(this).attr("data-trade-type");var n=$(this).parent().parent().find("td:nth-child(2) span").html();var m=$("");alert(n);$("#collapseOne li:nth-child(1)").removeClass("active").find("a").attr("aria-expanded","false");$("#collapseOne li:nth-child(3)").addClass("active").find("a").attr("aria-expanded","true");if(n){if(l==1){$("#buy .wk-trade-search").val(n);$("#buy .wk-trade-search").trigger("input")}else{if(l==2){alert(i);var o=$("#sale .sale-stock-group option[text='"+i+"']").val();alert(o)}}}});function j(){trade.getUserRelatedOp({opcode:116,gid:1},null,function(l){if(l.status==0){return l.capital}})}a()});