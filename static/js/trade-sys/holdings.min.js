"use strict";$(function(){function n(){trade.getStockPoint(function(){$(".index-items").html("<div class=\"wk-user-no\"><i class='fa fa-refresh fa-spin'></i>&nbsp;正在加载...</div>")},function(p){if(p&&p.status==1){var q=template("tpl",p);$(".index-items").html(q)}})}var o;var d=0;function a(){trade.getUserRelatedOp({opcode:104},function(){if(d==0){$(".btn-groupList").html('<li style="border:none"><i class="fa fa-refresh fa-spin"></i>&nbsp;加载中...</li>')}},function(q){if(q.status==0){var p=[];if(q.group_list.length>0){var s=Utility.getCookie("last_gid");for(var r=0;r<q.group_list.length;r++){if(s){if(q.group_list[r].id==s){o=q.group_list[r].id;p.push('<li class="left gp-active" data-gid="'+q.group_list[r].id+'">')}else{p.push('<li class="left" data-gid="'+q.group_list[r].id+'">')}p.push("<span>"+q.group_list[r].name+"</span>&nbsp;");p.push('<span class="dropdown-toggle" data-toggle="dropdown"><i class="fa fa-chevron-down"></i></span>');p.push('<ul class="dropdown-menu" data-group-name="'+q.group_list[r].name+'" data-group-id="'+q.group_list[r].id+'"><li class="change-name"><a href="#"><i class="fa fa-pencil fa-fw"></i>更改名称</a></li><li class="del-group"><a href="#"><i class="fa fa-trash-o fa-fw"></i>删除组合</a></li></ul>');p.push("</li>")}else{if(r==0){o=q.group_list[0].id;p.push('<li class="left gp-active" data-gid="'+q.group_list[0].id+'">')}else{p.push('<li class="left" data-gid="'+q.group_list[r].id+'">')}p.push("<span>"+q.group_list[r].name+"</span>&nbsp;");p.push('<span class="dropdown-toggle" data-toggle="dropdown"><i class="fa fa-chevron-down"></i></span>');p.push('<ul class="dropdown-menu" data-group-name="'+q.group_list[r].name+'" data-group-id="'+q.group_list[r].id+'"><li class="change-name"><a href="#"><i class="fa fa-pencil fa-fw"></i>更改名称</a></li><li class="del-group"><a href="#"><i class="fa fa-trash-o fa-fw"></i>删除组合</a></li></ul>');p.push("</li>")}}}p.push('<li class="left add-group trade-add-group" data-gid="-1">自定义<i class="fa fa-plus"></i></li>');p.push('<div class="clear"></div>');$(".btn-groupList").html(p.join(""));if(o){j();l();f();h()}else{$(".holdingStock table tbody").html("<tr><td colspan='11' style='padding: 50px 0 40px 0;'>暂无账户相关数据</td></tr>")}d++}})}function f(){$("#holdings .change-name").on("click",function(){var p=$(this).parent().attr("data-group-id");var q=$(this).parent().attr("data-group-name");swal({title:"更改名称【"+q+"】",text:"组合名称不能超过6个汉字或12个字符",type:"input",html:true,showCancelButton:true,closeOnConfirm:false,confirmButtonText:"确定",cancelButtonText:"取消",animation:"slide-from-top",inputPlaceholder:"请输入组合名称"},function(r){$(".sa-input-error").click(function(){$(this).removeClass("show").prev().val("");$(this).parent().parent().find(".sa-error-container").removeClass("show")});if(r===false){return false}if($.trim(r)===""){swal.showInputError("请输入组合名称");return false}if($.trim(r)==q){swal.showInputError("与原组合名重复");return false}if(Utility.getByteLen(r)>12){swal.showInputError("字符数超过限制");return false}trade.getUserRelatedOp({opcode:117,group_name:r+",",gid:p},null,function(s){if(s.status==0){swal({title:"",text:"修改组合<span style='color: #F8BB86'>"+q+"</span>为<span style='color: #F8BB86'>"+r+"</span>成功",html:true,timer:1000,showConfirmButton:false});a()}else{swal({title:"",text:"修改组合<span style='color: #F8BB86'>"+q+"</span>为<span style='color: #F8BB86'>"+r+"</span>失败："+s.msg,html:true,timer:1500,showConfirmButton:false})}})})})}function h(){$("#holdings .del-group").on("click",function(){var p=$(this).parent().attr("data-group-id");var q=$(this).parent().attr("data-group-name");swal({title:"",text:"确定删除<span style='color: #F8BB86'>"+q+"</span>吗?此操作将无法恢复!",type:"warning",html:true,showCancelButton:true,confirmButtonColor:"#DD6B55",confirmButtonText:"确定",cancelButtonText:"取消",closeOnConfirm:false,closeOnCancel:true},function(r){if(r){trade.getUserRelatedOp({opcode:118,gid:p},null,function(s){if(s.status==0){swal({title:"",text:"组合<span style='color: #F8BB86'>"+q+"</span>已被删除",html:true,timer:1000,showConfirmButton:false});if(p==Utility.getCookie("last_gid")){Utility.unsetCookie("last_gid")}a();j()}else{if(s.status==26){swal({title:"持仓未平，不能删除",html:true,timer:5000,showConfirmButton:true})}}})}})})}$("body").on("click","#holdings .add-group",function(){swal({title:"添加账户",text:"账户名称不能超过6个汉字或12个字符",type:"input",html:true,showCancelButton:true,closeOnConfirm:false,confirmButtonText:"确定",cancelButtonText:"取消",animation:"slide-from-top",inputPlaceholder:"请输入账户名称"},function(p){$(".sa-input-error").click(function(){$(this).removeClass("show").prev().val("");$(this).parent().parent().find(".sa-error-container").removeClass("show")});if(p===false){return false}if($.trim(p)===""){swal.showInputError("请输入账户名称");return false}if(Utility.getByteLen(p)>12){swal.showInputError("字符数超过限制");return false}trade.getUserRelatedOp({opcode:101,group_name:p+","},null,function(q){if(q.status==0){swal({title:"",text:"添加<span style='color: #F8BB86'>"+p+"</span>账户成功",html:true,timer:1000,showConfirmButton:false});a()}else{swal({title:"",text:"添加<span style='color: #F8BB86'>"+p+"</span>账户失败,"+q.msg+"",html:true,timer:1000,showConfirmButton:false})}})})});function l(){$(".attention .btn-groupList >li").on("click",function(){$(this).not(".add-group").addClass("gp-active").siblings().removeClass("gp-active");var p=$(this).attr("data-gid");Utility.setCookie("last_gid",p);if(p!=-1){o=p;j(p)}})}$("#holdings .clickLi li").on("click",function(){var p=$(this).attr("data-type");if(p==1){e(o)}else{if(p==2){g()}else{if(p==3){i(o)}else{if(p==4){k("0-0-0",Utility.getNowFormatDate1());$(".sQuery1,.eQuery1").val("")}else{if(p==5){b("0-0-0",Utility.getNowFormatDate1());$(".sQuery2,.eQuery2").val("")}}}}}});function m(s){var u=echarts.init(document.getElementById("profit"));var q=echarts.init(document.getElementById("loss"));var r;var t;var v=0;var p=0;trade.getUserRelatedOp({opcode:115,gid:o},null,function(y){if(y.status==0){r=y.profit_num;t=y.loss_num;if(r+t==0){v="--";p="--"}else{v=(r/(r+t)*100).toFixed(2)+"%";p=(t/(r+t)*100).toFixed(2)+"%"}var x={color:["#D14A4A","#d0d0d0"],tooltip:{show:false,trigger:"item",formatter:"{a} <br/>{b}: {c} ({d}%)"},legend:{orient:"vertical",x:"left"},series:[{type:"pie",radius:["50%","70%"],avoidLabelOverlap:false,label:{normal:{show:false,position:"center"},emphasis:{show:true,textStyle:{fontSize:"30",fontWeight:"bold"}}},labelLine:{normal:{show:false}},data:[{value:r/(r+t)*100,name:""},{value:t/(r+t)*100,name:""}]}]};var w={color:["#d0d0d0","#009944"],legend:{orient:"vertical",x:"left"},series:[{name:"访问来源",type:"pie",radius:["50%","70%"],avoidLabelOverlap:false,label:{normal:{show:false,position:"center"},emphasis:{show:true,textStyle:{fontSize:"30",fontWeight:"bold"}}},labelLine:{normal:{show:false}},data:[{value:r/(r+t)*100,name:""},{value:t/(r+t)*100,name:""}]}]};u.setOption(x);q.setOption(w);$(".profit-amount p:nth-child(1)").html(v);$(".profit-amount p:nth-child(2) span").html(r);$(".loss-amount p:nth-child(1)").html(p);$(".loss-amount p:nth-child(2) span").html(t)}})}function c(){if(o){trade.getAccountInfo({opcode:131,gid:o},function(){$(".fund-data .user_account").html("<div class=\"row-no\"><i class='fa fa-refresh fa-spin'></i>&nbsp;正在加载中...</div>")},function(q){if(q.status==0){var p=[];var r=q.user_account_info;p.push('<div class="col-md-4 col-xs-6 fund-item">总资产: '+r.total_assets.toFixed(2)+"</div>");p.push('<div class="col-md-4 col-xs-6 fund-item">总收益率：'+(r.total_yields*100).toFixed(2)+"%</div>");p.push('<div class="col-md-4 col-xs-6 fund-item">总市值：'+r.stock_value.toFixed(2)+"</div>");p.push('<div class="col-md-4 col-xs-6 fund-item">可用资产：'+r.usable_assets.toFixed(2)+"</div>");p.push('<div class="col-md-4 col-xs-6 fund-item">持仓收益：'+r.holding_yields.toFixed(2)+"</div>");$(".fund-data .user_account").html(p.join(""))}})}}function j(p){m(p);c();e(p);g();i(p);k("0-0-0",Utility.getNowFormatDate1());b("0-0-0",Utility.getNowFormatDate1())}$("body").on("click",".myGroup ul li",function(){var p=$(this).attr("data-gid");j(p)});function e(p){trade.getUserRelatedOp({opcode:106,gid:o},function(){if(d==0){$(".holdingStock table tbody").html("<tr><td colspan='11' style='padding: 50px 0 40px 0;'><i class='fa fa-refresh fa-spin'></i>&nbsp;加载中...</td></tr>")}},function(s){if(s.status==0){var q=[];var t=s.stock_list;if(t.length>0){for(var r=0;r<t.length;r++){q.push("<tr>");q.push("<td>"+(r+1)+"</td>");q.push('<td><a href="http://stock.iwookong.com/ajax/login/nologin.php?stock='+t[r].code+"&uid="+uid+'&token=token" target="_blank">'+t[r].name+"(<span>"+t[r].code+"</span>)</a></td>");q.push("<td class='"+Utility.getPriceColor(t[r].profit_ratio)+"'>"+t[r].holding+"</td>");q.push("<td class='"+Utility.getPriceColor(t[r].profit_ratio)+"'>"+t[r].available+"</td>");q.push("<td class='"+Utility.getPriceColor(t[r].profit_ratio)+"'>"+t[r].cost.toFixed(3)+"</td>");q.push("<td class='"+Utility.getPriceColor(t[r].profit_ratio)+"'>"+t[r].price.toFixed(3)+"</td>");q.push("<td class='"+Utility.getPriceColor(t[r].profit_ratio)+"'>"+t[r].market_value+"</td>");q.push("<td class='"+Utility.getPriceColor(t[r].profit_ratio)+"'>"+t[r].profit.toFixed(2)+"</td>");q.push("<td class='"+Utility.getPriceColor(t[r].profit_ratio)+"'>"+t[r].profit_ratio.toFixed(2)+"%</td>");q.push("<td class='"+Utility.getPriceColor(t[r].profit_ratio)+"'>"+t[r].position.toFixed(2)+"</td>");q.push("<td>");q.push('<a href="trade.php?name='+t[r].name+"&gid="+o+"&code="+t[r].code+"&price="+t[r].price.toFixed(2)+'"><img src="../static/imgs/trade/op_buy.png" class="one-stock-trade" data-trade-type="0"></a>&nbsp;');if(t[r].available==0){q.push("&nbsp;--")}else{q.push('<a href="trade.php?gid='+o+"&code="+t[r].code+'&type=1"><img src="../static/imgs/trade/op_sale.png" class="one-stock-trade" data-trade-type="0"></a>&nbsp;')}q.push("</td>");q.push("</tr>")}}else{q.push("<tr><td colspan='11' style='padding: 50px 0 40px 0;'><i class='fa fa-exclamation-circle'></i>&nbsp;当前没有任何记录...</td></tr>")}$(".holdingStock table tbody").html(q.join(""))}})}$("body").on("click","#holdings .call-back",function(){var q=$(this).attr("data-order-id");var p=$(this).attr("data-id");swal({title:"",text:"确认要撤销这笔委托么？",type:"info",html:true,showCancelButton:true,closeOnConfirm:false,confirmButtonText:"确定",cancelButtonText:"取消",animation:"slide-from-top"},function(){trade.getUserRelatedOp({opcode:114,order_id:q,gid:p},null,function(r){if(r.status==0){swal({title:"撤单成功！",type:"success",timer:1200,showConfirmButton:false});g()}else{swal({title:"撤单失败！",type:"error",timer:1200,showConfirmButton:false})}})})});function g(){trade.getUserRelatedOp({opcode:107,gid:o},function(){$(".orderStock table tbody").html("<tr><td colspan='8' style='padding: 50px 0 40px 0;'><i class='fa fa-refresh fa-spin'></i>&nbsp;加载中...</td></tr>")},function(q){if(q.status==0){var s=[];var r=q.order_list;if(r.length>0){for(var p=0;p<r.length;p++){s.push("<tr>");s.push("<td>"+(p+1)+"</td>");s.push('<td><a href="http://stock.iwookong.com/ajax/login/nologin.php?stock='+r[p].code+"&uid="+uid+'&token=token" target="_blank">'+r[p].name+"("+r[p].code+")</a></td>");if(r[p].order_operation){s.push("<td>卖出</td>")}else{s.push("<td>买入</td>")}s.push("<td>"+r[p].order_price.toFixed(3)+"</td>");s.push("<td>"+r[p].order_nums+"</td>");s.push("<td>"+Utility.unixToDate4(r[p].order_time*1000)+"</td>");if(r[p].status==1){s.push("<td>已成交</td>");s.push("<td>--</td>")}else{if(r[p].status==0){s.push("<td>未成交</td>");s.push('<td class="call-back" data-order-id="'+r[p].id+'"  data-id="'+r[p].group_id+'">撤销</td>')}else{if(r[p].status==2){s.push("<td>已撤销</td>");s.push("<td>--</td>")}}}s.push("</tr>")}}else{s.push("<tr><td colspan='8' style='padding: 50px 0 40px 0;'><i class='fa fa-exclamation-circle'></i>&nbsp;当前没有任何记录...</td></tr>")}$(".orderStock table tbody").html(s.join(""))}})}function i(p){trade.getUserRelatedOp({opcode:108,gid:p},function(){$(".finishedOrder table tbody").html("<tr><td colspan='7' style='padding: 50px 0 40px 0;'><i class='fa fa-refresh fa-spin'></i>&nbsp;加载中...</td></tr>")},function(s){if(s.status==0){var q=[];var t=s.order_list;if(t.length>0){for(var r=t.length-1;r>=0;r--){q.push("<tr>");q.push("<td>"+(r+1)+"</td>");q.push('<td><a href="http://stock.iwookong.com/ajax/login/nologin.php?stock='+t[r].code+"&uid="+uid+'&token=token" target="_blank">'+t[r].name+"("+t[r].code+")</a></td>");if(t[r].order_operation){q.push("<td>卖出</td>")}else{q.push("<td>买入</td>")}q.push("<td>"+t[r].order_price.toFixed(3)+"</td>");q.push("<td>"+t[r].order_nums+"</td>");q.push("<td>"+t[r].amount.toFixed(2)+"</td>");q.push("<td>"+Utility.unixToDate4(t[r].order_time*1000)+"</td>");q.push("</tr>")}}else{q.push("<tr><td colspan='7' style='padding: 50px 0 40px 0;'><i class='fa fa-exclamation-circle'></i>&nbsp;当前没有任何记录...</td></tr>")}$(".finishedOrder table tbody").html(q.join(""))}})}function k(q,p){trade.getUserRelatedOp({opcode:109,start_time:q,end_time:p,gid:o},function(){$(".HistoryOrder table tbody").html("<tr><td colspan='7' style='padding: 50px 0 40px 0;'><i class='fa fa-refresh fa-spin'></i>&nbsp;加载中...</td></tr>")},function(t){if(t.status==0){var s=[];var u=t.order_list;if(u.length>0){for(var r=u.length-1;r>=0;r--){s.push("<tr>");s.push("<td>"+(r+1)+"</td>");s.push('<td><a href="http://stock.iwookong.com/ajax/login/nologin.php?stock='+u[r].code+"&uid="+uid+'&token=token" target="_blank">'+u[r].name+"("+u[r].code+")</a></td>");if(u[r].order_operation){s.push("<td>卖出</td>")}else{s.push("<td>买入</td>")}s.push("<td>"+u[r].order_price.toFixed(3)+"</td>");s.push("<td>"+u[r].order_nums+"</td>");s.push("<td>"+u[r].amount.toFixed(2)+"</td>");s.push("<td>"+Utility.unixToDate4(u[r].order_time*1000)+"</td>");s.push("</tr>")}}else{s.push("<tr><td colspan='7' style='padding: 50px 0 40px 0;'><i class='fa fa-exclamation-circle'></i>&nbsp;当前没有任何记录...</td></tr>")}$(".HistoryOrder table tbody").html(s.join(""))}})}$("body").on("click",".h-query",function(){var r=$(".sQuery1").val();var q=$(".eQuery1").val();q=q.substring(0,10);q=q.replace(/-/g,"-");var s=new Date(q).getTime();var u="86400000";var t=parseInt(s)+parseInt(u);var p=Utility.unixToDate2(t);k(r,p)});function b(q,p){trade.getUserRelatedOp({opcode:110,start_time:q,end_time:p,gid:o},function(){$(".statement table tbody").html("<tr><td colspan='10' style='padding: 50px 0 40px 0;'><i class='fa fa-refresh fa-spin'></i>&nbsp;加载中...</td></tr>")},function(s){if(s.status==0){var u=[];var t=s.statement_list;if(t.length>0){for(var r=t.length-1;r>=0;r--){u.push("<tr>");u.push('<td><a href="http://stock.iwookong.com/ajax/login/nologin.php?stock='+t[r].code+"&uid="+uid+'&token=token" target="_blank">'+t[r].name+"("+t[r].code+")</a></td>");u.push("<td>"+Utility.unixToDate4(t[r].deal_time*1000)+"</td>");if(t[r].order_operation){u.push("<td>卖出</td>");u.push("<td>"+t[r].order_price.toFixed(3)+"</td>");u.push("<td>"+t[r].order_nums+"</td>");u.push("<td>"+t[r].commission.toFixed(2)+"</td>");u.push("<td>"+t[r].stamp_duty.toFixed(2)+"</td>");u.push("<td>"+t[r].transfer_fee.toFixed(2)+"</td>");u.push("<td>"+t[r].amount+"</td>");u.push("<td>"+t[r].available_capital+"</td>");u.push("</tr>")}else{u.push("<td>买入</td>");u.push("<td>"+t[r].order_price.toFixed(3)+"</td>");u.push("<td>"+t[r].order_nums+"</td>");u.push("<td>"+t[r].commission.toFixed(2)+"</td>");u.push("<td>"+t[r].stamp_duty.toFixed(2)+"</td>");u.push("<td>"+t[r].transfer_fee.toFixed(2)+"</td>");u.push("<td>-"+t[r].amount+"</td>");u.push("<td>"+t[r].available_capital+"</td>");u.push("</tr>")}}}else{u.push("<tr><td colspan='10' style='padding: 50px 0 40px 0;'><i class='fa fa-exclamation-circle'></i>&nbsp;当前没有任何记录...</td></tr>")}$(".statement table tbody").html(u.join(""))}})}$("body").on("click",".s-query",function(){var q=$(".sQuery2").val();var p=$(".eQuery2").val();p=p.substring(0,10);p=p.replace(/-/g,"-");var r=new Date(p).getTime();var t="86400000";var s=parseInt(r)+parseInt(t);var u=Utility.unixToDate2(s);b(q,u)});n();a();m()});