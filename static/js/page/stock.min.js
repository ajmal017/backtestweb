"use strict";(function(i,q,w){var j=Utility.getQueryStringByName("stock");var s="";var a=["0:00","1:00","2:00","3:00","4:00","5:00","6:00","7:00","8:00","9:00","10:00","11:00","12:00","13:00","14:00","15:00","16:00","17:00","18:00","19:00","20:00","21:00","22:00","23:00","24：00"];var x=[],g=[],C=[];var v,F;var n=j+"s";var l={query_type:1,key:j,start_id:0,info_type_list:"",start_time:0};var o="http://"+q.location.host+"/";var t=echarts.init(w.getElementById("wk-rate-line-pic"));var h=true,f=true;var c={rate:{},hot:{}};var e=[];function B(J,I,L,K){return"<a href='hotrank.php?key="+J+","+I+","+L+","+K+"' class='wk-view-more' target='_blank'>更多&nbsp;<i class='fa fa-angle-double-right'></i></a>"}function y(){var I=echarts.init(w.getElementById("left-hot-chart"));common.getSingleRealTimeHot({stock:j,hour_data:"stock"},function(){I.showLoading({text:"加载中..."})},function(K){if(K.status===1){var J=[];var W=[];if(K.visit){var O=0;for(var U in K.visit){if(K.visit.hasOwnProperty(U)){x.push(K.visit[U]);O++}}x=JSON.parse("["+x.join(",")+"]");var R=Math.max.apply(Math,x);var P=x.indexOf(Math.max.apply(Math,x));W.push("<tr><td>查看</td><td>"+x[x.length-1]+"</td><td>"+(Utility.getNowFormatDate()+" "+(O-1)+":00")+"</td></tr>");J.push("<tr><td>查看</td><td>"+R+"</td><td>"+Utility.calTime(P)+"</td></tr>")}if(K.search){var L=0;for(var X in K.search){if(K.search.hasOwnProperty(X)){g.push(K.search[X]);L++}}g=JSON.parse("["+g.join(",")+"]");var V=Math.max.apply(Math,g);var Q=g.indexOf(Math.max.apply(Math,g));W.push("<tr><td>搜索</td><td>"+g[g.length-1]+"</td><td>"+(Utility.getNowFormatDate()+" "+(L-1)+":00")+"</td></tr>");J.push("<tr><td>搜索</td><td>"+V+"</td><td>"+Utility.calTime(Q)+"</td></tr>")}if(K.follow){var T=0;for(var N in K.follow){if(K.follow.hasOwnProperty(N)){C.push(K.follow[N]);T++}}C=JSON.parse("["+C.join(",")+"]");var M=Math.max.apply(Math,C);var S=C.indexOf(Math.max.apply(Math,C));W.push("<tr><td>关注</td><td>"+C[C.length-1]+"</td><td>"+(Utility.getNowFormatDate()+" "+(T-1)+":00")+"</td></tr>");J.push("<tr><td>关注</td><td>"+M+"</td><td>"+Utility.calTime(S)+"</td></tr>")}i(".todayhot").html(J.join(""));i(".latesthot").html(W.join(""));common.getLineChart("left-hot-chart",a,x,g,C)}})}function D(K){var N=["wk-industry-view-treemap","wk-concept-view-treemap"];for(var O in N){if(N.hasOwnProperty(O)){var R=echarts.init(w.getElementById(N[O]));R.showLoading({text:"加载中..."})}}if(K.status===1){var Q=K.stock_info.industry;var J=K.stock_info.section;var S="";var I="";if(Q.length>0){i(".hy-title").html(Q[0].indus+"行业热度情况");for(var O in Q){if(Q.hasOwnProperty(O)){S+="<a href='industry.php?name="+Q[O].indus+"' target='_blank'>"+Q[O].indus+"</a>"}}}if(J.length>0){i(".gn-title").html(J[0].sect+"概念热度情况");for(var M in J){if(J.hasOwnProperty(M)){I+="<a href='concept.php?name="+J[M].sect+"' target='_blank'>"+J[M].sect+"</a>"}}}if(i("#industry-view").find(".col-md-5 .wk-hot-sub-title a").length<=0){i("#industry-view").find(".col-md-5 .wk-hot-sub-title").append(B(1,2,2,Q[0].indus))}if(i("#industry-search").find(".col-md-5 .wk-hot-sub-title a").length<=0){i("#industry-search").find(".col-md-5 .wk-hot-sub-title").append(B(2,2,2,Q[0].indus))}if(i("#industry-follow").find(".col-md-5 .wk-hot-sub-title a").length<=0){i("#industry-follow").find(".col-md-5 .wk-hot-sub-title").append(B(3,2,2,Q[0].indus))}if(i("#concept-view").find(".col-md-5 .wk-hot-sub-title a").length<=0){i("#concept-view").find(".col-md-5 .wk-hot-sub-title").append(B(1,3,2,J[0].sect))}if(i("#concept-search").find(".col-md-5 .wk-hot-sub-title a").length<=0){i("#concept-search").find(".col-md-5 .wk-hot-sub-title").append(B(2,3,2,J[0].sect))}if(i("#concept-follow").find(".col-md-5 .wk-hot-sub-title a").length<=0){i("#concept-follow").find(".col-md-5 .wk-hot-sub-title").append(B(3,3,2,J[0].sect))}s=K.stock_info.stock_name;i(".wk-rate-select").attr("data-stock-name",s);i(".wk-toshow-name").html(s+"("+j+")");Utility.getSinaStockData(j,function(T){var U=Utility.getStockStatus(T);i(".wk-topshow-price").html("¥"+U.price).addClass(Utility.getUpDownColor(U.updown));i(".wk-topshow-price-per").html(Utility.getPriceSymbol(U.updown)+U.updown.toFixed(2)+"("+Utility.getPriceSymbol(U.updown)+U.percent.toFixed(2)+"%)").addClass(Utility.getUpDownColor(U.percent));i(".wk-com-info li a").click(function(){var V=i(this).attr("href");if(V.indexOf("data")<0){i(this).attr("target","_blank").attr("href",V+"?data="+s+","+j)}})});i(".wk-topshow-dp label").html(Utility.getTradeTime()).addClass("wk-up");i("title").html(K.stock_info.stock_name+"("+K.stock_info.stock_code+")热度情况");i(".wk-related-info").html('热度总览&nbsp;<i class="fa fa-question-circle-o" data-toggle="popover" data-content="'+K.stock_info.stock_name+'每小时产生的热度量"></i><span>行业：'+S+"</span><span>概念："+I+"");i("#wk-top-hots .latesthot-title").html(K.stock_info.stock_name+"最近热度");i("#wk-top-hots .todayhot-title").html(K.stock_info.stock_name+"今日最热度");i("#wk-top-stockdata .latesthot-title").html(K.stock_info.stock_name+"最新行情");i("#wk-top-moneyflow .latesthot-title").html(K.stock_info.stock_name+"资金流向");i("i[data-toggle='popover']").popover({container:"body",trigger:"hover"});var L=J[0].sect;var P=Q[0].indus;if(!F){common.getTopTwentyStock({hottype:"gn",hotval:L},function(){i("#concept-view .wk-hot-table tbody").html("<tr><td colspan='5'>加载中...</td></tr>")},function(T){if(T.status===1){G(T);F=T}})}else{G(F)}if(!v){common.getTopTwentyStock({hottype:"hy",hotval:P},function(){i("#industry-view .wk-hot-table tbody").html("<tr><td colspan='5'>加载中...</td></tr>")},function(T){if(T.status===1){m(T);v=T}})}else{m(v)}A();E();z()}}function m(K){var O;if(K.result.code_info.shv_.length>0){var J=K.result.code_info.shv_;var M=K.result.code_info.suv_;i("#industry-view .wk-hot-table tbody").html(common.buildHotmapTable(J,"stock"));O=Utility.buildMapTable(M);i("#industry-view .right .toggle-treemap-table-up tbody").html(common.buildStockTable(O._up));i("#industry-view .right .toggle-treemap-table-down tbody").html(common.buildStockTable(O._down));common.buildHotmap("wk-industry-view-treemap",O._map,"stock")}if(K.result.code_info.shs_.length>0){var L=K.result.code_info.shs_;var P=K.result.code_info.sus_;i("#industry-search .wk-hot-table tbody").html(common.buildHotmapTable(L,"stock"));O=Utility.buildMapTable(P);i("#industry-search .right .toggle-treemap-table-up tbody").html(common.buildStockTable(O._up));i("#industry-search .right .toggle-treemap-table-down tbody").html(common.buildStockTable(O._down));common.buildHotmap("wk-industry-search-treemap",O._map,"stock")}if(K.result.code_info.shf_.length>0){var N=K.result.code_info.shf_;var I=K.result.code_info.suf_;i("#industry-follow .wk-hot-table tbody").html(common.buildHotmapTable(N,"stock"));O=Utility.buildMapTable(I);i("#industry-follow .right .toggle-treemap-table-up tbody").html(common.buildStockTable(O._up));i("#industry-follow .right .toggle-treemap-table-down tbody").html(common.buildStockTable(O._down));common.buildHotmap("wk-industry-follow-treemap",O._map,"stock")}}function G(K){var O;if(K.result.code_info.shv_.length>0){var J=K.result.code_info.shv_;var M=K.result.code_info.suv_;i("#concept-view .wk-hot-table tbody").html(common.buildHotmapTable(J,"stock"));O=Utility.buildMapTable(M);i("#concept-view .right .toggle-treemap-table-up tbody").html(common.buildStockTable(O._up));i("#concept-view .right .toggle-treemap-table-down tbody").html(common.buildStockTable(O._down));common.buildHotmap("wk-concept-view-treemap",O._map,"stock")}if(K.result.code_info.shs_.length>0){var L=K.result.code_info.shs_;var P=K.result.code_info.sus_;i("#concept-search .wk-hot-table tbody").html(common.buildHotmapTable(L,"stock"));O=Utility.buildMapTable(P);i("#concept-search .right .toggle-treemap-table-up tbody").html(common.buildStockTable(O._up));i("#concept-search .right .toggle-treemap-table-down tbody").html(common.buildStockTable(O._down));common.buildHotmap("wk-concept-search-treemap",O._map,"stock")}if(K.result.code_info.shf_.length>0){var N=K.result.code_info.shf_;var I=K.result.code_info.suf_;i("#concept-follow .wk-hot-table tbody").html(common.buildHotmapTable(N,"stock"));O=Utility.buildMapTable(I);i("#concept-follow .right .toggle-treemap-table-up tbody").html(common.buildStockTable(O._up));i("#concept-follow .right .toggle-treemap-table-down tbody").html(common.buildStockTable(O._down));common.buildHotmap("wk-concept-follow-treemap",O._map,"stock")}}function A(){var J=echarts.init(w.getElementById("wk-rate-line-pic"));var I={query_type:"stock",query_key:j,query_date:"today"};common.getRateLine(I,function(){J.showLoading({text:"加载中..."})},function(K){common.buildRateLine(s,"today",K);J.hideLoading()})}function E(){inforcenter.showGroup(null,function(I){if(I&&I.status===1){var K=[];K.push("<div class=\"btn-group\" style='float: right;'>");if(i(".wk-topshow-right .btn-group").length<=0){K.push('<button type="button" class="btn dropdown-toggle wk-btn-follow" data-toggle="dropdown" aria-haspopup="true" aria-expanded="false">');K.push("+ 关注");K.push("</button>");K.push('<ul class="dropdown-menu">');K.push("<li class='wk-follow-stock' data-follow-name='我的自选股'><a href=\"#\">我的自选股</a></li>");if(I.result.info.group_name.length>0){var L=I.result.info.group_name;for(var J=0;J<L.length;J++){K.push("<li class='wk-follow-stock' data-follow-name='"+L[J]+'\'><a href="#">'+L[J]+"</a></li>")}K.push('<li class="wk-follow-stock" id=\'addNewGroup\' data-follow-name="addNewGroup"><a href="javascript:">添加组合</a></li>')}i(".wk-topshow-right").append(K.join(""));K.push("</ul>");K.push("</div>")}r()}})}function r(){i(".wk-follow-stock").each(function(){var I=i(this).attr("data-follow-name");i(this).unbind("click").bind("click",function(){if(I==="addNewGroup"){swal({title:"添加组合",text:"组合名称不能超过6个汉字或12个字符",type:"input",html:true,showCancelButton:true,closeOnConfirm:false,confirmButtonText:"确定",cancelButtonText:"取消",animation:"slide-from-top",inputPlaceholder:"请输入组合名称"},function(J){if(J===false){return false}if(J===""){swal.showInputError("请输入组合名称");return false}if(Utility.getByteLen(J)>12){swal.showInputError("字符数超过限制");return false}inforcenter.addGroup({ori_name:J},null,function(K){if(K.status==1){swal({title:"",text:"添加<span style='color: #F8BB86'>"+J+"</span>组合成功",html:true,timer:1000,showConfirmButton:false});i("#addNewGroup").before("<li class='wk-follow-stock' data-follow-name='"+J+'\'><a href="#">'+J+"</a></li>");H(J,j,false);r()}else{if(K.status==0){swal({title:"",text:"添加<span style='color: #F8BB86'>"+J+"</span>组合异常,"+K.msg+"",html:true,timer:1000,showConfirmButton:false})}}})})}else{H(I,j,true)}})})}function H(K,J,I){inforcenter.addStock({ori_name:K,code:J},null,function(L){if(L.status===1){if(I){swal({title:"",text:"关注个股<span style='color: #F8BB86'>"+J+"</span>成功",html:true,timer:1000,showConfirmButton:false})}}else{if(L.status===0){swal({title:"",text:"关注个股<span style='color: #F8BB86'>"+J+"</span>异常,"+L.msg+"",html:true,timer:1000,showConfirmButton:false})}else{swal({title:"",text:"关注个股<span style='color: #F8BB86'>"+J+"</span>异常,未知原因",html:true,timer:1000,showConfirmButton:false})}}})}function z(){common.initRelateSHG(1,j,function(J){if(J&&J.status===1){var K=[];if(J.industry&&J.industry.length>0){K.push('{ "industry": "'+J.industry[0].industry+'", "concept": "'+J.notion[0].section+'" }')}var I=s+"("+j+")";common.buildReleatedInfoChart(I,J)}})}function d(){i(".modal-chart").modal("show");var I=echarts.init(w.getElementById("modal-chart"));common.getSingleRealTimeHot({stock:j,minute_data:"minute_data"},function(){I.showLoading({text:"加载中..."})},function(M){I.hideLoading();var L=[];var N=[];if(M.status===1){if(M.visit){for(var K in M.visit){if(M.visit.hasOwnProperty(K)){L.push(M.visit[K]);N.push('"'+Utility.numToTime(K)+'"')}}N=JSON.parse("["+N.join(",")+"]");L=JSON.parse("["+L.join(",")+"]")}var J=echarts.init(w.getElementById("modal-chart"));J.showLoading({text:"加载中..."});J.setOption({color:["rgb(243, 104, 97)"],tooltip:{trigger:"axis",formatter:function(Q){var O="";O+=Q[0].name+"<br>";for(var P in Q){if(Q.hasOwnProperty(P)){if(Q[P].value&&Q[P].value!==0){if(Q[0].name===Q[P].name){O+="<label style='color: "+Q[P].color+";font-size: 14x;'>●</label>&nbsp;&nbsp;"+Q[P].seriesName+":"+Utility.formatNum(Q[P].value)+"<br>"}}}}return O}},dataZoom:[{type:"inside",realtime:true},{type:"slider",show:true,realtime:true}],grid:{top:10,left:20,right:20,bottom:40,containLabel:true},legend:{left:"left"},xAxis:{type:"category",boundaryGap:false,data:N},yAxis:{type:"value",position:"right",scale:true},calculable:false,series:[{name:"查看",type:"line",smooth:true,data:L}]});J.hideLoading();q.onresize=J.resize}})}function u(){i("#wk-show-chart-tip").html("<label>当前价：<span>--</span></label><label>成交量：<span>--</span>股</label><label>时间：<span>--</span></label><label>涨幅：<span>--</span></label>");var I=echarts.init(w.getElementById("left-stockdata-chart"));common.getCurve({code:j},function(){I.showLoading({text:"加载中..."})},function(M){var L=[];var K=[];var P=[];if(M.status===1){I.hideLoading();var O=M.result.code_info||[];if(O.length>0){for(var N=0,J=O.length;N<J;N++){P.push(Utility.unixToTime(O[N].time*1000));K.push(O[N].price);L.push({price:O[N].price,average_price:O[N].average_price,pcr:O[N].price_change_ratio,volume:O[N].volume,time:O[N].time})}}I.setOption({color:["rgb(12, 145, 179)"],tooltip:{trigger:"axis",formatter:function(T){var R=L[T[0].dataIndex];var Q="";Q+=T[0].name+"<br>";for(var S in T){if(T.hasOwnProperty(S)){if(T[S].value&&T[S].value!==0){if(T[0].name===T[S].name){Q+="<label style='color: "+T[S].color+";font-size: 12x;'>●</label>&nbsp;&nbsp;"+T[S].seriesName+":"+Utility.formatNum(T[S].value)+"<br>"}}}}i("#wk-show-chart-tip").html("<label>当前价:<span class='"+Utility.getPriceColor(R.pcr)+"'>"+R.price+"</span></label><label>成交量:<span>"+(R.volume).toChineseNum()+"</span>股</label><label>时间:<span>"+Utility.unixToTime(R.time*1000)+"</span></label><label>涨幅：<span class='"+Utility.getPriceColor(R.pcr)+"'>"+Utility.getPriceSymbol(R.pcr)+""+R.pcr+"</span></label>");i(".wk-top-panelcon").mouseleave(function(){i("#wk-show-chart-tip").html("<label>当前价：<span>--</span></label><label>成交量：<span>--</span>股</label><label>时间：<span>--</span></label><label>涨幅：<span>--</span></label>")});return Q}},grid:{top:"10px",left:"3%",right:"3%",bottom:10,containLabel:true},xAxis:{type:"category",boundaryGap:false,data:P,axisLabel:{interval:60}},yAxis:{type:"value",position:"right",scale:true},calculable:false,series:[{name:"大盘数据",type:"line",smooth:true,showSymbol:false,symbolSize:2,data:L.map(function(Q){return Q.price}),lineStyle:{normal:{width:1}}}]});q.onresize=I.resize}});common.getGrail({code:j},null,function(L){var K=[];if(L.status===1){var J=L.result.code_info;K.push("<tr><td>今开：<span>"+J.open.toFixed(2)+"</span></td><td>换手率：<span>"+J.amount.toFixed(2)+"</span></td></tr>");K.push("<tr><td>昨收：<span>"+J.settlement_.toFixed(2)+"</span></td><td>每股收益：<span>"+J.eps.toFixed(2)+"</span></td></tr>");K.push("<tr><td>最高：<span>"+J.high.toFixed(2)+"</span></td><td>总股本：<span>"+(J.totals*10000).toChineseNum()+"</span></td></tr>");K.push("<tr><td>最低：<span>"+J.low.toFixed(2)+"</span></td><td>总市值：<span>"+(J.zsz*10000).toChineseNum()+"</span></td></tr>");K.push("<tr><td>市盈率：<span>"+J.pe.toFixed(2)+"</span></td><td>流通市值：<span>"+(J.ltsz*10000).toChineseNum()+"</span></td></tr>");K.push("<tr><td>市净率：<span>"+J.pb.toFixed(2)+"</span></td><td>成交量：<span>"+(J.volume).toChineseNum()+"股</span></td></tr>");i("#wk-top-stockdata .right-infos table>tbody").html(K.join(""))}})}i(".nav-tabs li a").bind("click",function(){if(i(this).attr("href").indexOf("#wk-selfmedia")===0){if(i("#mCSB_2_container").html().trim()===""){l.start_id=0;l.start_time=0;common.getSelfMedia(l,true)}}if(i(this).attr("href").indexOf("#wk-newsflash")===0){if(i("#wk-newsflash table>tbody").html().trim()===""){l.start_id=0;l.start_time=0;common.getFastNews(l,true)}}if(i(this).attr("href").indexOf("#wk-notice")===0){if(i("#mCSB_4_container").html().trim()===""){l.start_id=0;common.getNotice(l,true)}}if(i(this).attr("href").indexOf("#wk-report")===0){if(i("#mCSB_5_container").html().trim()===""){l.start_id=0;common.getReports(l,true)}}});i("#wk-news").mCustomScrollbar({autoHideScrollbar:true,theme:"minimal-dark",axis:"y",callbacks:{onTotalScroll:function(){if(i("#wk-news .wk-news-list:last").attr("id")){l.start_id=i("#wk-news .wk-news-list:last").attr("id").replace("news_","");l.info_type_list="1,0,0,0,0,0";l.timestamp=i("#wk-news .wk-news-list:last").attr("data-news-timestamp");common.getNews(l)}}}});i("#wk-selfmedia").mCustomScrollbar({autoHideScrollbar:true,theme:"minimal-dark",axis:"y",callbacks:{onTotalScroll:function(){if(i("#wk-selfmedia .wk-news-list:last").attr("id")){l.start_id=i("#wk-selfmedia .wk-news-list:last").attr("id").replace("media_","");l.info_type_list="0,0,1,0,0,0";l.timestamp=i("#wk-selfmedia .wk-news-list:last").attr("data-media-timestamp");common.getSelfMedia(l)}}}});i("#wk-newsflash").mCustomScrollbar({autoHideScrollbar:true,theme:"minimal-dark",axis:"y",callbacks:{onTotalScroll:function(){if(i("#wk-newsflash .wk-user-fastnews:last-child").find("ul li:last-child").attr("id")){l.start_id=i("#wk-newsflash .wk-user-fastnews:last-child").find("ul li:last-child").attr("id").replace("fast_","");l.info_type_list="0,1,0,0,0,0";l.timestamp=i("#wk-newsflash  .wk-user-fastnews:last-child").find("ul li:last-child").attr("data-fastnews-timestamp");common.getFastNews(l)}}}});i("#wk-notice").mCustomScrollbar({autoHideScrollbar:true,theme:"minimal-dark",axis:"y",callbacks:{onTotalScroll:function(){if(i("#wk-notice .wk-news-list:last").attr("id")){l.start_id=i("#wk-notice .wk-news-list:last").attr("id").replace("notice_","");l.info_type_list="0,0,0,0,0,0,1";l.timestamp=i("#wk-notice .wk-news-list:last").attr("data-news-timestamp");common.getNotice(l)}}}});i("#wk-report").mCustomScrollbar({autoHideScrollbar:true,theme:"minimal-dark",axis:"y",callbacks:{onTotalScroll:function(){if(i("#wk-report .wk-news-list:last").attr("id")){l.start_id=i("#wk-report .wk-news-list:last").attr("id").replace("report_","");l.info_type_list="0,0,0,0,0,0,0,1";l.timestamp=i("#wk-report .wk-news-list:last").attr("data-news-timestamp");common.getNotice(l)}}}});i(".wk-line-toggle a").click(function(){i(this).addClass("line-active").siblings().removeClass("line-active");var I=i(this).parent().attr("data-query-type");var K=i(this).parent().attr("data-query-key");var L=i(this).attr("data-key");var J={query_type:I,key_name:K,time_type:L};if(L==="minute"){d();return}if(L==="day"){common.getLineChart("left-hot-chart",a,x,g,C)}else{common.getHotRecord(J,function(){var M=echarts.init(w.getElementById("left-hot-chart"));M.showLoading({text:"加载中..."})},function(P){var T=[];var O=[];var R=[];var M=[];if(P.status===1){for(var W in P.visit){if(P.visit.hasOwnProperty(W)){var U=P.visit[W];for(var V in U){if(U.hasOwnProperty(V)){M.push(V);T.push(U[V])}}}}for(var Z in P.search){if(P.search.hasOwnProperty(Z)){var Y=P.search[Z];for(var X in Y){if(Y.hasOwnProperty(X)){O.push(Y[X])}}}}for(var S in P.follow){if(P.follow.hasOwnProperty(S)){var Q=P.follow[S];for(var N in Q){if(Q.hasOwnProperty(N)){R.push(Q[N])}}}}}common.getLineChart("left-hot-chart",M,T,O,R)})}});i(".treemap-toggle span").click(function(){i(this).addClass("treemap-active").siblings().removeClass("treemap-active");var I=i(this).parent().parent().parent();if(i(this).html()==="热力图"){I.find(".toggle-treemap").show();I.find(".toggle-treemap-table-up").hide();I.find(".toggle-treemap-table-down").hide()}else{if(i(this).html()==="涨幅"){I.find(".toggle-treemap").hide();I.find(".toggle-treemap-table-up").show();I.find(".toggle-treemap-table-down").hide()}else{if(i(this).html()==="跌幅"){I.find(".toggle-treemap").hide();I.find(".toggle-treemap-table-up").hide();I.find(".toggle-treemap-table-down").show()}}}});i(".wk-rate-select-label label").click(function(){i(".wk-rate-compare label").removeClass("active");i(this).addClass("active").siblings().removeClass("active");var L=i(this).parent().parent().attr("data-query-name");var K=i(this).parent().parent().attr("data-query-type");var I=i(this).attr("data-toggle");var J={query_type:K,query_key:L,query_date:I};if(K==="stock"){if(s){L=s}}switch(I){case"today":common.getRateLine(J,function(){t.showLoading({text:"加载中..."})},function(M){common.buildRateLine(L,I,M);t.hideLoading()});break;case"week":common.getRateLine(J,function(){t.showLoading({text:"加载中..."})},function(M){common.buildRateLine(L,I,M);t.hideLoading()});break;case"month":common.getRateLine(J,function(){t.showLoading({text:"加载中..."})},function(M){common.buildRateLine(L,I,M);t.hideLoading()});break;case"threemonth":common.getRateLine(J,function(){t.showLoading({text:"加载中..."})},function(M){common.buildRateLine(L,I,M);t.hideLoading()});break;default:break}});i(".wk-topcharts-box ul>li>a").bind("click",function(){if(i(this).attr("aria-controls")==="wk-top-stockdata"){u()}});var p={tooltip:{trigger:"axis",formatter:function(K){var I="";I+=K[0].name+"<br>";for(var J in K){if(K[J].value&&K[J].value!=0){if(K[0].name==K[J].name){if(K[J].seriesName.indexOf("热度")>=0){I+="<label style='color: "+K[J].color+";font-size: 14px;'>●</label>&nbsp;&nbsp;"+K[J].seriesName+":"+K[J].value+"<br>"}else{I+="<label style='color: "+K[J].color+";font-size: 14px;'>●</label>&nbsp;&nbsp;"+K[J].seriesName+":"+(K[J].value*100).toFixed(2)+"%<br>"}}}}return I}},legend:{data:[],top:0},grid:{top:"5px",left:0,right:0,bottom:40,containLabel:true},xAxis:{type:"category",boundaryGap:false,data:[],axisLabel:{interval:10}},dataZoom:[{type:"inside",realtime:true},{type:"slider",show:true,realtime:true}],yAxis:[{type:"value",position:"left"},{type:"value",position:"right",axisLabel:{formatter:function(I){if(I!==0){return(I*100).toFixed(2)+"%"}else{return 0}}}}],series:[]};function k(J){var L=[];var I=[];var P=[];var N=[];if(J.body&&J.body.list.length>0){var O=J.body.list;for(var K=0;K<O.length;K++){L.push(Utility.unixToTime(O[K].trade_time*1000));I.push(O[K].day_yield);P.push(O[K].hs300_day_yield);N.push(O[K].visit)}}var M=echarts.init(w.getElementById("wk-rate-line-pic"));p.xAxis.data=L;if(p.series.length==0){p.series.push({name:"沪深300",type:"line",smooth:true,yAxisIndex:1,data:JSON.parse("["+P+"]"),itemStyle:{normal:{color:"rgb(65,77,92)"}},lineStyle:{normal:{width:1.5}}});p.series.push({name:"【"+s+"("+j+")】收益率",type:"line",smooth:true,yAxisIndex:1,data:JSON.parse("["+I+"]"),itemStyle:{normal:{color:"rgb(151,47,134)"}},lineStyle:{normal:{width:1.5}}});p.series.push({name:"【"+s+"("+j+")】热度",type:"line",smooth:true,yAxisIndex:0,data:JSON.parse("["+N+"]"),itemStyle:{normal:{color:"rgba(151,47,134,.3)"}},lineStyle:{normal:{width:1.5}}})}M.setOption(p);q.onresize=t.resize}i(".wk-compare-search").typeahead({minLength:1,maxItem:20,order:"asc",hint:true,group:true,maxItemPerGroup:5,backdrop:false,dynamic:true,filter:false,emptyTemplate:'未找到 "{{query}}" 的相关信息',source:{"股票":{url:[o+"ajax/ajax_search.php?message={{query}},","stock"]},"行业":{url:[o+"ajax/ajax_search.php?message={{query}},","hy"]},"概念":{url:[o+"ajax/ajax_search.php?message={{query}},","gn"]},"主题事件":{url:[o+"ajax/ajax_search.php?message={{query}},","event"]}},callback:{onClickAfter:function(K,I,J){if(J.display!==""){if(i.inArray(J.display,e)==-1&&J.display.indexOf(j)<=0){if(e.length<8){i(".wk-rate-compare .dropdown-menu li:first-child").before("<li><input type=\"checkbox\" name='wk-check-info' checked='checked' data-check-type='"+Utility.getCheckType(J.group)+"' data-check-info='"+J.display+"'><span>"+J.display+"</span></li>");e.push(J.display);common.getRateLine({query_type:Utility.getCheckType(J.group),query_key:Utility.getCheckType(J.group)=="stock"?J.display.substring(J.display.indexOf("(")+1,J.display.indexOf(")")):J.display,query_date:"datacompare"},null,function(L){var Q=[];var O=[];if(L.body&&L.body.list.length>0){var P=L.body.list;for(var M=0;M<P.length;M++){Q.push(P[M].day_yield);O.push(P[M].visit)}}var N=echarts.init(w.getElementById("wk-rate-line-pic"));c.rate[J.display]={name:"【"+J.display+"】收益率",type:"line",smooth:true,yAxisIndex:1,data:JSON.parse("["+Q+"]"),lineStyle:{normal:{width:1.5}}};c.hot[J.display]={name:"【"+J.display+"】热度",type:"line",smooth:true,yAxisIndex:0,data:JSON.parse("["+O+"]"),lineStyle:{normal:{width:1.5}}};if(h){p.series.push(c.rate[J.display])}if(f){p.series.push(c.hot[J.display])}N.setOption(p)});i(".wk-rate-compare input[name='wk-check-info']").each(function(L,M){i(M).change(function(S){var N=i(M).attr("data-check-info");var R=true;if(!i(M).is(":checked")){for(var Q in p.series){if(p.series[Q].name.indexOf(N)>=0){p.series.splice(Q,2)}}}else{for(var O in p.series){if(p.series[O].name.indexOf(N)>=0){R=false}}if(R){if(h){p.series.push(c.rate[N])}if(f){p.series.push(c.hot[N])}}}var P=echarts.init(w.getElementById("wk-rate-line-pic"));P.setOption(p);S.stopPropagation()})})}}}}}});function b(){i("input[name='wk-check-hot']").change(function(L){f=!!i(this).is(":checked");if(f){for(var K in c.hot){p.series.push(c.hot[K])}}else{for(var J in p.series){if(p.series[J].name.indexOf("热度")>=0){if(p.series[J].name.indexOf(j)<0){p.series.splice(J,1)}}}}var I=echarts.init(w.getElementById("wk-rate-line-pic"));I.setOption(p);L.stopPropagation()});i("input[name='wk-check-rate']").change(function(L){h=!!i(this).is(":checked");if(h){for(var K in c.rate){p.series.push(c.rate[K])}}else{for(var J in p.series){if(p.series[J].name.indexOf("收益率")>=0){if(p.series[J].name.indexOf(j)<0){p.series.splice(J,1)}}}}var I=echarts.init(w.getElementById("wk-rate-line-pic"));I.setOption(p);L.stopPropagation()})}i(".wk-rate-compare").bind("click",function(){i(this).find("label").addClass("active");i(".wk-rate-select-label").find("label").removeClass("active")});i(".wk-compare-btn").bind("click",function(){var I={query_type:i(this).parent().parent().attr("data-query-type"),query_key:i(this).parent().parent().attr("data-query-name"),query_date:"datacompare"};common.getRateLine(I,function(){t.showLoading({text:"加载中..."})},function(J){t.hideLoading();k(J)})});common.getStockBase({stock:j},null,function(I){D(I);i('.wk-hotmap a[data-toggle="tab"]').on("shown.bs.tab",function(){D(I)})});common.getNews(l,true);y();common.initdoubleLine(1,n);b()})(jQuery,window,document);