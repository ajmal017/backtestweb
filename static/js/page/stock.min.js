var stockcode=Utility.getQueryStringByName("stock");var _stockName="";var xdata=["0:00","1:00","2:00","3:00","4:00","5:00","6:00","7:00","8:00","9:00","10:00","11:00","12:00","13:00","14:00","15:00","16:00","17:00","18:00","19:00","20:00","21:00","22:00","23:00","24：00"];var viewData=[],searchData=[],followData=[];var wk_treemap_data_industry,wk_treemap_data_concept;var myChart=echarts.init(document.getElementById("left-chart"));myChart.showLoading({text:"加载中..."});function initLineChart(){common.getSingleRealTimeHot({stock:stockcode},null,function(b){if(b.status==1){var c=[];var a=[];if(b.visit){var i=0;for(var n in b.visit){viewData.push(b.visit[n]);i++}viewData=JSON.parse("["+viewData.join(",")+"]");var m=Math.max.apply(Math,viewData);var e=viewData.indexOf(Math.max.apply(Math,viewData));a.push("<tr><td>查看</td><td>"+viewData[viewData.length-1]+"</td><td>"+(Utility.getNowFormatDate()+" "+(i-1)+":00")+"</td></tr>");c.push("<tr><td>查看</td><td>"+m+"</td><td>"+Utility.calTime(e)+"</td></tr>")}if(b.search){var d=0;for(var p in b.search){searchData.push(b.search[p]);d++}searchData=JSON.parse("["+searchData.join(",")+"]");var o=Math.max.apply(Math,searchData);var g=searchData.indexOf(Math.max.apply(Math,searchData));a.push("<tr><td>搜索</td><td>"+searchData[searchData.length-1]+"</td><td>"+(Utility.getNowFormatDate()+" "+(d-1)+":00")+"</td></tr>");c.push("<tr><td>搜索</td><td>"+o+"</td><td>"+Utility.calTime(g)+"</td></tr>")}if(b.follow){var l=0;for(var k in b.follow){followData.push(b.follow[k]);l++}followData=JSON.parse("["+followData.join(",")+"]");var j=Math.max.apply(Math,followData);var h=followData.indexOf(Math.max.apply(Math,followData));a.push("<tr><td>关注</td><td>"+followData[followData.length-1]+"</td><td>"+(Utility.getNowFormatDate()+" "+(l-1)+":00")+"</td></tr>");c.push("<tr><td>关注</td><td>"+j+"</td><td>"+Utility.calTime(h)+"</td></tr>")}$(".todayhot").html(c.join(""));$(".latesthot").html(a.join(""));common.getLineChart("left-chart",xdata,viewData,searchData,followData)}})}function initTreeMapChart(){common.getStockBase({stock:stockcode},function(){var c=["wk-industry-view-treemap","wk-concept-view-treemap"];for(var a in c){var b=echarts.init(document.getElementById(c[a]));b.showLoading({text:"加载中..."})}},function(a){if(a.status==1){var f=a.stock_info.industry;var k=a.stock_info.section;var h="";var g="";if(f.length>0){$(".hy-title").html(f[0].indus+"行业热度情况");for(var e in f){h+="<a href='industry.php?name="+f[e].indus+"' target='_blank'>"+f[e].indus+"</a>"}}if(k.length>0){$(".gn-title").html(k[0].sect+"概念热度情况");for(var d in k){g+="<a href='concept.php?name="+k[d].sect+"' target='_blank'>"+k[d].sect+"</a>"}}_stockName=a.stock_info.stock_name;$("title").html(a.stock_info.stock_name+"("+a.stock_info.stock_code+")热度情况");$(".wk-related-info").html(a.stock_info.stock_name+'热度情况&nbsp;<i class="fa fa-question-circle-o" data-toggle="popover" data-content="'+a.stock_info.stock_name+'每小时产生的热度量"></i><span>行业：'+h+"</span><span>概念："+g+"");$(".latesthot-title").html(a.stock_info.stock_name+"最近热度");$(".todayhot-title").html(a.stock_info.stock_name+"今日最热度");$("i[data-toggle='popover']").popover({container:"body",trigger:"hover"});var c=k[0].sect;var b=f[0].indus;if(!wk_treemap_data_concept){common.getTopTwentyStock({hottype:"gn",hotval:c},function(){$("#concept-view .wk-hot-table tbody").html("<tr><td colspan='5'>加载中...</td></tr>")},function(i){if(i.status==1){buildConceptTreeMap(i);wk_treemap_data_concept=i}})}else{buildConceptTreeMap(wk_treemap_data_concept)}if(!wk_treemap_data_industry){common.getTopTwentyStock({hottype:"hy",hotval:b},function(){$("#industry-view .wk-hot-table tbody").html("<tr><td colspan='5'>加载中...</td></tr>")},function(i){if(i.status==1){buildIndustryTreeMap(i);wk_treemap_data_industry=i}})}else{buildIndustryTreeMap(wk_treemap_data_industry)}initTodayRateLine();initFollowBtn()}})}function buildIndustryTreeMap(c){if(c.result.code_info.shv_.length>0){var d=c.result.code_info.shv_;var f=c.result.code_info.suv_;$("#industry-view .wk-hot-table tbody").html(common.buildHotmapTable(d,"stock"));var h=Utility.buildMapTable(f);$("#industry-view .right .toggle-treemap-table-up tbody").html(common.buildStockTable(h._up));$("#industry-view .right .toggle-treemap-table-down tbody").html(common.buildStockTable(h._down));common.buildHotmap("wk-industry-view-treemap",h._map,"stock")}if(c.result.code_info.shs_.length>0){var e=c.result.code_info.shs_;var a=c.result.code_info.sus_;$("#industry-search .wk-hot-table tbody").html(common.buildHotmapTable(e,"stock"));var h=Utility.buildMapTable(a);$("#industry-search .right .toggle-treemap-table-up tbody").html(common.buildStockTable(h._up));$("#industry-search .right .toggle-treemap-table-down tbody").html(common.buildStockTable(h._down));common.buildHotmap("wk-industry-search-treemap",h._map,"stock")}if(c.result.code_info.shf_.length>0){var g=c.result.code_info.shf_;var b=c.result.code_info.suf_;$("#industry-follow .wk-hot-table tbody").html(common.buildHotmapTable(g,"stock"));var h=Utility.buildMapTable(b);$("#industry-follow .right .toggle-treemap-table-up tbody").html(common.buildStockTable(h._up));$("#industry-follow .right .toggle-treemap-table-down tbody").html(common.buildStockTable(h._down));common.buildHotmap("wk-industry-follow-treemap",h._map,"stock")}}function buildConceptTreeMap(c){if(c.result.code_info.shv_.length>0){var d=c.result.code_info.shv_;var f=c.result.code_info.suv_;$("#concept-view .wk-hot-table tbody").html(common.buildHotmapTable(d,"stock"));var h=Utility.buildMapTable(f);$("#concept-view .right .toggle-treemap-table-up tbody").html(common.buildStockTable(h._up));$("#concept-view .right .toggle-treemap-table-down tbody").html(common.buildStockTable(h._down));common.buildHotmap("wk-concept-view-treemap",h._map,"stock")}if(c.result.code_info.shs_.length>0){var e=c.result.code_info.shs_;var a=c.result.code_info.sus_;$("#concept-search .wk-hot-table tbody").html(common.buildHotmapTable(e,"stock"));var h=Utility.buildMapTable(a);$("#concept-search .right .toggle-treemap-table-up tbody").html(common.buildStockTable(h._up));$("#concept-search .right .toggle-treemap-table-down tbody").html(common.buildStockTable(h._down));common.buildHotmap("wk-concept-search-treemap",h._map,"stock")}if(c.result.code_info.shf_.length>0){var g=c.result.code_info.shf_;var b=c.result.code_info.suf_;$("#concept-follow .wk-hot-table tbody").html(common.buildHotmapTable(g,"stock"));var h=Utility.buildMapTable(b);$("#concept-follow .right .toggle-treemap-table-up tbody").html(common.buildStockTable(h._up));$("#concept-follow .right .toggle-treemap-table-down tbody").html(common.buildStockTable(h._down));common.buildHotmap("wk-concept-follow-treemap",h._map,"stock")}}function initTodayRateLine(){var b=echarts.init(document.getElementById("wk-rate-line-pic"));var a={query_type:"stock",query_key:stockcode,query_date:"today"};common.getRateLine(a,function(){b.showLoading({text:"加载中..."})},function(c){common.buildRateLine(_stockName,"today",c);b.hideLoading()})}function initFollowBtn(){inforcenter.showGroup(null,function(a){if(a&&a.status==1){var c=[];c.push("<div class=\"btn-group\" style='float: right;'>");c.push('<button type="button" class="btn dropdown-toggle wk-btn-follow" data-toggle="dropdown" aria-haspopup="true" aria-expanded="false">');c.push("+ 关注");c.push("</button>");if(a.result.info.group_name.length>0){c.push('<ul class="dropdown-menu">');var d=a.result.info.group_name;c.push("<li class='wk-follow-stock' data-follow-name='我的自选股'><a href=\"#\">我的自选股</a></li>");for(var b=0;b<d.length;b++){c.push("<li class='wk-follow-stock' data-follow-name='"+d[b]+'\'><a href="#">'+d[b]+"</a></li>")}c.push("</ul>")}c.push("</div>");$(".wk-related-info").append(c.join(""));$(".wk-follow-stock").each(function(){var e=$(this).attr("data-follow-name");$(this).unbind("click").bind("click",function(){inforcenter.addStock({ori_name:e,code:stockcode},null,function(f){if(f.status==1){swal({title:"",text:"关注个股<span style='color: #F8BB86'>"+stockcode+"</span>成功",html:true,timer:1000,showConfirmButton:false})}else{if(f.status===0){swal({title:"",text:"关注个股<span style='color: #F8BB86'>"+stockcode+"</span>异常,"+a.msg+"",html:true,timer:1000,showConfirmButton:false})}else{swal({title:"",text:"关注个股<span style='color: #F8BB86'>"+stockcode+"</span>异常,未知原因",html:true,timer:1000,showConfirmButton:false})}}})})})}})}$(function(){var a={query_type:1,key:stockcode,start_id:0,info_type_list:"",start_time:0};$(".nav-tabs li a").bind("click",function(){if($(this).attr("href").indexOf("#wk-selfmedia")===0){if($("#mCSB_2_container").html().trim()===""){a.start_id=0;a.start_time=0;common.getSelfMedia(a)}}if($(this).attr("href").indexOf("#wk-newsflash")===0){if($("#wk-newsflash table>tbody").html().trim()===""){a.start_id=0;a.start_time=0;common.getFastNews(a)}}if($(this).attr("href").indexOf("#wk-notice")===0){if($("#mCSB_4_container").html().trim()===""){a.start_id=0;common.getNotice(a)}}});$("#wk-news").mCustomScrollbar({autoHideScrollbar:true,theme:"minimal-dark",axis:"y",callbacks:{onTotalScroll:function(){a.start_id=$("#wk-news .wk-news-list:last").attr("id").replace("news_","");a.info_type_list="1,0,0,0,0,0";a.timestamp=$("#wk-news .wk-news-list:last").attr("data-news-timestamp");common.getNews(a)}}});$("#wk-selfmedia").mCustomScrollbar({autoHideScrollbar:true,theme:"minimal-dark",axis:"y",callbacks:{onTotalScroll:function(){a.start_id=$("#wk-selfmedia .wk-news-list:last").attr("id").replace("media_","");a.info_type_list="0,0,1,0,0,0";a.timestamp=$("#wk-selfmedia .wk-news-list:last").attr("data-media-timestamp");common.getSelfMedia(a)}}});$("#wk-newsflash").mCustomScrollbar({autoHideScrollbar:true,theme:"minimal-dark",axis:"y",callbacks:{onTotalScroll:function(){a.start_id=$("#wk-newsflash .wk-user-fastnews:last-child").find("ul li:last-child").attr("id").replace("fast_","");a.info_type_list="0,1,0,0,0,0";a.timestamp=$("#wk-newsflash  .wk-user-fastnews:last-child").find("ul li:last-child").attr("data-fastnews-timestamp");common.getFastNews(a)}}});$("#wk-notice").mCustomScrollbar({autoHideScrollbar:true,theme:"minimal-dark",axis:"y",callbacks:{onTotalScroll:function(){a.start_id=$("#wk-notice .wk-news-list:last").attr("id").replace("notice_","");a.info_type_list="0,0,0,0,0,0,1";a.timestamp=$("#wk-notice .wk-news-list:last").attr("data-news-timestamp");common.getNotice(a)}}});common.initRelateSHG(1,stockcode);common.getNews(a);initLineChart();initTreeMapChart()});