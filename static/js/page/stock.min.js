function initLineChart(){common.getSingleRealTimeHot({stock:stockcode},null,function(t){if(1==t.status){var a=[],o=[];if(t.visit){var e=0;for(var i in t.visit)viewData.push(t.visit[i]),e++;viewData=JSON.parse("["+viewData.join(",")+"]");var l=Math.max.apply(Math,viewData),n=viewData.indexOf(Math.max.apply(Math,viewData));o.push("<tr><td>查看</td><td>"+viewData[viewData.length-1]+"</td><td>"+(Utility.getNowFormatDate()+" "+(e-1)+":00")+"</td></tr>"),a.push("<tr><td>查看</td><td>"+l+"</td><td>"+Utility.calTime(n)+"</td></tr>")}if(t.search){var s=0;for(var c in t.search)searchData.push(t.search[c]),s++;searchData=JSON.parse("["+searchData.join(",")+"]");var r=Math.max.apply(Math,searchData),d=searchData.indexOf(Math.max.apply(Math,searchData));o.push("<tr><td>搜索</td><td>"+searchData[searchData.length-1]+"</td><td>"+(Utility.getNowFormatDate()+" "+(s-1)+":00")+"</td></tr>"),a.push("<tr><td>搜索</td><td>"+r+"</td><td>"+Utility.calTime(d)+"</td></tr>")}if(t.follow){var m=0;for(var h in t.follow)followData.push(t.follow[h]),m++;followData=JSON.parse("["+followData.join(",")+"]");var u=Math.max.apply(Math,followData),f=followData.indexOf(Math.max.apply(Math,followData));o.push("<tr><td>关注</td><td>"+followData[followData.length-1]+"</td><td>"+(Utility.getNowFormatDate()+" "+(m-1)+":00")+"</td></tr>"),a.push("<tr><td>关注</td><td>"+u+"</td><td>"+Utility.calTime(f)+"</td></tr>")}$(".todayhot").html(a.join("")),$(".latesthot").html(o.join("")),common.getLineChart("left-chart",xdata,viewData,searchData,followData)}})}function initTreeMapChart(){common.getStockBase({stock:stockcode},function(){var t=["wk-industry-view-treemap","wk-concept-view-treemap"];for(var a in t){var o=echarts.init(document.getElementById(t[a]));o.showLoading({text:"加载中..."})}},function(t){if(1==t.status){var a=t.stock_info.industry,o=t.stock_info.section,e="",i="";if(a.length>0){$(".hy-title").html(a[0].indus+"行业热度情况");for(var l in a)e+="<a href='industry.php?name="+a[l].indus+"' target='_blank'>"+a[l].indus+"</a>"}if(o.length>0){$(".gn-title").html(o[0].sect+"概念热度情况");for(var l in o)i+="<a href='concept.php?name="+o[l].sect+"' target='_blank'>"+o[l].sect+"</a>"}_stockName=t.stock_info.stock_name,$("title").html(t.stock_info.stock_name+"("+t.stock_info.stock_code+")热度情况"),$(".wk-related-info").html(t.stock_info.stock_name+'热度情况&nbsp;<i class="fa fa-question-circle-o" data-toggle="popover" data-content="'+t.stock_info.stock_name+'每小时产生的热度量"></i><span>行业：'+e+"</span><span>概念："+i),$(".latesthot-title").html(t.stock_info.stock_name+"最近热度"),$(".todayhot-title").html(t.stock_info.stock_name+"今日最热度"),$("i[data-toggle='popover']").popover({container:"body",trigger:"hover"});var n=o[0].sect,s=a[0].indus;wk_treemap_data_concept?buildConceptTreeMap(wk_treemap_data_concept):common.getTopTwentyStock({hottype:"gn",hotval:n},function(){$("#concept-view .wk-hot-table tbody").html("<tr><td colspan='5'>加载中...</td></tr>")},function(t){1==t.status&&(buildConceptTreeMap(t),wk_treemap_data_concept=t)}),wk_treemap_data_industry?buildIndustryTreeMap(wk_treemap_data_industry):common.getTopTwentyStock({hottype:"hy",hotval:s},function(){$("#industry-view .wk-hot-table tbody").html("<tr><td colspan='5'>加载中...</td></tr>")},function(t){1==t.status&&(buildIndustryTreeMap(t),wk_treemap_data_industry=t)}),initTodayRateLine(),initFollowBtn()}})}function buildIndustryTreeMap(t){if(t.result.code_info.shv_.length>0){var a=t.result.code_info.shv_,o=t.result.code_info.suv_;$("#industry-view .wk-hot-table tbody").html(common.buildHotmapTable(a,"stock")),$("#industry-view .right .wk-treemap-table tbody").html(common.buildStockTable(o)),common.buildHotmap("wk-industry-view-treemap",o,"stock")}if(t.result.code_info.shs_.length>0){var e=t.result.code_info.shs_,i=t.result.code_info.sus_;$("#industry-search .wk-hot-table tbody").html(common.buildHotmapTable(e,"stock")),$("#industry-search .right .wk-treemap-table tbody").html(common.buildStockTable(i)),common.buildHotmap("wk-industry-search-treemap",i,"stock")}if(t.result.code_info.shf_.length>0){var l=t.result.code_info.shf_,n=t.result.code_info.suf_;$("#industry-follow .wk-hot-table tbody").html(common.buildHotmapTable(l,"stock")),$("#industry-follow .right .wk-treemap-table tbody").html(common.buildStockTable(n)),common.buildHotmap("wk-industry-follow-treemap",n,"stock")}}function buildConceptTreeMap(t){if(t.result.code_info.shv_.length>0){var a=t.result.code_info.shv_,o=t.result.code_info.suv_;$("#concept-view .wk-hot-table tbody").html(common.buildHotmapTable(a,"stock")),$("#concept-view .right .wk-treemap-table tbody").html(common.buildStockTable(o)),common.buildHotmap("wk-concept-view-treemap",o,"stock")}if(t.result.code_info.shs_.length>0){var e=t.result.code_info.shs_,i=t.result.code_info.sus_;$("#concept-search .wk-hot-table tbody").html(common.buildHotmapTable(e,"stock")),$("#concept-search .right .wk-treemap-table tbody").html(common.buildStockTable(i)),common.buildHotmap("wk-concept-search-treemap",i,"stock")}if(t.result.code_info.shf_.length>0){var l=t.result.code_info.shf_,n=t.result.code_info.suf_;$("#concept-follow .wk-hot-table tbody").html(common.buildHotmapTable(l,"stock")),$("#concept-follow .right .wk-treemap-table tbody").html(common.buildStockTable(n)),common.buildHotmap("wk-concept-follow-treemap",n,"stock")}}function initTodayRateLine(){var t=echarts.init(document.getElementById("wk-rate-line-pic")),a={query_type:"stock",query_key:stockcode,query_date:"today"};common.getRateLine(a,function(){t.showLoading({text:"加载中..."})},function(a){common.buildRateLine(_stockName,"today",a),t.hideLoading()})}function initFollowBtn(){inforcenter.showGroup(null,function(t){if(t&&1==t.status){var a=[];if(a.push("<div class=\"btn-group\" style='float: right;'>"),a.push('<button type="button" class="btn dropdown-toggle wk-btn-follow" data-toggle="dropdown" aria-haspopup="true" aria-expanded="false">'),a.push("+ 关注"),a.push("</button>"),t.result.info.group_name.length>0){a.push('<ul class="dropdown-menu">');var o=t.result.info.group_name;a.push("<li class='wk-follow-stock' data-follow-name='我的自选股'><a href=\"#\">我的自选股</a></li>");for(var e=0;e<o.length;e++)a.push("<li class='wk-follow-stock' data-follow-name='"+o[e]+'\'><a href="#">'+o[e]+"</a></li>");a.push("</ul>")}a.push("</div>"),$(".wk-related-info").append(a.join("")),$(".wk-follow-stock").each(function(){var a=$(this).attr("data-follow-name");$(this).unbind("click").bind("click",function(){inforcenter.addStock({ori_name:a,code:stockcode},null,function(a){1==a.status?swal({title:"",text:"关注个股<span style='color: #F8BB86'>"+stockcode+"</span>成功",html:!0,timer:1e3,showConfirmButton:!1}):0==a.status?swal({title:"",text:"关注个股<span style='color: #F8BB86'>"+stockcode+"</span>异常,"+t.msg,html:!0,timer:1e3,showConfirmButton:!1}):swal({title:"",text:"关注个股<span style='color: #F8BB86'>"+stockcode+"</span>异常,未知原因",html:!0,timer:1e3,showConfirmButton:!1})})})})}})}var stockcode=Utility.getQueryStringByName("stock"),_stockName="",xdata=["0:00","1:00","2:00","3:00","4:00","5:00","6:00","7:00","8:00","9:00","10:00","11:00","12:00","13:00","14:00","15:00","16:00","17:00","18:00","19:00","20:00","21:00","22:00","23:00","24：00"],viewData=[],searchData=[],followData=[],wk_treemap_data_industry,wk_treemap_data_concept,myChart=echarts.init(document.getElementById("left-chart"));myChart.showLoading({text:"加载中..."}),$(function(){var t={query_type:1,key:stockcode,start_id:0,info_type_list:"",start_time:0};$(".nav-tabs li a").bind("click",function(){0==$(this).attr("href").indexOf("#wk-selfmedia")&&""==$("#mCSB_2_container").html().trim()&&(t.start_id=0,t.start_time=0,common.getSelfMedia(t)),0==$(this).attr("href").indexOf("#wk-newsflash")&&""==$("#wk-newsflash table>tbody").html().trim()&&(t.start_id=0,t.start_time=0,common.getFastNews(t))}),$("#wk-news").mCustomScrollbar({autoHideScrollbar:!0,theme:"minimal-dark",axis:"y",callbacks:{onTotalScroll:function(){t.start_id=$("#wk-news .wk-news-list:last").attr("id").replace("news_",""),t.info_type_list="1,0,0,0,0,0",t.timestamp=$("#wk-news .wk-news-list:last").attr("data-news-timestamp"),common.getNews(t)}}}),$("#wk-selfmedia").mCustomScrollbar({autoHideScrollbar:!0,theme:"minimal-dark",axis:"y",callbacks:{onTotalScroll:function(){t.start_id=$("#wk-selfmedia .wk-news-list:last").attr("id").replace("media_",""),t.info_type_list="0,0,1,0,0,0",t.timestamp=$("#wk-selfmedia .wk-news-list:last").attr("data-media-timestamp"),common.getSelfMedia(t)}}}),$("#wk-newsflash").mCustomScrollbar({autoHideScrollbar:!0,theme:"minimal-dark",axis:"y",callbacks:{onTotalScroll:function(){t.start_id=$("#wk-newsflash .wk-user-fastnews:last-child").find("ul li:last-child").attr("id").replace("fast_",""),t.info_type_list="0,1,0,0,0,0",t.timestamp=$("#wk-newsflash  .wk-user-fastnews:last-child").find("ul li:last-child").attr("data-fastnews-timestamp"),common.getFastNews(t)}}}),common.initRelateSHG(1,stockcode),common.getNews(t),initLineChart(),initTreeMapChart()});