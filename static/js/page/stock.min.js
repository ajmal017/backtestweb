"use strict";(function(f,k,p){var g=Utility.getQueryStringByName("stock");var x="";var a=["0:00","1:00","2:00","3:00","4:00","5:00","6:00","7:00","8:00","9:00","10:00","11:00","12:00","13:00","14:00","15:00","16:00","17:00","18:00","19:00","20:00","21:00","22:00","23:00","24：00"];var q=[],e=[],w=[],b=[],r=[],l=[];var c,A;var i=Utility.getQueryStringByName("query_type");var m=g+"s";var d=echarts.init(p.getElementById("left-chart"));var n=echarts.init(p.getElementById("left-double-chart"));d.showLoading({text:"加载中..."});n.showLoading({text:"加载中..."});function v(D,C,F,E){return"<a href='hotrank.php?key="+D+","+C+","+F+","+E+"' class='wk-view-more' target='_blank'>更多&nbsp;<i class='fa fa-angle-double-right'></i></a>"}function s(){common.getSingleRealTimeHot({stock:g},null,function(D){if(D.status==1){var E=[];var C=[];if(D.visit){var J=0;for(var O in D.visit){q.push(D.visit[O]);J++}q=JSON.parse("["+q.join(",")+"]");var N=Math.max.apply(Math,q);var G=q.indexOf(Math.max.apply(Math,q));C.push("<tr><td>查看</td><td>"+q[q.length-1]+"</td><td>"+(Utility.getNowFormatDate()+" "+(J-1)+":00")+"</td></tr>");E.push("<tr><td>查看</td><td>"+N+"</td><td>"+Utility.calTime(G)+"</td></tr>")}if(D.search){var F=0;for(var Q in D.search){e.push(D.search[Q]);F++}e=JSON.parse("["+e.join(",")+"]");var P=Math.max.apply(Math,e);var H=e.indexOf(Math.max.apply(Math,e));C.push("<tr><td>搜索</td><td>"+e[e.length-1]+"</td><td>"+(Utility.getNowFormatDate()+" "+(F-1)+":00")+"</td></tr>");E.push("<tr><td>搜索</td><td>"+P+"</td><td>"+Utility.calTime(H)+"</td></tr>")}if(D.follow){var M=0;for(var L in D.follow){w.push(D.follow[L]);M++}w=JSON.parse("["+w.join(",")+"]");var K=Math.max.apply(Math,w);var I=w.indexOf(Math.max.apply(Math,w));C.push("<tr><td>关注</td><td>"+w[w.length-1]+"</td><td>"+(Utility.getNowFormatDate()+" "+(M-1)+":00")+"</td></tr>");E.push("<tr><td>关注</td><td>"+K+"</td><td>"+Utility.calTime(I)+"</td></tr>")}f(".todayhot").html(E.join(""));f(".latesthot").html(C.join(""));common.getLineChart("left-chart",a,q,e,w)}})}function y(){common.getStockBase({stock:g},function(){var E=["wk-industry-view-treemap","wk-concept-view-treemap"];for(var C in E){var D=echarts.init(p.getElementById(E[C]));D.showLoading({text:"加载中..."})}},function(C){if(C.status==1){var H=C.stock_info.industry;var K=C.stock_info.section;var J="";var I="";if(H.length>0){f(".hy-title").html(H[0].indus+"行业热度情况");for(var G in H){J+="<a href='industry.php?name="+H[G].indus+"' target='_blank'>"+H[G].indus+"</a>"}}if(K.length>0){f(".gn-title").html(K[0].sect+"概念热度情况");for(var F in K){I+="<a href='concept.php?name="+K[F].sect+"' target='_blank'>"+K[F].sect+"</a>"}}if(f("#industry-view").find(".col-md-5 .wk-hot-sub-title a").length<=0){f("#industry-view").find(".col-md-5 .wk-hot-sub-title").append(v(1,2,2,H[0].indus))}if(f("#industry-search").find(".col-md-5 .wk-hot-sub-title a").length<=0){f("#industry-search").find(".col-md-5 .wk-hot-sub-title").append(v(2,2,2,H[0].indus))}if(f("#industry-follow").find(".col-md-5 .wk-hot-sub-title a").length<=0){f("#industry-follow").find(".col-md-5 .wk-hot-sub-title").append(v(3,2,2,H[0].indus))}if(f("#concept-view").find(".col-md-5 .wk-hot-sub-title a").length<=0){f("#concept-view").find(".col-md-5 .wk-hot-sub-title").append(v(1,3,2,K[0].sect))}if(f("#concept-search").find(".col-md-5 .wk-hot-sub-title a").length<=0){f("#concept-search").find(".col-md-5 .wk-hot-sub-title").append(v(2,3,2,K[0].sect))}if(f("#concept-follow").find(".col-md-5 .wk-hot-sub-title a").length<=0){f("#concept-follow").find(".col-md-5 .wk-hot-sub-title").append(v(3,3,2,K[0].sect))}x=C.stock_info.stock_name;f(".wk-toshow-name").html(x+"("+g+")");Utility.getSinaStockData(g,function(M){var L=Utility.getStockStatus(M);f(".wk-topshow-price").html("¥"+L.price).addClass(Utility.getUpDownColor(L.updown));f(".wk-topshow-price-per").html(Utility.getPriceSymbol(L.updown)+L.updown.toFixed(2)+"("+Utility.getPriceSymbol(L.updown)+L.percent.toFixed(2)+"%)").addClass(Utility.getUpDownColor(L.percent))});f(".wk-topshow-dp span").html(Utility.getTradeTime()).addClass("wk-up");f("title").html(C.stock_info.stock_name+"("+C.stock_info.stock_code+")热度情况");f(".wk-related-info").html('热度总览&nbsp;<i class="fa fa-question-circle-o" data-toggle="popover" data-content="'+C.stock_info.stock_name+'每小时产生的热度量"></i><span>行业：'+J+"</span><span>概念："+I+"");f(".latesthot-title").html(C.stock_info.stock_name+"最近热度");f(".todayhot-title").html(C.stock_info.stock_name+"今日最热度");f("i[data-toggle='popover']").popover({container:"body",trigger:"hover"});var E=K[0].sect;var D=H[0].indus;if(!A){common.getTopTwentyStock({hottype:"gn",hotval:E},function(){f("#concept-view .wk-hot-table tbody").html("<tr><td colspan='5'>加载中...</td></tr>")},function(L){if(L.status==1){B(L);A=L}})}else{B(A)}if(!c){common.getTopTwentyStock({hottype:"hy",hotval:D},function(){f("#industry-view .wk-hot-table tbody").html("<tr><td colspan='5'>加载中...</td></tr>")},function(L){if(L.status==1){j(L);c=L}})}else{j(c)}u();z()}})}function j(E){if(E.result.code_info.shv_.length>0){var F=E.result.code_info.shv_;var H=E.result.code_info.suv_;f("#industry-view .wk-hot-table tbody").html(common.buildHotmapTable(F,"stock"));var J=Utility.buildMapTable(H);f("#industry-view .right .toggle-treemap-table-up tbody").html(common.buildStockTable(J._up));f("#industry-view .right .toggle-treemap-table-down tbody").html(common.buildStockTable(J._down));common.buildHotmap("wk-industry-view-treemap",J._map,"stock")}if(E.result.code_info.shs_.length>0){var G=E.result.code_info.shs_;var C=E.result.code_info.sus_;f("#industry-search .wk-hot-table tbody").html(common.buildHotmapTable(G,"stock"));var J=Utility.buildMapTable(C);f("#industry-search .right .toggle-treemap-table-up tbody").html(common.buildStockTable(J._up));f("#industry-search .right .toggle-treemap-table-down tbody").html(common.buildStockTable(J._down));common.buildHotmap("wk-industry-search-treemap",J._map,"stock")}if(E.result.code_info.shf_.length>0){var I=E.result.code_info.shf_;var D=E.result.code_info.suf_;f("#industry-follow .wk-hot-table tbody").html(common.buildHotmapTable(I,"stock"));var J=Utility.buildMapTable(D);f("#industry-follow .right .toggle-treemap-table-up tbody").html(common.buildStockTable(J._up));f("#industry-follow .right .toggle-treemap-table-down tbody").html(common.buildStockTable(J._down));common.buildHotmap("wk-industry-follow-treemap",J._map,"stock")}}function B(E){if(E.result.code_info.shv_.length>0){var F=E.result.code_info.shv_;var H=E.result.code_info.suv_;f("#concept-view .wk-hot-table tbody").html(common.buildHotmapTable(F,"stock"));var J=Utility.buildMapTable(H);f("#concept-view .right .toggle-treemap-table-up tbody").html(common.buildStockTable(J._up));f("#concept-view .right .toggle-treemap-table-down tbody").html(common.buildStockTable(J._down));common.buildHotmap("wk-concept-view-treemap",J._map,"stock")}if(E.result.code_info.shs_.length>0){var G=E.result.code_info.shs_;var C=E.result.code_info.sus_;f("#concept-search .wk-hot-table tbody").html(common.buildHotmapTable(G,"stock"));var J=Utility.buildMapTable(C);f("#concept-search .right .toggle-treemap-table-up tbody").html(common.buildStockTable(J._up));f("#concept-search .right .toggle-treemap-table-down tbody").html(common.buildStockTable(J._down));common.buildHotmap("wk-concept-search-treemap",J._map,"stock")}if(E.result.code_info.shf_.length>0){var I=E.result.code_info.shf_;var D=E.result.code_info.suf_;f("#concept-follow .wk-hot-table tbody").html(common.buildHotmapTable(I,"stock"));var J=Utility.buildMapTable(D);f("#concept-follow .right .toggle-treemap-table-up tbody").html(common.buildStockTable(J._up));f("#concept-follow .right .toggle-treemap-table-down tbody").html(common.buildStockTable(J._down));common.buildHotmap("wk-concept-follow-treemap",J._map,"stock")}}function u(){var D=echarts.init(p.getElementById("wk-rate-line-pic"));var C={query_type:"stock",query_key:g,query_date:"today"};common.getRateLine(C,function(){D.showLoading({text:"加载中..."})},function(E){common.buildRateLine(x,"today",E);D.hideLoading()})}function z(){inforcenter.showGroup(null,function(C){if(C&&C.status==1){var E=[];E.push("<div class=\"btn-group\" style='float: right;'>");E.push('<button type="button" class="btn dropdown-toggle wk-btn-follow" data-toggle="dropdown" aria-haspopup="true" aria-expanded="false">');E.push("+ 关注");E.push("</button>");if(C.result.info.group_name.length>0){E.push('<ul class="dropdown-menu">');var F=C.result.info.group_name;E.push("<li class='wk-follow-stock' data-follow-name='我的自选股'><a href=\"#\">我的自选股</a></li>");for(var D=0;D<F.length;D++){E.push("<li class='wk-follow-stock' data-follow-name='"+F[D]+'\'><a href="#">'+F[D]+"</a></li>")}E.push("</ul>")}E.push("</div>");f(".wk-topshow-right").append(E.join(""));f(".wk-follow-stock").each(function(){var G=f(this).attr("data-follow-name");f(this).unbind("click").bind("click",function(){inforcenter.addStock({ori_name:G,code:g},null,function(H){if(H.status==1){swal({title:"",text:"关注个股<span style='color: #F8BB86'>"+g+"</span>成功",html:true,timer:1000,showConfirmButton:false})}else{if(H.status===0){swal({title:"",text:"关注个股<span style='color: #F8BB86'>"+g+"</span>异常,"+C.msg+"",html:true,timer:1000,showConfirmButton:false})}else{swal({title:"",text:"关注个股<span style='color: #F8BB86'>"+g+"</span>异常,未知原因",html:true,timer:1000,showConfirmButton:false})}}})})})}})}function t(){}function o(D,C){common.getNewsTrend({query_type:D,key_name:C},null,function(E){n.hideLoading();if(E.status==1){for(var G=0,F=E.infotrend.length;G<F;G++){b.push(E.infotrend[G]["date"]);r.push(E.infotrend[G]["info_count"]);l.push(E.infotrend[G]["info_senti"])}if(E.senti_per){var H=E.senti_per.neg_per;var I=E.senti_per.pos_per;f(".pro_chart .progress_neg_per").css("width",H*100+"%");if(H&&H>0){f(".pro_chart .progress_neg .progress_circle").css({left:(H*100)-1.5+"%",display:"block"})}f(".sacle .negative_per").html((H*100).toFixed(0));f(".pro_chart .progress_pos_per").css("width",I*100+"%");if(I&&I>0){f(".pro_chart .progress_pos .progress_circle").css({left:(I*100)-1.5+"%",display:"block"})}f(".sacle .positive_per").html((I*100).toFixed(0))}common.getTwoLineChart("left-double-chart",b,r,l)}})}var h={query_type:1,key:g,start_id:0,info_type_list:"",start_time:0};f(".nav-tabs li a").bind("click",function(){if(f(this).attr("href").indexOf("#wk-selfmedia")==0){if(f("#mCSB_2_container").html().trim()==""){h.start_id=0;h.start_time=0;common.getSelfMedia(h,true)}}if(f(this).attr("href").indexOf("#wk-newsflash")==0){if(f("#wk-newsflash table>tbody").html().trim()==""){h.start_id=0;h.start_time=0;common.getFastNews(h,true)}}if(f(this).attr("href").indexOf("#wk-notice")==0){if(f("#mCSB_4_container").html().trim()==""){h.start_id=0;common.getNotice(h,true)}}if(f(this).attr("href").indexOf("#wk-report")==0){if(f("#mCSB_5_container").html().trim()==""){h.start_id=0;common.getReports(h,true)}}});f("#wk-news").mCustomScrollbar({autoHideScrollbar:true,theme:"minimal-dark",axis:"y",callbacks:{onTotalScroll:function(){if(f("#wk-news .wk-news-list:last").attr("id")){h.start_id=f("#wk-news .wk-news-list:last").attr("id").replace("news_","");h.info_type_list="1,0,0,0,0,0";h.timestamp=f("#wk-news .wk-news-list:last").attr("data-news-timestamp");common.getNews(h)}}}});f("#wk-selfmedia").mCustomScrollbar({autoHideScrollbar:true,theme:"minimal-dark",axis:"y",callbacks:{onTotalScroll:function(){if(f("#wk-selfmedia .wk-news-list:last").attr("id")){h.start_id=f("#wk-selfmedia .wk-news-list:last").attr("id").replace("media_","");h.info_type_list="0,0,1,0,0,0";h.timestamp=f("#wk-selfmedia .wk-news-list:last").attr("data-media-timestamp");common.getSelfMedia(h)}}}});f("#wk-newsflash").mCustomScrollbar({autoHideScrollbar:true,theme:"minimal-dark",axis:"y",callbacks:{onTotalScroll:function(){if(f("#wk-newsflash .wk-user-fastnews:last-child").find("ul li:last-child").attr("id")){h.start_id=f("#wk-newsflash .wk-user-fastnews:last-child").find("ul li:last-child").attr("id").replace("fast_","");h.info_type_list="0,1,0,0,0,0";h.timestamp=f("#wk-newsflash  .wk-user-fastnews:last-child").find("ul li:last-child").attr("data-fastnews-timestamp");common.getFastNews(h)}}}});f("#wk-notice").mCustomScrollbar({autoHideScrollbar:true,theme:"minimal-dark",axis:"y",callbacks:{onTotalScroll:function(){if(f("#wk-notice .wk-news-list:last").attr("id")){h.start_id=f("#wk-notice .wk-news-list:last").attr("id").replace("notice_","");h.info_type_list="0,0,0,0,0,0,1";h.timestamp=f("#wk-notice .wk-news-list:last").attr("data-news-timestamp");common.getNotice(h)}}}});f("#wk-report").mCustomScrollbar({autoHideScrollbar:true,theme:"minimal-dark",axis:"y",callbacks:{onTotalScroll:function(){if(f("#wk-report .wk-news-list:last").attr("id")){h.start_id=f("#wk-report .wk-news-list:last").attr("id").replace("report_","");h.info_type_list="0,0,0,0,0,0,0,1";h.timestamp=f("#wk-report .wk-news-list:last").attr("data-news-timestamp");common.getNotice(h)}}}});common.initRelateSHG(1,g);common.getNews(h,true);s();y();o(1,m)})(jQuery,window,document);