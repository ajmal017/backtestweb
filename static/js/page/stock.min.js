"use strict";(function(f,j,m){var l=Utility.getQueryStringByName("stock");var s="";var a=["0:00","1:00","2:00","3:00","4:00","5:00","6:00","7:00","8:00","9:00","10:00","11:00","12:00","13:00","14:00","15:00","16:00","17:00","18:00","19:00","20:00","21:00","22:00","23:00","24：00"];var n=[],e=[],r=[];var b,w;var h=Utility.getQueryStringByName("query_type");var k=l+"s";var d=echarts.init(m.getElementById("left-chart"));d.showLoading({text:"加载中..."});function t(z,y,B,A){return"<a href='hotrank.php?key="+z+","+y+","+B+","+A+"' class='wk-view-more' target='_blank'>更多&nbsp;<i class='fa fa-angle-double-right'></i></a>"}function o(){common.getSingleRealTimeHot({stock:l,hour_data:"stock"},null,function(z){if(z.status==1){var A=[];var y=[];if(z.visit){var F=0;for(var K in z.visit){n.push(z.visit[K]);F++}n=JSON.parse("["+n.join(",")+"]");var J=Math.max.apply(Math,n);var C=n.indexOf(Math.max.apply(Math,n));y.push("<tr><td>查看</td><td>"+n[n.length-1]+"</td><td>"+(Utility.getNowFormatDate()+" "+(F-1)+":00")+"</td></tr>");A.push("<tr><td>查看</td><td>"+J+"</td><td>"+Utility.calTime(C)+"</td></tr>")}if(z.search){var B=0;for(var M in z.search){e.push(z.search[M]);B++}e=JSON.parse("["+e.join(",")+"]");var L=Math.max.apply(Math,e);var D=e.indexOf(Math.max.apply(Math,e));y.push("<tr><td>搜索</td><td>"+e[e.length-1]+"</td><td>"+(Utility.getNowFormatDate()+" "+(B-1)+":00")+"</td></tr>");A.push("<tr><td>搜索</td><td>"+L+"</td><td>"+Utility.calTime(D)+"</td></tr>")}if(z.follow){var I=0;for(var H in z.follow){r.push(z.follow[H]);I++}r=JSON.parse("["+r.join(",")+"]");var G=Math.max.apply(Math,r);var E=r.indexOf(Math.max.apply(Math,r));y.push("<tr><td>关注</td><td>"+r[r.length-1]+"</td><td>"+(Utility.getNowFormatDate()+" "+(I-1)+":00")+"</td></tr>");A.push("<tr><td>关注</td><td>"+G+"</td><td>"+Utility.calTime(E)+"</td></tr>")}f(".todayhot").html(A.join(""));f(".latesthot").html(y.join(""));common.getLineChart("left-chart",a,n,e,r)}})}function u(){common.getStockBase({stock:l},function(){var A=["wk-industry-view-treemap","wk-concept-view-treemap"];for(var y in A){var z=echarts.init(m.getElementById(A[y]));z.showLoading({text:"加载中..."})}},function(y){if(y.status==1){var D=y.stock_info.industry;var G=y.stock_info.section;var F="";var E="";if(D.length>0){f(".hy-title").html(D[0].indus+"行业热度情况");for(var C in D){F+="<a href='industry.php?name="+D[C].indus+"' target='_blank'>"+D[C].indus+"</a>"}}if(G.length>0){f(".gn-title").html(G[0].sect+"概念热度情况");for(var B in G){E+="<a href='concept.php?name="+G[B].sect+"' target='_blank'>"+G[B].sect+"</a>"}}if(f("#industry-view").find(".col-md-5 .wk-hot-sub-title a").length<=0){f("#industry-view").find(".col-md-5 .wk-hot-sub-title").append(t(1,2,2,D[0].indus))}if(f("#industry-search").find(".col-md-5 .wk-hot-sub-title a").length<=0){f("#industry-search").find(".col-md-5 .wk-hot-sub-title").append(t(2,2,2,D[0].indus))}if(f("#industry-follow").find(".col-md-5 .wk-hot-sub-title a").length<=0){f("#industry-follow").find(".col-md-5 .wk-hot-sub-title").append(t(3,2,2,D[0].indus))}if(f("#concept-view").find(".col-md-5 .wk-hot-sub-title a").length<=0){f("#concept-view").find(".col-md-5 .wk-hot-sub-title").append(t(1,3,2,G[0].sect))}if(f("#concept-search").find(".col-md-5 .wk-hot-sub-title a").length<=0){f("#concept-search").find(".col-md-5 .wk-hot-sub-title").append(t(2,3,2,G[0].sect))}if(f("#concept-follow").find(".col-md-5 .wk-hot-sub-title a").length<=0){f("#concept-follow").find(".col-md-5 .wk-hot-sub-title").append(t(3,3,2,G[0].sect))}s=y.stock_info.stock_name;f(".wk-rate-select").attr("data-stock-name",s);f(".wk-toshow-name").html(s+"("+l+")");Utility.getSinaStockData(l,function(I){var H=Utility.getStockStatus(I);f(".wk-topshow-price").html("¥"+H.price).addClass(Utility.getUpDownColor(H.updown));f(".wk-topshow-price-per").html(Utility.getPriceSymbol(H.updown)+H.updown.toFixed(2)+"("+Utility.getPriceSymbol(H.updown)+H.percent.toFixed(2)+"%)").addClass(Utility.getUpDownColor(H.percent))});f(".wk-topshow-dp label").html(Utility.getTradeTime()).addClass("wk-up");f("title").html(y.stock_info.stock_name+"("+y.stock_info.stock_code+")热度情况");f(".wk-related-info").html('热度总览&nbsp;<i class="fa fa-question-circle-o" data-toggle="popover" data-content="'+y.stock_info.stock_name+'每小时产生的热度量"></i><span>行业：'+F+"</span><span>概念："+E+"");f(".latesthot-title").html(y.stock_info.stock_name+"最近热度");f(".todayhot-title").html(y.stock_info.stock_name+"今日最热度");f("i[data-toggle='popover']").popover({container:"body",trigger:"hover"});var A=G[0].sect;var z=D[0].indus;if(!w){common.getTopTwentyStock({hottype:"gn",hotval:A},function(){f("#concept-view .wk-hot-table tbody").html("<tr><td colspan='5'>加载中...</td></tr>")},function(H){if(H.status==1){x(H);w=H}})}else{x(w)}if(!b){common.getTopTwentyStock({hottype:"hy",hotval:z},function(){f("#industry-view .wk-hot-table tbody").html("<tr><td colspan='5'>加载中...</td></tr>")},function(H){if(H.status==1){i(H);b=H}})}else{i(b)}q();v();p()}})}function i(A){if(A.result.code_info.shv_.length>0){var B=A.result.code_info.shv_;var D=A.result.code_info.suv_;f("#industry-view .wk-hot-table tbody").html(common.buildHotmapTable(B,"stock"));var F=Utility.buildMapTable(D);f("#industry-view .right .toggle-treemap-table-up tbody").html(common.buildStockTable(F._up));f("#industry-view .right .toggle-treemap-table-down tbody").html(common.buildStockTable(F._down));common.buildHotmap("wk-industry-view-treemap",F._map,"stock")}if(A.result.code_info.shs_.length>0){var C=A.result.code_info.shs_;var y=A.result.code_info.sus_;f("#industry-search .wk-hot-table tbody").html(common.buildHotmapTable(C,"stock"));var F=Utility.buildMapTable(y);f("#industry-search .right .toggle-treemap-table-up tbody").html(common.buildStockTable(F._up));f("#industry-search .right .toggle-treemap-table-down tbody").html(common.buildStockTable(F._down));common.buildHotmap("wk-industry-search-treemap",F._map,"stock")}if(A.result.code_info.shf_.length>0){var E=A.result.code_info.shf_;var z=A.result.code_info.suf_;f("#industry-follow .wk-hot-table tbody").html(common.buildHotmapTable(E,"stock"));var F=Utility.buildMapTable(z);f("#industry-follow .right .toggle-treemap-table-up tbody").html(common.buildStockTable(F._up));f("#industry-follow .right .toggle-treemap-table-down tbody").html(common.buildStockTable(F._down));common.buildHotmap("wk-industry-follow-treemap",F._map,"stock")}}function x(A){if(A.result.code_info.shv_.length>0){var B=A.result.code_info.shv_;var D=A.result.code_info.suv_;f("#concept-view .wk-hot-table tbody").html(common.buildHotmapTable(B,"stock"));var F=Utility.buildMapTable(D);f("#concept-view .right .toggle-treemap-table-up tbody").html(common.buildStockTable(F._up));f("#concept-view .right .toggle-treemap-table-down tbody").html(common.buildStockTable(F._down));common.buildHotmap("wk-concept-view-treemap",F._map,"stock")}if(A.result.code_info.shs_.length>0){var C=A.result.code_info.shs_;var y=A.result.code_info.sus_;f("#concept-search .wk-hot-table tbody").html(common.buildHotmapTable(C,"stock"));var F=Utility.buildMapTable(y);f("#concept-search .right .toggle-treemap-table-up tbody").html(common.buildStockTable(F._up));f("#concept-search .right .toggle-treemap-table-down tbody").html(common.buildStockTable(F._down));common.buildHotmap("wk-concept-search-treemap",F._map,"stock")}if(A.result.code_info.shf_.length>0){var E=A.result.code_info.shf_;var z=A.result.code_info.suf_;f("#concept-follow .wk-hot-table tbody").html(common.buildHotmapTable(E,"stock"));var F=Utility.buildMapTable(z);f("#concept-follow .right .toggle-treemap-table-up tbody").html(common.buildStockTable(F._up));f("#concept-follow .right .toggle-treemap-table-down tbody").html(common.buildStockTable(F._down));common.buildHotmap("wk-concept-follow-treemap",F._map,"stock")}}function q(){var z=echarts.init(m.getElementById("wk-rate-line-pic"));var y={query_type:"stock",query_key:l,query_date:"today"};common.getRateLine(y,function(){z.showLoading({text:"加载中..."})},function(A){common.buildRateLine(s,"today",A);z.hideLoading()})}function v(){inforcenter.showGroup(null,function(y){if(y&&y.status==1){if(f(".wk-topshow-right .btn-group").length<=0){var A=[];A.push("<div class=\"btn-group\" style='float: right;'>");A.push('<button type="button" class="btn dropdown-toggle wk-btn-follow" data-toggle="dropdown" aria-haspopup="true" aria-expanded="false">');A.push("+ 关注");A.push("</button>");if(y.result.info.group_name.length>0){A.push('<ul class="dropdown-menu">');var B=y.result.info.group_name;A.push("<li class='wk-follow-stock' data-follow-name='我的自选股'><a href=\"#\">我的自选股</a></li>");for(var z=0;z<B.length;z++){A.push("<li class='wk-follow-stock' data-follow-name='"+B[z]+'\'><a href="#">'+B[z]+"</a></li>")}A.push("</ul>")}A.push("</div>");f(".wk-topshow-right").append(A.join(""))}f(".wk-follow-stock").each(function(){var C=f(this).attr("data-follow-name");f(this).unbind("click").bind("click",function(){inforcenter.addStock({ori_name:C,code:l},null,function(D){if(D.status==1){swal({title:"",text:"关注个股<span style='color: #F8BB86'>"+l+"</span>成功",html:true,timer:1000,showConfirmButton:false})}else{if(D.status===0){swal({title:"",text:"关注个股<span style='color: #F8BB86'>"+l+"</span>异常,"+y.msg+"",html:true,timer:1000,showConfirmButton:false})}else{swal({title:"",text:"关注个股<span style='color: #F8BB86'>"+l+"</span>异常,未知原因",html:true,timer:1000,showConfirmButton:false})}}})})})}})}function p(){common.initRelateSHG(1,l,function(z){if(z&&z.status==1){var A=[];if(z.industry&&z.industry.length>0){A.push('{ "industry": "'+z.industry[0].industry+'", "concept": "'+z.notion[0].section+'" }')}var y=s+"("+l+")";common.buildReleatedInfoChart(y,z)}})}function c(){f(".modal-chart").modal("show");var y=echarts.init(m.getElementById("modal-chart"));common.getSingleRealTimeHot({stock:l},function(){y.showLoading({text:"加载中..."})},function(C){y.hideLoading();var B=[];var D=[];if(C.status==1){if(C.visit){for(var A in C.visit){B.push(C.visit[A]);D.push('"'+Utility.numToTime(A)+'"')}D=JSON.parse("["+D.join(",")+"]");B=JSON.parse("["+B.join(",")+"]")}var z=echarts.init(m.getElementById("modal-chart"));z.showLoading({text:"加载中..."});z.setOption({color:["rgb(243, 104, 97)"],tooltip:{trigger:"axis",formatter:function(G){var E="";E+=G[0].name+"<br>";for(var F in G){if(G[F].value&&G[F].value!=0){if(G[0].name==G[F].name){E+="<label style='color: "+G[F].color+";font-size: 14x;'>●</label>&nbsp;&nbsp;"+G[F].seriesName+":"+Utility.formatNum(G[F].value)+"<br>"}}}return E}},dataZoom:[{type:"inside",realtime:true},{type:"slider",show:true,realtime:true}],grid:{top:10,left:20,right:20,bottom:40,containLabel:true},legend:{left:"left"},xAxis:{type:"category",boundaryGap:false,data:D},yAxis:{type:"value",position:"right",scale:true},calculable:false,series:[{name:"查看",type:"line",smooth:true,data:B}]});z.hideLoading();j.onresize=z.resize}})}var g={query_type:1,key:l,start_id:0,info_type_list:"",start_time:0};f(".nav-tabs li a").bind("click",function(){if(f(this).attr("href").indexOf("#wk-selfmedia")==0){if(f("#mCSB_2_container").html().trim()==""){g.start_id=0;g.start_time=0;common.getSelfMedia(g,true)}}if(f(this).attr("href").indexOf("#wk-newsflash")==0){if(f("#wk-newsflash table>tbody").html().trim()==""){g.start_id=0;g.start_time=0;common.getFastNews(g,true)}}if(f(this).attr("href").indexOf("#wk-notice")==0){if(f("#mCSB_4_container").html().trim()==""){g.start_id=0;common.getNotice(g,true)}}if(f(this).attr("href").indexOf("#wk-report")==0){if(f("#mCSB_5_container").html().trim()==""){g.start_id=0;common.getReports(g,true)}}});f("#wk-news").mCustomScrollbar({autoHideScrollbar:true,theme:"minimal-dark",axis:"y",callbacks:{onTotalScroll:function(){if(f("#wk-news .wk-news-list:last").attr("id")){g.start_id=f("#wk-news .wk-news-list:last").attr("id").replace("news_","");g.info_type_list="1,0,0,0,0,0";g.timestamp=f("#wk-news .wk-news-list:last").attr("data-news-timestamp");common.getNews(g)}}}});f("#wk-selfmedia").mCustomScrollbar({autoHideScrollbar:true,theme:"minimal-dark",axis:"y",callbacks:{onTotalScroll:function(){if(f("#wk-selfmedia .wk-news-list:last").attr("id")){g.start_id=f("#wk-selfmedia .wk-news-list:last").attr("id").replace("media_","");g.info_type_list="0,0,1,0,0,0";g.timestamp=f("#wk-selfmedia .wk-news-list:last").attr("data-media-timestamp");common.getSelfMedia(g)}}}});f("#wk-newsflash").mCustomScrollbar({autoHideScrollbar:true,theme:"minimal-dark",axis:"y",callbacks:{onTotalScroll:function(){if(f("#wk-newsflash .wk-user-fastnews:last-child").find("ul li:last-child").attr("id")){g.start_id=f("#wk-newsflash .wk-user-fastnews:last-child").find("ul li:last-child").attr("id").replace("fast_","");g.info_type_list="0,1,0,0,0,0";g.timestamp=f("#wk-newsflash  .wk-user-fastnews:last-child").find("ul li:last-child").attr("data-fastnews-timestamp");common.getFastNews(g)}}}});f("#wk-notice").mCustomScrollbar({autoHideScrollbar:true,theme:"minimal-dark",axis:"y",callbacks:{onTotalScroll:function(){if(f("#wk-notice .wk-news-list:last").attr("id")){g.start_id=f("#wk-notice .wk-news-list:last").attr("id").replace("notice_","");g.info_type_list="0,0,0,0,0,0,1";g.timestamp=f("#wk-notice .wk-news-list:last").attr("data-news-timestamp");common.getNotice(g)}}}});f("#wk-report").mCustomScrollbar({autoHideScrollbar:true,theme:"minimal-dark",axis:"y",callbacks:{onTotalScroll:function(){if(f("#wk-report .wk-news-list:last").attr("id")){g.start_id=f("#wk-report .wk-news-list:last").attr("id").replace("report_","");g.info_type_list="0,0,0,0,0,0,0,1";g.timestamp=f("#wk-report .wk-news-list:last").attr("data-news-timestamp");common.getNotice(g)}}}});f('.wk-hotmap a[data-toggle="tab"]').on("shown.bs.tab",function(){u()});f(".wk-line-toggle a").click(function(){f(this).addClass("line-active").siblings().removeClass("line-active");var A=f(this).parent().attr("data-query-type");var z=f(this).parent().attr("data-query-key");var B=f(this).attr("data-key");var y={query_type:A,key_name:z,time_type:B};if(B=="minute"){c();return}if(B=="day"){common.getLineChart("left-chart",a,n,e,r)}else{common.getHotRecord(y,function(){var C=echarts.init(m.getElementById("left-chart"));C.showLoading({text:"加载中..."})},function(D){var F=[];var H=[];var I=[];var E=[];if(D.status==1){for(var K in D.visit){for(var J in D.visit[K]){E.push(J);F.push(D.visit[K][J])}}for(var M in D.search){for(var L in D.search[M]){H.push(D.search[M][L])}}for(var G in D.follow){for(var C in D.follow[G]){I.push(D.follow[G][C])}}}common.getLineChart("left-chart",E,F,H,I)})}});f(".treemap-toggle span").click(function(){f(this).addClass("treemap-active").siblings().removeClass("treemap-active");var y=f(this).parent().parent().parent();if(f(this).html()=="热力图"){y.find(".toggle-treemap").show();y.find(".toggle-treemap-table-up").hide();y.find(".toggle-treemap-table-down").hide()}else{if(f(this).html()=="涨幅"){y.find(".toggle-treemap").hide();y.find(".toggle-treemap-table-up").show();y.find(".toggle-treemap-table-down").hide()}else{if(f(this).html()=="跌幅"){y.find(".toggle-treemap").hide();y.find(".toggle-treemap-table-up").hide();y.find(".toggle-treemap-table-down").show()}}}});f(".wk-rate-select label").click(function(){f(this).addClass("active").siblings().removeClass("active");var C=f(this).parent().attr("data-query-name");var A=f(this).parent().attr("data-query-type");var y=f(this).attr("data-toggle");var B=echarts.init(m.getElementById("wk-rate-line-pic"));var z={query_type:A,query_key:C,query_date:y};if(A=="stock"){if(s){C=s}}switch(y){case"today":common.getRateLine(z,function(){B.showLoading({text:"加载中..."})},function(D){common.buildRateLine(C,y,D);B.hideLoading()});break;case"week":common.getRateLine(z,function(){B.showLoading({text:"加载中..."})},function(D){common.buildRateLine(C,y,D);B.hideLoading()});break;case"month":common.getRateLine(z,function(){B.showLoading({text:"加载中..."})},function(D){common.buildRateLine(C,y,D);B.hideLoading()});break;case"threemonth":common.getRateLine(z,function(){B.showLoading({text:"加载中..."})},function(D){common.buildRateLine(C,y,D);B.hideLoading()});break;default:break}});common.getNews(g,true);o();u();common.initdoubleLine(1,k);f("#test").click(function(){})})(jQuery,window,document);