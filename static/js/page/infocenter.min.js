$(function(){initEvent.initGroupEvent();initEvent.initAddGroupEvent();$(".wk-user-mynews .btn-group").click(function(){$(this).addClass("active").siblings().removeClass("active");var a=$(this).attr("data-target");$("#"+a).fadeIn().siblings().fadeOut()});$(".wk-user-news-slider i").click(function(){if($(this).attr("data-expand")=="false"){$(this).addClass("fa-chevron-up").removeClass("fa-chevron-down").attr("data-expand",true);$(".wk-user-news-ctrl").slideDown()}else{$(this).addClass("fa-chevron-down").removeClass("fa-chevron-up").attr("data-expand",false);$(".wk-user-news-ctrl").slideUp()}});$(".wk-user-vpoint-slider i").click(function(){if($(this).attr("data-expand")=="false"){$(this).addClass("fa-chevron-up").removeClass("fa-chevron-down").attr("data-expand",true);$(".wk-user-vpoint-ctrl").slideDown()}else{$(this).addClass("fa-chevron-down").removeClass("fa-chevron-up").attr("data-expand",false);$(".wk-user-vpoint-ctrl").slideUp()}});$(".wk-user-news-ctrl .user-define i").click(function(){if($(this).attr("data-expand")=="false"){$(this).addClass("fa-caret-up").removeClass("fa-caret-down").attr("data-expand",true);$(".wk-user-news-ctrl .wk-user-news-ctrl-con").slideDown()}else{$(this).addClass("fa-caret-down").removeClass("fa-caret-up").attr("data-expand",false);$(".wk-user-news-ctrl .wk-user-news-ctrl-con").slideUp()}});$(".wk-user-vpoint-ctrl .user-define i").click(function(){if($(this).attr("data-expand")=="false"){$(this).addClass("fa-caret-up").removeClass("fa-caret-down").attr("data-expand",true);$(".wk-user-vpoint-ctrl .wk-user-news-ctrl-con").slideDown()}else{$(this).addClass("fa-caret-down").removeClass("fa-caret-up").attr("data-expand",false);$(".wk-user-vpoint-ctrl .wk-user-news-ctrl-con").slideUp()}});$(".wk-user-news-ctrl-con div").hover(function(){$(this).find("i").show()},function(){$(this).find("i").hide()});$(".wk-sub-refresh").click(function(){$(this).addClass("fa-spin");var a=$(this).attr("data-refresh");getGroupStock(a)});$(".wk-user-stock-search").typeahead({minLength:2,maxItem:20,order:"asc",hint:true,group:true,maxItemPerGroup:5,backdrop:false,dynamic:true,filter:false,emptyTemplate:'未找到 "{{query}}" 的相关信息',source:{"股票":{url:["../ajax/ajax_search.php?message={{query}},","stock"]}},callback:{onClickAfter:function(e,b,d){if(d.display!==""){var c=d.display.substring(d.display.indexOf("(")+1,d.display.indexOf(")"));var f=$(".wk-sub-refresh").attr("data-refresh");inforcenter.addStock({ori_name:f,code:c},null,function(a){if(a&&a.status==1){getGroupStock(f)}})}}}});getStockPoint();getMyGroup();getGroupStock("我的自选股");setInterval(_getNowTime,1000)});function getStockPoint(){inforcenter.getStockPoint(null,function(a){if(a&&a.status==1){if(a.result.info.index_info.length>0){var d=[];var c=a.result.info.index_info;for(var b=0;b<c.length;b++){d.push('<div class="col-md-4">');d.push('<div class="wk-user-datas-box '+Utility.getUpDownColor(c[b].up_price)+'">');d.push('<p class="wk-user-datas-title">'+c[b].name+"</p><div>");d.push('<p class="wk-user-datas-num">');if(c[b].up_price>0){d.push('<img src="../static/imgs/i/dp_up.png">')}else{if(c[b].up_price<0){d.push('<img src="../static/imgs/i/dp_down.png">')}}d.push(c[b].price);d.push("</p>");d.push('<div class="wk-user-datas-per">');d.push("<p>"+(c[b].up_price>0?"+":"")+(c[b].up_price*100).toFixed(2)+"</p>");d.push("<p>"+(c[b].up_percent>0?"+":"")+(c[b].up_percent*100).toFixed(2)+"%</p>");d.push("</div></div><hr></div></div>")}$(".wk-user-datas").html(d.join(""))}}})}function getMyGroup(){inforcenter.showGroup(null,function(b){if(b&&b.status==1){if(b.result.info.group_name.length>0){var d=b.result.info.group_name;var a=[];a.push('<div class="active" data-group-name="我的自选股">我的自选股</div>');for(var c=0;c<d.length;c++){a.push('<div class="btn-group" data-group-name=\''+d[c]+"'>");a.push("<span>"+d[c]+"</span>");a.push('<span class="dropdown-toggle" data-toggle="dropdown">');a.push('<i class="fa fa-chevron-down"></i>');a.push("</span>");a.push('<ul class="dropdown-menu" data-group-name=\''+d[c]+"'>");a.push('<li class=\'change-name\'><a href="#"><i class="fa fa-pencil fa-fw"></i>更改名称</a></li>');a.push('<li class=\'del-group\'><a href="#"><i class="fa fa-trash-o fa-fw"></i>删除组合</a></li>');a.push("</ul></div>")}$(".wk-user-choose-title").html(a.join(""));initEvent.initChangeGroupNameEvent();initEvent.initDelGroupEvent();initEvent.initGroupEvent()}}})}function getGroupStock(a){inforcenter.showstock({ori_name:a},function(){$(".wk-sub-refresh").addClass("fa-spin")},function(c){var b=[];if(c&&c.status==1){$(".wk-sub-refresh").removeClass("fa-spin");if(c.result.info.group_info.length>0){var e=c.result.info.group_info[0].stock_info;for(var d=0;d<e.length;d++){b.push("<tr>");b.push("<td>"+e[d].code+"</td>");b.push("<td>"+e[d].name+"</td>");b.push("<td>"+e[d].trade.toFixed(2)+"</td>");b.push("<td>"+(e[d].price_change_ratio*100).toFixed(2)+"</td>");b.push("<td>"+e[d].volume+"</td>");b.push("<td>"+(e[d].amount*100).toFixed(2)+"%</td>");b.push("<td>"+(e[d].pe*100).toFixed(2)+"%</td>");b.push("<td>"+e[d].visit_hot+"</td>");b.push("<td>"+e[d].search_hot+"</td>");b.push("<td>"+e[d].follow_hot+"</td>");b.push("<td><i class='fa fa-minus-circle text-danger btn-del-stock' data-stock-code='"+e[d].code+"'></i></td>");b.push("</tr>")}}else{b.push('<tr><td colspan=\'10\'><div class="wk-user-no"><img src="../static/imgs/i/nonews.png"><span>您尚未添加自选股</span></div></td></tr>')}}else{b.push('<tr><td colspan=\'10\'><div class="wk-user-no"><img src="../static/imgs/i/nonews.png"><span>您尚未添加自选股</span></div></td></tr>')}$(".wk-user-mychoose-table table>tbody").html(b.join(""));initEvent.initStockTableHoverEvent()})}function _getNowTime(){var d=new Date();var e=d.getHours();var a=d.getMinutes()>10?d.getMinutes():"0"+d.getMinutes();var c=d.getSeconds()>10?d.getSeconds():"0"+d.getSeconds();var b=e+":"+a+":"+c;$(".wk-user-time span:last-child").html(b)}var initEvent={initGroupEvent:function(){$(".wk-user-choose-title div").click(function(){$(this).addClass("active").siblings().removeClass("active");var a=$(this).attr("data-group-name");$(".wk-sub-refresh").attr("data-refresh",a);getGroupStock(a)})},initChangeGroupNameEvent:function(){$(".change-name").bind("click",function(){var a=$(this).parent().attr("data-group-name");swal({title:"更改名称【"+a+"】",text:"组合名称不能超过6个汉字或12个字符",type:"input",html:true,showCancelButton:true,closeOnConfirm:false,confirmButtonText:"确定",cancelButtonText:"取消",animation:"slide-from-top",inputPlaceholder:"请输入组合名称"},function(b){if(b===false){return false}if(b===""){swal.showInputError("请输入组合名称");return false}inforcenter.modifyGroup({ori_name:a,cur_name:b},null,function(c){if(c.status==1){swal({title:"",text:"修改组合<span style='color: #F8BB86'>"+a+"</span>为<span style='color: #F8BB86'>"+b+"</span>成功",html:true,type:"success"});getMyGroup()}})})})},initDelGroupEvent:function(){$(".del-group").bind("click",function(){var a=$(this).parent().attr("data-group-name");swal({title:"",text:"确定删除<span style='color: #F8BB86'>"+a+"</span>吗?此操作将无法恢复!",type:"warning",html:true,showCancelButton:true,confirmButtonColor:"#DD6B55",confirmButtonText:"确定",cancelButtonText:"取消",closeOnConfirm:false,closeOnCancel:true},function(b){if(b){inforcenter.delGroup({ori_name:a},null,function(c){if(c.status==1){swal({title:"",text:"组合<span style='color: #F8BB86'>"+a+"</span>已被删除",html:true,type:"success"});getMyGroup()}})}})})},initAddGroupEvent:function(){$(".wk-add-zh").click(function(){swal({title:"添加组合",text:"组合名称不能超过6个汉字或12个字符",type:"input",html:true,showCancelButton:true,closeOnConfirm:false,confirmButtonText:"确定",cancelButtonText:"取消",animation:"slide-from-top",inputPlaceholder:"请输入组合名称"},function(a){if(a===false){return false}if(a===""){swal.showInputError("请输入组合名称");return false}inforcenter.addGroup({ori_name:a},null,function(b){if(b.status==1){swal({title:"",text:"添加<span style='color: #F8BB86'>"+a+"</span>组合成功",html:true,type:"success"});getMyGroup()}else{swal({title:"",text:"添加<span style='color: #F8BB86'>"+a+"</span>组合异常",html:true,type:"success"})}})})})},initStockTableHoverEvent:function(){$(".wk-user-mychoose-table table>tbody>tr").hover(function(){var a=$(this).find("td:nth-child(2)").html();$(this).find(".btn-del-stock").show().bind("click",function(){var c=$(this).attr("data-stock-code");var b=$(".wk-sub-refresh").attr("data-refresh");swal({title:"",text:"确定删除<span style='color: #F8BB86'>"+a+"("+c+")</span>吗?此操作将无法恢复!",type:"warning",html:true,showCancelButton:true,confirmButtonColor:"#DD6B55",confirmButtonText:"确定",cancelButtonText:"取消",closeOnConfirm:false,closeOnCancel:true},function(d){if(d){inforcenter.delStock({ori_name:b,code:c},null,function(e){if(e.status==1){swal({title:"",text:"<span style='color:#F8BB86'>"+a+"("+c+")</span>已被删除",html:true,type:"success"});getGroupStock(b)}})}})})},function(){$(this).find(".btn-del-stock").hide()})}};