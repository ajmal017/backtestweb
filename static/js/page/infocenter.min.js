"use strict";var ctrlInfo={getStockPoint:function(){inforcenter.getStockPoint(function(){$(".wk-user-datas").html("<div class=\"wk-user-no\"><i class='fa fa-refresh fa-spin'></i>&nbsp;正在加载...</div>")},function(a){if(a&&a.status==1){if(a.result.info.index_info.length>0){var d=[];var c=a.result.info.index_info;for(var b=0;b<c.length;b++){d.push('<div class="col-md-4">');d.push('<div class="wk-user-datas-box '+Utility.getUpDownColor(c[b].up_price)+'">');d.push('<p class="wk-user-datas-title">'+c[b].name+"</p><div>");d.push('<p class="wk-user-datas-num">');if(c[b].up_price>0){d.push('<img src="../static/imgs/i/dp_up.png">')}else{if(c[b].up_price<0){d.push('<img src="../static/imgs/i/dp_down.png">')}}d.push(c[b].price);d.push("</p>");d.push('<div class="wk-user-datas-per">');d.push("<p>"+(c[b].up_price>0?"+":"")+(c[b].up_price).toFixed(2)+"</p>");d.push("<p>"+(c[b].up_percent>0?"+":"")+(c[b].up_percent*100).toFixed(2)+"%</p>");d.push("</div></div><hr></div></div>")}$(".wk-user-datas").html(d.join(""))}}})},getNowStockDate:function(){var d=new Date();var e=d.getHours();var a=d.getMinutes()>10?d.getMinutes():"0"+d.getMinutes();var c=d.getSeconds()>10?d.getSeconds():"0"+d.getSeconds();var b=e+":"+a+":"+c;$(".wk-user-hs").html("<span>沪深</span><span style='"+(Utility.getTradeTime()=="休市"?"":"color:red")+"'>"+Utility.getTradeTime()+"</span>");$(".wk-user-time span:last-child").html(b)},searchComplute:function(){$(".wk-user-stock-search").typeahead({minLength:2,maxItem:20,order:"asc",hint:true,group:true,maxItemPerGroup:5,backdrop:false,dynamic:true,filter:false,emptyTemplate:'未找到 "{{query}}" 的相关信息',source:{"股票":{url:["../ajax/ajax_search.php?message={{query}},","stock"]}},callback:{onClickAfter:function(e,b,d){if(d.display!==""){var c=d.display.substring(d.display.indexOf("(")+1,d.display.indexOf(")"));var f=$(".wk-sub-refresh").attr("data-refresh");inforcenter.addStock({ori_name:f,code:c},null,function(a){if(a&&a.status==1){ctrlInfo.getGroupStock(f)}})}}}})},addMyStockGroup:function(){$(".wk-add-zh").click(function(){swal({title:"添加组合",text:"组合名称不能超过6个汉字或12个字符",type:"input",html:true,showCancelButton:true,closeOnConfirm:false,confirmButtonText:"确定",cancelButtonText:"取消",animation:"slide-from-top",inputPlaceholder:"请输入组合名称"},function(a){if(a===false){return false}if(a===""){swal.showInputError("请输入组合名称");return false}if(Utility.getByteLen(a)>12){swal.showInputError("字符数超过限制");return false}inforcenter.addGroup({ori_name:a},null,function(b){if(b.status==1){swal({title:"",text:"添加<span style='color: #F8BB86'>"+a+"</span>组合成功",html:true,timer:1000,showConfirmButton:false});ctrlInfo.getMyStockGroup()}else{swal({title:"",text:"添加<span style='color: #F8BB86'>"+a+"</span>组合异常",html:true,timer:1000,showConfirmButton:false})}})})})},getMyStockGroup:function(){inforcenter.showGroup(function(){$(".wk-user-choose-title").append("<div class='btn-group'><i class='fa fa-spin fa-refresh'></i></div>")},function(b){if(b&&b.status==1){if(b.result.info.group_name.length>0){var d=b.result.info.group_name;var a=[];a.push('<div class="btn-group active" data-group-name="我的自选股"><span>我的自选股</span></div>');for(var c=0;c<d.length;c++){a.push('<div class="btn-group" data-group-name=\''+d[c]+"'>");a.push("<span>"+d[c]+"</span>");a.push('<span class="dropdown-toggle" data-toggle="dropdown">');a.push('<i class="fa fa-chevron-down"></i>');a.push("</span>");a.push('<ul class="dropdown-menu" data-group-name=\''+d[c]+"'>");a.push('<li class=\'change-name\'><a href="#"><i class="fa fa-pencil fa-fw"></i>更改名称</a></li>');a.push('<li class=\'del-group\'><a href="#"><i class="fa fa-trash-o fa-fw"></i>删除组合</a></li>');a.push("</ul></div>")}$(".wk-user-choose-title").html(a.join(""));$(".wk-user-choose-title .btn-group span:first-child").unbind("click").bind("click",function(){var e=$(this).parent().attr("data-group-name");$(".wk-sub-refresh").attr("data-refresh",e);$(this).parent().addClass("active").siblings().removeClass("active");ctrlInfo.getGroupStock(e)});$(".change-name").unbind("click").bind("click",function(){var e=$(this).parent().attr("data-group-name");swal({title:"更改名称【"+e+"】",text:"组合名称不能超过6个汉字或12个字符",type:"input",html:true,showCancelButton:true,closeOnConfirm:false,confirmButtonText:"确定",cancelButtonText:"取消",animation:"slide-from-top",inputPlaceholder:"请输入组合名称"},function(f){if(f===false){return false}if(f===""){swal.showInputError("请输入组合名称");return false}if(Utility.getByteLen(f)>12){swal.showInputError("字符数超过限制");return false}inforcenter.modifyGroup({ori_name:e,cur_name:f},null,function(g){if(g.status==1){swal({title:"",text:"修改组合<span style='color: #F8BB86'>"+e+"</span>为<span style='color: #F8BB86'>"+f+"</span>成功",html:true,timer:1000,showConfirmButton:false});ctrlInfo.getMyStockGroup()}})})});$(".del-group").unbind("click").bind("click",function(){var e=$(this).parent().attr("data-group-name");swal({title:"",text:"确定删除<span style='color: #F8BB86'>"+e+"</span>吗?此操作将无法恢复!",type:"warning",html:true,showCancelButton:true,confirmButtonColor:"#DD6B55",confirmButtonText:"确定",cancelButtonText:"取消",closeOnConfirm:false,closeOnCancel:true},function(f){if(f){inforcenter.delGroup({ori_name:e},null,function(g){if(g.status==1){swal({title:"",text:"组合<span style='color: #F8BB86'>"+e+"</span>已被删除",html:true,timer:1000,showConfirmButton:false});ctrlInfo.getMyStockGroup()}})}})})}}})},getGroupStock:function(a){inforcenter.showstock({ori_name:a},function(){$(".wk-sub-refresh").addClass("fa-spin");$(".wk-user-mychoose-table table>tbody").html("<tr><td colspan='11'><div class=\"wk-user-no\"><i class='fa fa-refresh fa-spin'></i>&nbsp;正在加载...</div></td></tr>")},function(c){$(".wk-sub-refresh").removeClass("fa-spin");var b=[];var g=[];if(c&&c.status==1){if(c.result.info.group_info.length>0){var f=c.result.info.group_info[0].stock_info;for(var e=0;e<f.length;e++){g.push(f[e].code);b.push("<tr>");b.push("<td>"+f[e].code+"</td>");b.push("<td><a href='../stocks.php?stock="+f[e].code+"' target='_blank'>"+f[e].name+"</a></td>");b.push("<td class='"+Utility.getPriceColor(f[e].price_change_ratio)+"'>"+f[e].trade.toFixed(2)+"</td>");b.push("<td class='"+Utility.getPriceColor(f[e].price_change_ratio)+"'>"+(f[e].price_change_ratio*100).toFixed(2)+"</td>");b.push("<td>"+f[e].volume+"</td>");b.push("<td>"+(f[e].amount*100).toFixed(2)+"%</td>");b.push("<td>"+(f[e].pe*100).toFixed(2)+"%</td>");b.push("<td>"+f[e].visit_hot+"</td>");b.push("<td>"+f[e].search_hot+"</td>");b.push("<td>"+f[e].follow_hot+"</td>");b.push("<td><i class='fa fa-minus-circle text-danger btn-del-stock' data-stock-code='"+f[e].code+"'></i></td>");b.push("</tr>")}$(".wk-user-mynews").attr("data-stock",g.join("|")+"|")}else{$(".wk-user-mynews").attr("data-stock","00000x|");b.push('<tr><td colspan=\'11\'><div class="wk-user-no"><img src="../static/imgs/i/nonews.png"><span>您尚未添加自选股</span></div></td></tr>')}}else{$(".wk-user-mynews").attr("data-stock","00000x|");b.push('<tr><td colspan=\'11\'><div class="wk-user-no"><img src="../static/imgs/i/nonews.png"><span>您尚未添加自选股</span></div></td></tr>')}$(".wk-user-mychoose-table table>tbody").html(b.join("")).find("tr").hover(function(){var h=$(this).find("td:nth-child(2)").html();$(this).find(".btn-del-stock").show().bind("click",function(){var j=$(this).attr("data-stock-code");var i=$(".wk-sub-refresh").attr("data-refresh");swal({title:"",text:"确定删除<span style='color: #F8BB86'>"+h+"("+j+")</span>吗?此操作将无法恢复!",type:"warning",html:true,showCancelButton:true,confirmButtonColor:"#DD6B55",confirmButtonText:"确定",cancelButtonText:"取消",closeOnConfirm:false,closeOnCancel:true},function(k){if(k){inforcenter.delStock({ori_name:i,code:j},null,function(l){if(l.status==1){swal({title:"",text:"<span style='color:#F8BB86'>"+h+"("+j+")</span>已被删除",html:true,timer:1000,showConfirmButton:false});ctrlInfo.getGroupStock(i)}})}})})},function(){$(this).find(".btn-del-stock").hide()});var d=$(".wk-user-mynews").attr("data-query-type");if(g.join("|").length>0){if(d==0){ctrlInfo.getNews({query_type:0,start_time:0,info_type:0,stock_list:g.join("|")+"|"})}if(d==1){ctrlInfo.getFastNews({query_type:1,start_time:0,info_type:0,stock_list:g.join("|")+"|"})}if(d==2){ctrlInfo.getMedia({query_type:2,start_time:0,info_type:0,stock_list:g.join("|")+"|"})}}else{if(d==0){ctrlInfo.getNews({query_type:0,start_time:0,info_type:0,stock_list:"00000x|"})}if(d==1){ctrlInfo.getFastNews({query_type:1,start_time:0,info_type:0,stock_list:"00000x|"})}if(d==2){ctrlInfo.getMedia({query_type:2,start_time:0,info_type:0,stock_list:"00000x|"})}}ctrlInfo.getPlatform()})},getPlatform:function(){inforcenter.getPlatform(function(){$(".wk-user-news-loading").show()},function(a){if(a&&a.status==1){var e=a.result[0].news_info_plat;var f=a.result[2].media_info_plat;if(e&&e.length>0){var c=[];for(var b=0;b<e.length;b++){c.push('<div class="con-item">');if(e[b].is_choosed==1){c.push("<label><span class='active'>"+e[b].platform_name+'</span>&nbsp;<i class="fa fa-times-circle" data-platform=\''+e[b].platform_id+"'></i></label>")}else{c.push("<label><span>"+e[b].platform_name+'</span>&nbsp;<i class="fa fa-plus"  data-platform=\''+e[b].platform_id+"'></i></label>")}c.push("</div>")}$(".wk-user-news-list .wk-user-news-ctrl-con").html(c.join(""))}if(f&&f.length>0){var d=[];for(var b=0;b<f.length;b++){d.push('<div class="con-item">');if(f[b].is_choosed==1){d.push("<label><span class='active'>"+f[b].platform_name+'</span>&nbsp;<i class="fa fa-times-circle"  data-platform=\''+f[b].platform_id+"'></i></label>")}else{d.push("<label><span>"+f[b].platform_name+'</span>&nbsp;<i class="fa fa-plus"  data-platform=\''+f[b].platform_id+"'></i></label>")}d.push("</div>")}$(".wk-user-vpoint-ctrl .wk-user-news-ctrl-con").html(d.join(""))}$(".wk-user-news-ctrl-con div").hover(function(){$(this).find("i").show()},function(){$(this).find("i").hide()});$(".con-item i").each(function(){$(this).unbind("click").bind("click",function(k){var j=$(this);var i=j.attr("data-platform");if(j.hasClass("fa-times-circle")){inforcenter.delUserPlatform({plat_id:i},null,function(m){if(m.status==1){j.removeClass("fa-times-circle").addClass("fa-plus").siblings().removeClass("active")}})}else{inforcenter.addUserPlatform({plat_id:i},null,function(m){if(m.status==1){j.removeClass("fa-plus").addClass("fa-times-circle").siblings().addClass("active")}})}var h=$(".wk-user-mynews").attr("query_type");var g=$(".wk-user-mynews").attr("info_type");var l=$(".wk-user-mynews").attr("data-stock");if(g==0){ctrlInfo.getNews({query_type:h,start_time:0,info_type:g,stock_list:l})}if(g==2){ctrlInfo.getMedia({query_type:h,start_time:0,info_type:g,stock_list:l})}k.stopPropagation()})});$(".wk-user-mynews .btn-group i").each(function(){$(this).unbind("click").bind("click",function(){var h=$(this).parent().parent();var g=h.attr("data-target");if(g=="wk-user-news-list"){if(h.hasClass("active")){if($(this).attr("data-expand")!="false"){$(this).addClass("fa-chevron-down").removeClass("fa-chevron-up").attr("data-expand",false);$(".wk-user-news-ctrl").hide()}else{$(this).addClass("fa-chevron-up").removeClass("fa-chevron-down").attr("data-expand",true);$(".wk-user-news-ctrl").show()}$("#"+g+" .wk-user-news-ctrl-head div").click(function(){$(this).addClass("active").siblings().removeClass("active");if($(this).hasClass("user-default")){var i=$(".wk-user-mynews").attr("data-stock");$(".wk-user-mynews").attr("query_type",1).attr("info_type","0");ctrlInfo.getNews({query_type:1,start_time:0,info_type:0,stock_list:i})}if($(this).hasClass("user-define")){$(this).find("i").bind("click",function(){if($(this).attr("data-expand")=="false"){$(this).addClass("fa-caret-up").removeClass("fa-caret-down");$("#"+g+" .wk-user-news-ctrl-con").show()}else{$(this).addClass("fa-caret-down").removeClass("fa-caret-up");$("#"+g+" .wk-user-news-ctrl-con").hide()}});$(".wk-user-mynews").attr("query_type",2).attr("info_type","0");ctrlInfo.getNews({query_type:2,start_time:0,info_type:0,stock_list:i})}})}}if(g=="wk-user-vpoint-list"){if(h.hasClass("active")){if($(this).attr("data-expand")=="false"){$(this).addClass("fa-chevron-up").removeClass("fa-chevron-down").attr("data-expand",true);$(".wk-user-vpoint-ctrl").show()}else{$(this).addClass("fa-chevron-down").removeClass("fa-chevron-up").attr("data-expand",false);$(".wk-user-vpoint-ctrl").hide()}$("#"+g+" .wk-user-news-ctrl-head div").click(function(){$(this).addClass("active").siblings().removeClass("active");var i=$(".wk-user-mynews").attr("data-stock");if($(this).hasClass("user-default")){$(".wk-user-mynews").attr("query_type",1).attr("info_type","2");ctrlInfo.getMedia({query_type:1,start_time:0,info_type:2,stock_list:i})}if($(this).hasClass("user-define")){$(this).find("i").bind("click",function(){if($(this).attr("data-expand")=="false"){$(this).addClass("fa-caret-up").removeClass("fa-caret-down");$("#"+g+" .wk-user-news-ctrl-con").show()}else{$(this).addClass("fa-caret-down").removeClass("fa-caret-up");$("#"+g+" .wk-user-news-ctrl-con").hide()}});$(".wk-user-mynews").attr("query_type",2).attr("info_type","2");ctrlInfo.getMedia({query_type:2,start_time:0,info_type:2,stock_list:i})}})}}})})}})},getNews:function(a){inforcenter.getRelatedInfo(a,function(){$(".wk-user-news-loading").show();$("#wk-user-news-list").find(".wk-con").empty()},function(b){$(".wk-user-news-loading").hide();var c="";if(b){c=ctrlInfo.buildNews(b.result)}else{c='<div class="wk-user-no"><img src="../static/imgs/i/nonews.png"><span>暂无相关快讯</span></div>'}$("#wk-user-news-list").find(".wk-con").html(c)})},getMedia:function(a){inforcenter.getRelatedInfo(a,function(){$("#wk-user-vpoint-list").find(".wk-con").empty();$(".wk-user-news-loading").show()},function(b){$(".wk-user-news-loading").hide();var c="";if(b){c=ctrlInfo.buildMedia(b.result)}else{c='<div class="wk-user-no"><img src="../static/imgs/i/nonews.png"><span>暂无相关达人观点</span></div>'}$("#wk-user-vpoint-list").find(".wk-con").html(c)})},getFastNews:function(a){inforcenter.getRelatedInfo(a,function(){$("#wk-user-fastnews-list").find(".wk-con").empty();$(".wk-user-news-loading").show()},function(b){$(".wk-user-news-loading").hide();var c="";if(b){c=ctrlInfo.buildFastNews(b.result)}else{c='<div class="wk-user-no"><img src="../static/imgs/i/nonews.png"><span>暂无相关快讯</span></div>'}$("#wk-user-fastnews-list").find(".wk-con").html(c)})},buildNews:function(b){var d=[];if(b.length>0){for(var c=0;c<b.length;c++){d.push('<div class="wk-news-list" id="news_'+b[c].info_id+'" data-news-timestamp="'+b[c].timestamp+'">');d.push('<div class="news-rel-stock">');if(b[c].related_stock.length>0){for(var a=0;a<b[c].related_stock.length;a++){var e=b[c].related_stock[a].stock_name;var f=b[c].related_stock[a].stock_code;if(e!=""&&f!=""){d.push("<a href='../stocks.php?stock="+f+"' target='_blank'>"+e+"("+f+")</a>")}}}d.push("</div>");d.push('<div class="wk-news-list-head">');d.push('<p class="wk-news-list-title"><a href="../detail.php?infoid='+b[c].info_id+'" target="_blank">');d.push(b[c].titile);d.push("</a></p>"+Utility.getgetEmotion(b[c].sentiment)+'</div><div class="wk-news-list-con"><p>');if(b[c].summary!=""){d.push("<strong>【机器人摘要】</strong>");d.push(b[c].summary);d.push('<a href="../detail.php?infoid='+b[c].info_id+'" target="_blank"><i class="fa fa-link"></i>详情链接</a>')}d.push("</p><span>来源："+b[c].from+"&nbsp;&nbsp;&nbsp;&nbsp;"+Utility.unixToDate(b[c].timestamp)+"</span></div><hr></div>")}}else{d.push('<div class="wk-user-no"><img src="../static/imgs/i/nonews.png"><span>暂无相关新闻资讯</span></div>')}return d.join("")},buildMedia:function(c){var a=[];if(c.length>0){for(var d=0;d<c.length;d++){a.push('<div class="wk-news-list" id="media_'+c[d].info_id+'" data-news-timestamp="'+c[d].timestamp+'">');a.push('<div class="news-rel-stock">');if(c[d].related_stock.length>0){for(var b=0;b<c[d].related_stock.length;b++){var e=c[d].related_stock[b].stock_name;var f=c[d].related_stock[b].stock_code;if(e!=""&&f!=""){a.push("<a href='../stocks.php?stock="+f+"' target='_blank'>"+e+"("+f+")</a>")}}}a.push("</div>");a.push('<div class="wk-news-list-head">');a.push('<p class="wk-news-list-title"><a href="../detail.php?infoid='+c[d].info_id+'" target="_blank">');a.push(c[d].titile);a.push("</a></p>"+Utility.getgetEmotion(c[d].sentiment)+'</div><div class="wk-news-list-con"><p>');if(c[d].summary!=""){a.push("<strong>【机器人摘要】</strong>");a.push(c[d].summary);a.push('<a href="../detail.php?infoid='+c[d].info_id+'" target="_blank"><i class="fa fa-link"></i>详情链接</a>')}a.push("</p><span>来源："+c[d].from+"&nbsp;&nbsp;&nbsp;&nbsp;"+Utility.unixToDate(c[d].timestamp)+"</span></div><hr></div>")}}else{a.push('<div class="wk-user-no"><img src="../static/imgs/i/nonews.png"><span>暂无相关达人观点</span></div>')}return a.join("")},buildFastNews:function(c){var e=[];if(c.length>0){for(var d in c){for(var b in c[d]){e.push();e.push('<div class="wk-user-fastnews">');e.push('<span class="wk-user-fastnews-dot">●</span>');e.push('<p class="wk-user-fastnews-todate">'+b+"</p>");e.push("<ul>");for(var a=0;a<c[d][b].length;a++){e.push("<li>");e.push("<label>"+Utility.unixToTime(c[d][b][a].timestamp)+"</label>");e.push("<p>"+c[d][b][a].summary+"</p>");e.push("</li>")}e.push("</ul></div>")}}}else{e.push('<div class="wk-user-no"><img src="../static/imgs/i/nonews.png"><span>暂无相关快讯</span></div>');$(".wk-user-fastnews-list").css("border","none")}return e.join("")},stockRefresh:function(){$(".wk-sub-refresh").click(function(){var a=$(this).attr("data-refresh");ctrlInfo.getGroupStock(a)})}};$(function(){ctrlInfo.getStockPoint();ctrlInfo.searchComplute();ctrlInfo.addMyStockGroup();ctrlInfo.getMyStockGroup();ctrlInfo.getGroupStock("我的自选股");ctrlInfo.stockRefresh();setInterval(ctrlInfo.getNowStockDate,1000);$(".wk-user-mynews .btn-group span:first-child").bind("click",function(){var b=$(this).parent().parent();var c=$(".wk-user-mynews").attr("data-stock");var a=b.attr("data-target");b.addClass("active").siblings().removeClass("active");$("#"+a).show().siblings().hide();if(a=="wk-user-news-list"){$("#"+a).find(".wk-con").html("");ctrlInfo.getNews({query_type:1,start_time:0,info_type:0,stock_list:c});$(".wk-user-mynews").attr("data-query-type",0)}if(a=="wk-user-fastnews-list"){$("#"+a).find(".wk-con").html("");ctrlInfo.getFastNews({query_type:1,start_time:0,info_type:1,stock_list:c});$(".wk-user-mynews").attr("data-query-type",1)}if(a=="wk-user-vpoint-list"){$("#"+a).find(".wk-con").html("");ctrlInfo.getMedia({query_type:1,start_time:0,info_type:2,stock_list:c});$(".wk-user-mynews").attr("data-query-type",2)}});$(window).scroll(function(){var c=$(this).scrollTop();var i=$(document).height();var a=$(this).height();if(c+a+200>=i){var e=$(".wk-user-mynews").attr("data-stock");var d=$(".wk-user-mynews").attr("data-query-type");var f=$(".wk-user-mynews").attr("info-type");if(f==0){var g=$(".wk-user-news-list .wk-con").find(".wk-news-list:last-child");var h=g.attr("id");var b=g.attr("data-news-timestamp");inforcenter.getRelatedInfo({query_type:d,info_type:f,start_time:b,stock_list:e,start_id:h.replace("news_","")},function(){$(".wk-user-news-loading").show()},function(j){$(".wk-user-news-loading").hide();var k=ctrlInfo.buildNews(j.result);$("#wk-user-news-list .wk-con").append(k)})}if(f==1){var g=$(".wk-user-fastnews-list .wk-con").find(".wk-news-list:last-child");var h=g.attr("id");var b=g.attr("data-news-timestamp");inforcenter.getRelatedInfo({query_type:d,info_type:f,start_time:b,stock_list:e,start_id:h.replace("fastnews_","")},function(){$(".wk-user-news-loading").show()},function(j){$(".wk-user-news-loading").hide();var k=ctrlInfo.buildFastNews(j.result);$("#wk-user-fastnews-list .wk-con").append(k)})}if(f==2){var g=$(".wk-user-vpoint-list .wk-con").find(".wk-news-list:last-child");var h=g.attr("id");var b=g.attr("data-news-timestamp");inforcenter.getRelatedInfo({query_type:d,info_type:f,start_time:b,stock_list:e,start_id:h.replace("media_","")},function(){$(".wk-user-news-loading").show()},function(j){$(".wk-user-news-loading").hide();var k=ctrlInfo.buildMedia(j.result);$("#wk-user-vpoint-list .wk-con").append(k)})}}})});