var _choose_stock_list="";$(function(){initEvent.initGroupEvent();initEvent.initAddGroupEvent();$(".wk-user-news-slider i").click(function(){if($(this).attr("data-expand")!="false"){$(this).addClass("fa-chevron-down").removeClass("fa-chevron-up").attr("data-expand",false);$(".wk-user-news-ctrl").hide()}else{$(this).addClass("fa-chevron-up").removeClass("fa-chevron-down").attr("data-expand",true);$(".wk-user-news-ctrl").show()}});$(".wk-user-vpoint-slider i").click(function(){if($(this).attr("data-expand")=="false"){$(this).addClass("fa-chevron-up").removeClass("fa-chevron-down").attr("data-expand",true);$(".wk-user-vpoint-ctrl").show()}else{$(this).addClass("fa-chevron-down").removeClass("fa-chevron-up").attr("data-expand",false);$(".wk-user-vpoint-ctrl").hide()}});$(".wk-user-news-ctrl-head div").click(function(){$(this).addClass("active").siblings().removeClass("active")});$(".wk-user-mynews .btn-group").bind("click",function(c){$(this).addClass("active").siblings().removeClass("active");var b=$(this).attr("data-target");$("#"+b).show().siblings().hide();if(b=="wk-user-news-list"){$("#wk-user-news-list").find(".wk-con").empty();var a={query_type:1,info_type:0,start_time:0,stock_list:_choose_stock_list};getNewsList(a)}if(b=="wk-user-vpoint-list"){$("#wk-user-vpoint-list").find(".wk-con").empty();var a={query_type:1,info_type:2,start_time:0,stock_list:_choose_stock_list};getMediaList(a)}if(b=="wk-user-fastnews-list"){$("#wk-user-fastnews-list").find(".wk-con").empty();var a={query_type:1,info_type:1,start_time:0,stock_list:_choose_stock_list};getFastNewsList(a)}c.stopPropagation()});$(".wk-sub-refresh").click(function(){$(this).addClass("fa-spin");var a=$(this).attr("data-refresh");getGroupStock(a)});$(".wk-user-stock-search").typeahead({minLength:2,maxItem:20,order:"asc",hint:true,group:true,maxItemPerGroup:5,backdrop:false,dynamic:true,filter:false,emptyTemplate:'未找到 "{{query}}" 的相关信息',source:{"股票":{url:["../ajax/ajax_search.php?message={{query}},","stock"]}},callback:{onClickAfter:function(e,b,d){if(d.display!==""){var c=d.display.substring(d.display.indexOf("(")+1,d.display.indexOf(")"));var f=$(".wk-sub-refresh").attr("data-refresh");inforcenter.addStock({ori_name:f,code:c},null,function(a){if(a&&a.status==1){getGroupStock(f)}})}}}});getStockPoint();getMyGroup();getGroupStock("我的自选股");setInterval(_getNowTime,1000);getPlatform()});function getStockPoint(){inforcenter.getStockPoint(function(){$(".wk-user-datas").html("<div class=\"wk-user-no\"><i class='fa fa-refresh fa-spin'></i>&nbsp;正在加载...</div>")},function(a){if(a&&a.status==1){if(a.result.info.index_info.length>0){var d=[];var c=a.result.info.index_info;for(var b=0;b<c.length;b++){d.push('<div class="col-md-4">');d.push('<div class="wk-user-datas-box '+Utility.getUpDownColor(c[b].up_price)+'">');d.push('<p class="wk-user-datas-title">'+c[b].name+"</p><div>");d.push('<p class="wk-user-datas-num">');if(c[b].up_price>0){d.push('<img src="../static/imgs/i/dp_up.png">')}else{if(c[b].up_price<0){d.push('<img src="../static/imgs/i/dp_down.png">')}}d.push(c[b].price);d.push("</p>");d.push('<div class="wk-user-datas-per">');d.push("<p>"+(c[b].up_price>0?"+":"")+(c[b].up_price*100).toFixed(2)+"</p>");d.push("<p>"+(c[b].up_percent>0?"+":"")+(c[b].up_percent*100).toFixed(2)+"%</p>");d.push("</div></div><hr></div></div>")}$(".wk-user-datas").html(d.join(""))}}})}function getMyGroup(){inforcenter.showGroup(null,function(b){if(b&&b.status==1){if(b.result.info.group_name.length>0){var d=b.result.info.group_name;var a=[];a.push('<div class="active" data-group-name="我的自选股">我的自选股</div>');for(var c=0;c<d.length;c++){a.push('<div class="btn-group" data-group-name=\''+d[c]+"'>");a.push("<span>"+d[c]+"</span>");a.push('<span class="dropdown-toggle" data-toggle="dropdown">');a.push('<i class="fa fa-chevron-down"></i>');a.push("</span>");a.push('<ul class="dropdown-menu" data-group-name=\''+d[c]+"'>");a.push('<li class=\'change-name\'><a href="#"><i class="fa fa-pencil fa-fw"></i>更改名称</a></li>');a.push('<li class=\'del-group\'><a href="#"><i class="fa fa-trash-o fa-fw"></i>删除组合</a></li>');a.push("</ul></div>")}$(".wk-user-choose-title").html(a.join(""));initEvent.initChangeGroupNameEvent();initEvent.initDelGroupEvent();initEvent.initGroupEvent()}}})}function getGroupStock(a){inforcenter.showstock({ori_name:a},function(){$(".wk-sub-refresh").addClass("fa-spin");$(".wk-user-mychoose-table table>tbody").html("<tr><td colspan='11'><div class=\"wk-user-no\"><i class='fa fa-refresh fa-spin'></i>&nbsp;正在加载...</div></td></tr>")},function(c){var b=[];var f=[];if(c&&c.status==1){$(".wk-sub-refresh").removeClass("fa-spin");if(c.result.info.group_info.length>0){var e=c.result.info.group_info[0].stock_info;for(var d=0;d<e.length;d++){f.push(e[d].code);b.push("<tr>");b.push("<td>"+e[d].code+"</td>");b.push("<td><a href='../stocks.php?stock="+e[d].code+"' target='_blank'>"+e[d].name+"</a></td>");b.push("<td class='"+Utility.getPriceColor(e[d].price_change_ratio)+"'>"+e[d].trade.toFixed(2)+"</td>");b.push("<td class='"+Utility.getPriceColor(e[d].price_change_ratio)+"'>"+(e[d].price_change_ratio*100).toFixed(2)+"</td>");b.push("<td>"+e[d].volume+"</td>");b.push("<td>"+(e[d].amount*100).toFixed(2)+"%</td>");b.push("<td>"+(e[d].pe*100).toFixed(2)+"%</td>");b.push("<td>"+e[d].visit_hot+"</td>");b.push("<td>"+e[d].search_hot+"</td>");b.push("<td>"+e[d].follow_hot+"</td>");b.push("<td><i class='fa fa-minus-circle text-danger btn-del-stock' data-stock-code='"+e[d].code+"'></i></td>");b.push("</tr>")}_choose_stock_list=f.join("|")+"|"}else{_choose_stock_list="00000x|";b.push('<tr><td colspan=\'11\'><div class="wk-user-no"><img src="../static/imgs/i/nonews.png"><span>您尚未添加自选股</span></div></td></tr>')}}else{b.push('<tr><td colspan=\'11\'><div class="wk-user-no"><img src="../static/imgs/i/nonews.png"><span>您尚未添加自选股</span></div></td></tr>')}$(".wk-user-mychoose-table table>tbody").html(b.join(""));initEvent.initStockTableHoverEvent();initEvent.initGetAllList();$(".wk-user-vpoint-ctrl .user-default").bind("click",function(){var g={query_type:1,info_type:2,start_time:0,stock_list:_choose_stock_list};$("#wk-user-vpoint-list").find(".wk-con").html("");getMediaList(g)});$(".wk-user-news-ctrl .user-default").bind("click",function(){var g={query_type:1,info_type:0,start_time:0,stock_list:_choose_stock_list};$("#wk-user-news-list").find(".wk-con").html("");getNewsList(g)});$(".wk-user-vpoint-ctrl .user-define").bind("click",function(){var g={query_type:2,info_type:2,start_time:0,stock_list:_choose_stock_list};$("#wk-user-vpoint-list").find(".wk-con").html("");getMediaList(g)}).find("i").click(function(){if($(this).attr("data-expand")=="false"){$(this).addClass("fa-caret-up").removeClass("fa-caret-down").attr("data-expand",true);$(".wk-user-vpoint-ctrl .wk-user-news-ctrl-con").show()}else{$(this).addClass("fa-caret-down").removeClass("fa-caret-up").attr("data-expand",false);$(".wk-user-vpoint-ctrl .wk-user-news-ctrl-con").hide()}});$(".wk-user-news-ctrl .user-define").bind("click",function(){var g={query_type:2,info_type:0,start_time:0,stock_list:_choose_stock_list};$("#wk-user-news-list").find(".wk-con").html("");getNewsList(g)}).find("i").bind("click",function(){if($(this).attr("data-expand")=="false"){$(this).addClass("fa-caret-up").removeClass("fa-caret-down").attr("data-expand",true);$(".wk-user-news-ctrl .wk-user-news-ctrl-con").show()}else{$(this).addClass("fa-caret-down").removeClass("fa-caret-up").attr("data-expand",false);$(".wk-user-news-ctrl .wk-user-news-ctrl-con").hide()}})})}function getPlatform(){inforcenter.getPlatform(function(){$(".wk-user-choose-title").append("<div class='btn-group'><i class='fa fa-refresh fa-spin'></i></div>")},function(a){if(a&&a.status==1){var e=a.result[0].news_info_plat;var f=a.result[2].media_info_plat;if(e&&e.length>0){var c=[];for(var b=0;b<e.length;b++){c.push('<div class="con-item">');if(e[b].is_choosed==1){c.push("<label><span class='active'>"+e[b].platform_name+'</span>&nbsp;<i class="fa fa-times-circle" data-platform=\''+e[b].platform_id+"'></i></label>")}else{c.push("<label><span>"+e[b].platform_name+'</span>&nbsp;<i class="fa fa-plus"  data-platform=\''+e[b].platform_id+"'></i></label>")}c.push("</div>")}$(".wk-user-news-list .wk-user-news-ctrl-con").html(c.join(""))}if(f&&f.length>0){var d=[];for(var b=0;b<f.length;b++){d.push('<div class="con-item">');if(f[b].is_choosed==1){d.push("<label><span class='active'>"+f[b].platform_name+'</span>&nbsp;<i class="fa fa-times-circle"  data-platform=\''+f[b].platform_id+"'></i></label>")}else{d.push("<label><span>"+f[b].platform_name+'</span>&nbsp;<i class="fa fa-plus"  data-platform=\''+f[b].platform_id+"'></i></label>")}d.push("</div>")}$(".wk-user-vpoint-ctrl .wk-user-news-ctrl-con").html(d.join(""))}initEvent.initPlatformCtrlEvent();initEvent.initPlatformShowEvent()}})}function _getNowTime(){var d=new Date();var e=d.getHours();var a=d.getMinutes()>10?d.getMinutes():"0"+d.getMinutes();var c=d.getSeconds()>10?d.getSeconds():"0"+d.getSeconds();var b=e+":"+a+":"+c;$(".wk-user-hs").html("<span>沪深</span><span style='"+(Utility.getTradeTime()=="休市"?"":"color:red")+"'>"+Utility.getTradeTime()+"</span>");$(".wk-user-time span:last-child").html(b)}function getNewsList(a){a.info_type=0;inforcenter.getRelatedInfo(a,function(){$(".wk-user-news-loading").show()},function(b){if(b&&b.status==1){$(".wk-user-news-loading").hide();buildNews(b.result)}else{$("#wk-user-news-list").find(".wk-con").html('<div class="wk-user-no"><img src="../static/imgs/i/nonews.png"><span>暂无相关新闻资讯</span></div>')}})}function getMediaList(a){a.info_type=2;inforcenter.getRelatedInfo(a,function(){$(".wk-user-news-loading").show()},function(b){if(b&&b.status==1){$(".wk-user-news-loading").hide();buildMedia(b.result)}else{$("#wk-user-vpoint-list").find(".wk-con").html('<div class="wk-user-no"><img src="../static/imgs/i/nonews.png"><span>暂无相关达人观点资讯</span></div>')}})}function getFastNewsList(a){a.info_type=1;inforcenter.getRelatedInfo(a,function(){$(".wk-user-news-loading").show();$(".wk-user-fastnews-list").css("border","none")},function(b){if(b&&b.status==1){$(".wk-user-news-loading").hide();buildFastNews(b.result)}else{$("#wk-user-fastnews-list .wk-con").html('<div class="wk-user-no"><img src="../static/imgs/i/nonews.png"><span>暂无相关快讯</span></div>')}})}function buildNews(b){var d=[];if(b.length>0){for(var c=0;c<b.length;c++){d.push('<div class="wk-news-list" id="news_'+b[c].info_id+'" data-news-timestamp="'+b[c].timestamp+'">');d.push('<div class="news-rel-stock">');if(b[c].related_stock.length>0){for(var a=0;a<b[c].related_stock.length;a++){var e=b[c].related_stock[a].stock_name;var f=b[c].related_stock[a].stock_code;if(e!=""&&f!=""){d.push("<a href='../stocks.php?stock="+f+"' target='_blank'>"+e+"("+f+")</a>")}}}d.push("</div>");d.push('<div class="wk-news-list-head">');d.push('<p class="wk-news-list-title"><a href="../detail.php?infoid='+b[c].info_id+'" target="_blank">');d.push(b[c].titile);d.push("</a></p>"+Utility.getgetEmotion(b[c].sentiment)+'</div><div class="wk-news-list-con"><p>');if(b[c].summary!=""){d.push("<strong>【机器人摘要】</strong>");d.push(b[c].summary);d.push('<a href="../detail.php?infoid='+b[c].info_id+'" target="_blank"><i class="fa fa-link"></i>详情链接</a>')}d.push("</p><span>来源："+b[c].from+"&nbsp;&nbsp;&nbsp;&nbsp;"+Utility.unixToDate(b[c].timestamp)+"</span></div><hr></div>")}}else{d.push('<div class="wk-user-no"><img src="../static/imgs/i/nonews.png"><span>暂无相关新闻资讯</span></div>')}$("#wk-user-news-list").find(".wk-con").html(d.join(""))}function buildMedia(c){var a=[];if(c.length>0){for(var d=0;d<c.length;d++){a.push('<div class="wk-news-list" id="media_'+c[d].info_id+'" data-news-timestamp="'+c[d].timestamp+'">');a.push('<div class="news-rel-stock">');if(c[d].related_stock.length>0){for(var b=0;b<c[d].related_stock.length;b++){var e=c[d].related_stock[b].stock_name;var f=c[d].related_stock[b].stock_code;if(e!=""&&f!=""){a.push("<a href='../stocks.php?stock="+f+"' target='_blank'>"+e+"("+f+")</a>")}}}a.push("</div>");a.push('<div class="wk-news-list-head">');a.push('<p class="wk-news-list-title"><a href="../detail.php?infoid='+c[d].info_id+'" target="_blank">');a.push(c[d].titile);a.push("</a></p>"+Utility.getgetEmotion(c[d].sentiment)+'</div><div class="wk-news-list-con"><p>');if(c[d].summary!=""){a.push("<strong>【机器人摘要】</strong>");a.push(c[d].summary);a.push('<a href="../detail.php?infoid='+c[d].info_id+'" target="_blank"><i class="fa fa-link"></i>详情链接</a>')}a.push("</p><span>来源："+c[d].from+"&nbsp;&nbsp;&nbsp;&nbsp;"+Utility.unixToDate(c[d].timestamp)+"</span></div><hr></div>")}}else{a.push('<div class="wk-user-no"><img src="../static/imgs/i/nonews.png"><span>暂无相关达人观点</span></div>')}$("#wk-user-vpoint-list .wk-con").html(a.join(""))}function buildFastNews(c){var e=[];if(c.length>0){for(var d in c){for(var b in c[d]){e.push();e.push('<div class="wk-user-fastnews">');e.push('<span class="wk-user-fastnews-dot">●</span>');e.push('<p class="wk-user-fastnews-todate">'+b+"</p>");e.push("<ul>");for(var a=0;a<c[d][b].length;a++){e.push("<li>");e.push("<label>"+Utility.unixToTime(c[d][b][a].timestamp)+"</label>");e.push("<p>"+c[d][b][a].summary+"</p>");e.push("</li>")}e.push("</ul></div>")}}}else{e.push('<div class="wk-user-no"><img src="../static/imgs/i/nonews.png"><span>暂无相关快讯</span></div>');$(".wk-user-fastnews-list").css("border","none")}$("#wk-user-fastnews-list .wk-con").html(e.join(""))}var initEvent={initGroupEvent:function(){$(".wk-user-choose-title div").click(function(){$(this).addClass("active").siblings().removeClass("active");var a=$(this).attr("data-group-name");$(".wk-sub-refresh").attr("data-refresh",a);getGroupStock(a)})},initChangeGroupNameEvent:function(){$(".change-name").bind("click",function(){var a=$(this).parent().attr("data-group-name");swal({title:"更改名称【"+a+"】",text:"组合名称不能超过6个汉字或12个字符",type:"input",html:true,showCancelButton:true,closeOnConfirm:false,confirmButtonText:"确定",cancelButtonText:"取消",animation:"slide-from-top",inputPlaceholder:"请输入组合名称"},function(b){if(b===false){return false}if(b===""){swal.showInputError("请输入组合名称");return false}if(Utility.getByteLen(b)>12){swal.showInputError("字符数超过限制");return false}inforcenter.modifyGroup({ori_name:a,cur_name:b},null,function(c){if(c.status==1){swal({title:"",text:"修改组合<span style='color: #F8BB86'>"+a+"</span>为<span style='color: #F8BB86'>"+b+"</span>成功",html:true,timer:1000,showConfirmButton:false});getMyGroup()}})})})},initDelGroupEvent:function(){$(".del-group").bind("click",function(){var a=$(this).parent().attr("data-group-name");swal({title:"",text:"确定删除<span style='color: #F8BB86'>"+a+"</span>吗?此操作将无法恢复!",type:"warning",html:true,showCancelButton:true,confirmButtonColor:"#DD6B55",confirmButtonText:"确定",cancelButtonText:"取消",closeOnConfirm:false,closeOnCancel:true},function(b){if(b){inforcenter.delGroup({ori_name:a},null,function(c){if(c.status==1){swal({title:"",text:"组合<span style='color: #F8BB86'>"+a+"</span>已被删除",html:true,timer:1000,showConfirmButton:false});getMyGroup()}})}})})},initAddGroupEvent:function(){$(".wk-add-zh").click(function(){swal({title:"添加组合",text:"组合名称不能超过6个汉字或12个字符",type:"input",html:true,showCancelButton:true,closeOnConfirm:false,confirmButtonText:"确定",cancelButtonText:"取消",animation:"slide-from-top",inputPlaceholder:"请输入组合名称"},function(a){if(a===false){return false}if(a===""){swal.showInputError("请输入组合名称");return false}if(Utility.getByteLen(a)>12){swal.showInputError("字符数超过限制");return false}inforcenter.addGroup({ori_name:a},null,function(b){if(b.status==1){swal({title:"",text:"添加<span style='color: #F8BB86'>"+a+"</span>组合成功",html:true,timer:1000,showConfirmButton:false});getMyGroup()}else{swal({title:"",text:"添加<span style='color: #F8BB86'>"+a+"</span>组合异常",html:true,timer:1000,showConfirmButton:false})}})})})},initStockTableHoverEvent:function(){$(".wk-user-mychoose-table table>tbody>tr").hover(function(){var a=$(this).find("td:nth-child(2)").html();$(this).find(".btn-del-stock").show().bind("click",function(){var c=$(this).attr("data-stock-code");var b=$(".wk-sub-refresh").attr("data-refresh");swal({title:"",text:"确定删除<span style='color: #F8BB86'>"+a+"("+c+")</span>吗?此操作将无法恢复!",type:"warning",html:true,showCancelButton:true,confirmButtonColor:"#DD6B55",confirmButtonText:"确定",cancelButtonText:"取消",closeOnConfirm:false,closeOnCancel:true},function(d){if(d){inforcenter.delStock({ori_name:b,code:c},null,function(e){if(e.status==1){swal({title:"",text:"<span style='color:#F8BB86'>"+a+"("+c+")</span>已被删除",html:true,timer:1000,showConfirmButton:false});getGroupStock(b)}})}})})},function(){$(this).find(".btn-del-stock").hide()})},initPlatformShowEvent:function(){$(".wk-user-news-ctrl-con div").hover(function(){$(this).find("i").show()},function(){$(this).find("i").hide()})},initPlatformCtrlEvent:function(){$(".con-item i").each(function(){$(this).bind("click",function(c){var b=$(this);var a=b.attr("data-platform");if(b.hasClass("fa-times-circle")){inforcenter.delUserPlatform({plat_id:a},null,function(d){if(d.status==1){b.removeClass("fa-times-circle").addClass("fa-plus").siblings().removeClass("active")}})}else{inforcenter.addUserPlatform({plat_id:a},null,function(d){if(d.status==1){b.removeClass("fa-plus").addClass("fa-times-circle").siblings().addClass("active")}})}initEvent.initGetAllList();getGroupStock("我的自选股");c.stopPropagation()})})},initGetAllList:function(){var c=$(".wk-user-mynews .btn-group");for(var b=0;b<c.length;b++){if($(c[b]).hasClass("active")){var a=$(c[b]).attr("data-target");if(a=="wk-user-news-list"){$("#"+a).find(".wk-con").empty();let _arrData={query_type:1,info_type:0,start_time:0,stock_list:_choose_stock_list};getNewsList(_arrData)}if(a=="wk-user-vpoint-list"){$("#"+a).find(".wk-con").empty();let _arrData={query_type:1,info_type:2,start_time:0,stock_list:_choose_stock_list};getMediaList(_arrData)}if(a=="wk-user-fastnews-list"){$("#"+a).find(".wk-con").empty();let _arrData={query_type:1,info_type:1,start_time:0,stock_list:_choose_stock_list};getFastNewsList(_arrData)}}}}};