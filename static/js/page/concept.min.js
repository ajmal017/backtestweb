"use strict";(function(g,j,l){var b=Utility.getQueryStringByName("name");var q=["0:00","1:00","2:00","3:00","4:00","5:00","6:00","7:00","8:00","9:00","10:00","11:00","12:00","13:00","14:00","15:00","16:00","17:00","18:00","19:00","20:00","21:00","22:00","23:00","24：00"];var e,d=[],h=[],m=[];var k=echarts.init(l.getElementById("left-chart"));k.showLoading({text:"加载中..."});function a(){common.getHyAndGnHot({name:b,query_type:2,hour_data:"concept"},null,function(t){if(t.status==1){var u=[];var r=[];if(t.visit){var A=0;for(var F in t.visit){d.push(t.visit[F]);A++}d=JSON.parse("["+d.join(",")+"]");var E=Math.max.apply(Math,d);var x=d.indexOf(Math.max.apply(Math,d));r.push("<tr><td>查看</td><td>"+d[d.length-1]+"</td><td>"+(Utility.getNowFormatDate()+" "+(A-1)+":00")+"</td></tr>");u.push("<tr><td>查看</td><td>"+E+"</td><td>"+Utility.calTime(x)+"</td></tr>")}if(t.search){var w=0;for(var H in t.search){h.push(t.search[H]);w++}h=JSON.parse("["+h.join(",")+"]");var G=Math.max.apply(Math,h);var y=h.indexOf(Math.max.apply(Math,h));r.push("<tr><td>搜索</td><td>"+h[h.length-1]+"</td><td>"+(Utility.getNowFormatDate()+" "+(w-1)+":00")+"</td></tr>");u.push("<tr><td>搜索</td><td>"+G+"</td><td>"+Utility.calTime(y)+"</td></tr>")}if(t.follow){var D=0;for(var C in t.follow){m.push(t.follow[C]);D++}m=JSON.parse("["+m.join(",")+"]");var B=Math.max.apply(Math,m);var z=m.indexOf(Math.max.apply(Math,m));r.push("<tr><td>关注</td><td>"+m[m.length-1]+"</td><td>"+(Utility.getNowFormatDate()+" "+(D-1)+":00")+"</td></tr>");u.push("<tr><td>关注</td><td>"+B+"</td><td>"+Utility.calTime(z)+"</td></tr>")}g(".todayhot").html(u.join(""));g(".latesthot").html(r.join(""));common.getLineChart("left-chart",q,d,h,m)}})}function p(){if(!e){common.getTopTwentyStock({hottype:"gn",hotval:b},function(){var r=echarts.init(l.getElementById("wk-stock-view-treemap"));r.showLoading({text:"加载中..."});g("#concept-view .wk-hot-table tbody").html("<tr><td colspan='5'>加载中...</td></tr>")},function(r){if(r.status==1){i(r);e=r}})}else{i(e)}}function i(t){if(t.result.code_info.shv_.length>0){var u=t.result.code_info.shv_;var w=t.result.code_info.suv_;g("#concept-view .wk-hot-table tbody").html(common.buildHotmapTable(u,"stock"));var y=Utility.buildMapTable(w);g("#concept-view .right .toggle-treemap-table-up tbody").html(common.buildStockTable(y._up));g("#concept-view .right .toggle-treemap-table-down tbody").html(common.buildStockTable(y._down));common.buildHotmap("wk-stock-view-treemap",y._map,"stock")}if(t.result.code_info.shs_.length>0){var v=t.result.code_info.shs_;var r=t.result.code_info.sus_;g("#concept-search .wk-hot-table tbody").html(common.buildHotmapTable(v,"stock"));var y=Utility.buildMapTable(r);g("#concept-search .right .toggle-treemap-table-up tbody").html(common.buildStockTable(y._up));g("#concept-search .right .toggle-treemap-table-down tbody").html(common.buildStockTable(y._down));common.buildHotmap("wk-stock-search-treemap",y._map,"stock")}if(t.result.code_info.shf_.length>0){var x=t.result.code_info.shf_;var s=t.result.code_info.suf_;g("#concept-follow .wk-hot-table tbody").html(common.buildHotmapTable(x,"stock"));var y=Utility.buildMapTable(s);g("#concept-search .right .toggle-treemap-table-up tbody").html(common.buildStockTable(y._up));g("#concept-search .right .toggle-treemap-table-down tbody").html(common.buildStockTable(y._down));common.buildHotmap("wk-stock-follow-treemap",y._map,"stock")}}function o(){var s=echarts.init(l.getElementById("wk-rate-line-pic"));var r={query_type:"concept",query_key:b,query_date:"today"};common.getRateLine(r,function(){s.showLoading({text:"加载中..."})},function(t){common.buildRateLine(decodeURI(b),"today",t);s.hideLoading()})}function c(){common.initRelateSHG(3,b,function(r){if(r&&r.status==1){common.buildReleatedInfoChart(b,r)}})}function n(){g(".modal-chart").modal("show");var r=echarts.init(l.getElementById("modal-chart"));common.getHyAndGnHot({name:b,query_type:2},function(){r.showLoading({text:"加载中..."})},function(w){r.hideLoading();var u=[];var x=[];if(w.status==1){if(w.visit){for(var t in w.visit){u.push(w.visit[t]);x.push('"'+Utility.numToTime(t)+'"')}x=JSON.parse("["+x.join(",")+"]");u=JSON.parse("["+u.join(",")+"]")}var s=echarts.init(l.getElementById("modal-chart"));s.showLoading({text:"加载中..."});s.setOption({color:["rgb(243, 104, 97)"],tooltip:{trigger:"axis",formatter:function(z){var v="";v+=z[0].name+"<br>";for(var y in z){if(z[y].value&&z[y].value!=0){if(z[0].name==z[y].name){v+="<label style='color: "+z[y].color+";font-size: 14x;'>●</label>&nbsp;&nbsp;"+z[y].seriesName+":"+Utility.formatNum(z[y].value)+"<br>"}}}return v}},dataZoom:[{type:"inside",realtime:true},{type:"slider",show:true,realtime:true}],grid:{top:10,left:20,right:20,bottom:40,containLabel:true},legend:{left:"left"},xAxis:{type:"category",boundaryGap:false,data:x},yAxis:{type:"value",position:"right",scale:true},calculable:false,series:[{name:"查看",type:"line",smooth:true,data:u}]});s.hideLoading();j.onresize=s.resize}})}var f={query_type:3,key:b,start_id:0,info_type_list:"",start_time:0};g(".nav-tabs li a").bind("click",function(){if(g(this).attr("href").indexOf("#wk-selfmedia")==0){if(g("#mCSB_2_container").html().trim()==""){f.start_id=0;common.getSelfMedia(f,true)}}if(g(this).attr("href").indexOf("#wk-newsflash")==0){if(g("#wk-newsflash table>tbody").html().trim()==""){f.start_id=0;common.getFastNews(f,true)}}if(g(this).attr("href").indexOf("#wk-notice")==0){if(g("#mCSB_4_container").html().trim()==""){f.start_id=0;common.getNotice(f,true)}}if(g(this).attr("href").indexOf("#wk-report")==0){if(g("#mCSB_5_container").html().trim()==""){f.start_id=0;common.getReports(f,true)}}});g('.wk-hotmap a[data-toggle="tab"]').on("shown.bs.tab",function(){p()});g("#wk-news").mCustomScrollbar({autoHideScrollbar:true,theme:"minimal-dark",axis:"y",callbacks:{onTotalScroll:function(){if(g("#wk-news .wk-news-list:last").attr("id")){f.start_id=g("#wk-news .wk-news-list:last").attr("id").replace("news_","");f.info_type_list="1,0,0,0,0,0";f.timestamp=g("#wk-news .wk-news-list:last").attr("data-news-timestamp");common.getNews(f)}}}});g("#wk-selfmedia").mCustomScrollbar({autoHideScrollbar:true,theme:"minimal-dark",axis:"y",callbacks:{onTotalScroll:function(){if(g("#wk-selfmedia .wk-news-list:last").attr("id")){f.start_id=g("#wk-selfmedia .wk-news-list:last").attr("id").replace("media_","");f.info_type_list="0,0,1,0,0,0";f.timestamp=g("#wk-selfmedia .wk-news-list:last").attr("data-media-timestamp");common.getSelfMedia(f)}}}});g("#wk-newsflash").mCustomScrollbar({autoHideScrollbar:true,theme:"minimal-dark",axis:"y",callbacks:{onTotalScroll:function(){if(g("#wk-newsflash .wk-user-fastnews:last-child").find("ul li:last-child").attr("id")){f.start_id=g("#wk-newsflash .wk-user-fastnews:last-child").find("ul li:last-child").attr("id").replace("fast_","");f.info_type_list="0,1,0,0,0,0";f.timestamp=g("#wk-newsflash  .wk-user-fastnews:last-child").find("ul li:last-child").attr("data-fastnews-timestamp");common.getFastNews(f)}}}});g("#wk-notice").mCustomScrollbar({autoHideScrollbar:true,theme:"minimal-dark",axis:"y",callbacks:{onTotalScroll:function(){if(g("#wk-notice .wk-news-list:last").attr("id")){f.start_id=g("#wk-notice .wk-news-list:last").attr("id").replace("notice_","");f.info_type_list="0,0,0,0,0,0,1";f.timestamp=g("#wk-notice .wk-news-list:last").attr("data-news-timestamp");common.getNotice(f)}}}});g("#wk-report").mCustomScrollbar({autoHideScrollbar:true,theme:"minimal-dark",axis:"y",callbacks:{onTotalScroll:function(){if(g("#wk-report .wk-news-list:last").attr("id")){f.start_id=g("#wk-report .wk-news-list:last").attr("id").replace("report_","");f.info_type_list="0,0,0,0,0,0,0,1";f.timestamp=g("#wk-report .wk-news-list:last").attr("data-news-timestamp");common.getReports(f)}}}});g(".wk-line-toggle a").click(function(){g(this).addClass("line-active").siblings().removeClass("line-active");var t=g(this).parent().attr("data-query-type");var s=g(this).parent().attr("data-query-key");var u=g(this).attr("data-key");var r={query_type:t,key_name:s,time_type:u};if(u=="minute"){n();return}if(u=="day"){common.getLineChart("left-chart",q,d,h,m)}else{common.getHotRecord(r,function(){var v=echarts.init(l.getElementById("left-chart"));v.showLoading({text:"加载中..."})},function(x){var z=[];var B=[];var C=[];var y=[];if(x.status==1){for(var E in x.visit){for(var D in x.visit[E]){y.push(D);z.push(x.visit[E][D])}}for(var G in x.search){for(var F in x.search[G]){B.push(x.search[G][F])}}for(var A in x.follow){for(var w in x.follow[A]){C.push(x.follow[A][w])}}}common.getLineChart("left-chart",y,z,B,C)})}});g(".treemap-toggle span").click(function(){g(this).addClass("treemap-active").siblings().removeClass("treemap-active");var r=g(this).parent().parent().parent();if(g(this).html()=="热力图"){r.find(".toggle-treemap").show();r.find(".toggle-treemap-table-up").hide();r.find(".toggle-treemap-table-down").hide()}else{if(g(this).html()=="涨幅"){r.find(".toggle-treemap").hide();r.find(".toggle-treemap-table-up").show();r.find(".toggle-treemap-table-down").hide()}else{if(g(this).html()=="跌幅"){r.find(".toggle-treemap").hide();r.find(".toggle-treemap-table-up").hide();r.find(".toggle-treemap-table-down").show()}}}});g(".wk-rate-select label").click(function(){g(this).addClass("active").siblings().removeClass("active");var v=g(this).parent().attr("data-query-name");var t=g(this).parent().attr("data-query-type");var r=g(this).attr("data-toggle");var u=echarts.init(l.getElementById("wk-rate-line-pic"));var s={query_type:t,query_key:v,query_date:r};if(t=="stock"){if(_stockName){v=_stockName}}switch(r){case"today":common.getRateLine(s,function(){u.showLoading({text:"加载中..."})},function(w){common.buildRateLine(v,r,w);u.hideLoading()});break;case"week":common.getRateLine(s,function(){u.showLoading({text:"加载中..."})},function(w){common.buildRateLine(v,r,w);u.hideLoading()});break;case"month":common.getRateLine(s,function(){u.showLoading({text:"加载中..."})},function(w){common.buildRateLine(v,r,w);u.hideLoading()});break;case"threemonth":common.getRateLine(s,function(){u.showLoading({text:"加载中..."})},function(w){common.buildRateLine(v,r,w);u.hideLoading()});break;default:break}});common.getNews(f,true);c();a();p();o();common.initdoubleLine(3,b)})(jQuery,window,document);