"use strict";var common={login:function(a,b,c){$.ajax({url:"ajax/login/user_login.php",type:"post",dataType:"json",cache:false,data:a,beforeSend:function(){b&&b()},success:function(d){c&&c(d)}})},getPlatformList:function(a,b){$.ajax({url:"ajax/login/get_platform_info.php",type:"post",dataType:"json",cache:false,beforeSend:function(){a&&a()},success:function(c){b&&b(c)}})},getTopTwentyStock:function(a,b,c){$.ajax({url:"ajax/ajax_get_hot_data.php",type:"post",dataType:"json",cache:false,data:a,beforeSend:function(){b&&b()},success:function(d){c&&c(d)}})},getRelatedInfo:function(a,b,c){$.ajax({url:"ajax/ajax_get_related_info.php",dataType:"json",type:"post",data:a,beforeSend:function(){b&&b()},success:function(d){c&&c(d)}})},getNews:function(a){a.info_type_list="1,0,0,0,0,0";common.getRelatedInfo(a,function(){$("#wk-news").append(common.getLoading())},function(b){var e=[];var d=parseInt(($(".wk-news-title-num:last").html()==""?0:$(".wk-news-title-num:last").html()));if(b.news.length>0){common.hideLoading();for(var c=0;c<b.news.length;c++){e.push('<div class="wk-news-list" id="news_'+b.news[c].info_id+'" data-news-timestamp="'+b.news[c].timestamp+'">');e.push('<div class="wk-news-list-head">');e.push('<p class="wk-news-list-title"><a href="detail.php?infoid='+b.news[c].info_id+'" target="_blank">');e.push(b.news[c].title);e.push("</a></p>"+Utility.getgetEmotion(b.news[c].sentiment)+'</div><div class="wk-news-list-con"><p>');if(b.news[c].summary!=""){e.push("<strong>【机器人摘要】</strong>");e.push(b.news[c].summary);e.push('<a href="detail.php?infoid='+b.news[c].info_id+'" target="_blank"><i class="fa fa-link"></i>详情链接</a>')}e.push("</p><span>来源："+b.news[c].from+"&nbsp;&nbsp;&nbsp;&nbsp;"+Utility.unixToDate(b.news[c].timestamp)+"</span></div><hr></div>")}$("#wk-news .mCSB_container").append(e.join(""))}else{if(a.start_id==0){common.hideLoading();e.push('<div class="wk-news-no"><img src="static/imgs/i/nonews.png"><span>暂无相关新闻资讯</span></div>');$("#wk-news .mCSB_container").html(e.join(""))}else{common.hideLoading()}}})},getSelfMedia:function(a){a.info_type_list="0,0,1,0,0,0";common.getRelatedInfo(a,function(){$("#wk-selfmedia").append(common.getLoading())},function(c){var b=[];if(c.me_media.length>0){common.hideLoading();for(var d=0;d<c.me_media.length;d++){b.push('<div class="wk-news-list" id="media_'+c.me_media[d].info_id+'" data-media-timestamp="'+c.me_media[d].timestamp+'"><div class="wk-news-list-head">');b.push('<p class="wk-news-list-title">');b.push('<a href="detail.php?infoid='+c.me_media[d].info_id+'" target="_blank">'+c.me_media[d].title+"</a></p>");b.push(Utility.getgetEmotion(c.me_media[d].sentiment));b.push('</div><div class="wk-news-list-con"><p>');if(c.me_media[d].summary!=""){b.push("<strong>【机器人摘要】</strong>");b.push(c.me_media[d].summary);b.push('<a href="detail.php?infoid='+c.me_media[d].info_id+'" target="_blank"> <i class="fa fa-link"></i>详情链接</a>')}b.push("</p><span>来源："+c.me_media[d].from+"&nbsp;&nbsp;&nbsp;&nbsp;"+Utility.unixToDate(c.me_media[d].timestamp)+"</span></div><hr></div>")}$("#wk-selfmedia .mCSB_container").append(b.join(""))}else{if(a.start_id==0){common.hideLoading();b.push('<div class="wk-news-no"><img src="static/imgs/i/nonews.png"><span>暂无相关达人观点</span></div>');$("#wk-selfmedia .mCSB_container").html(b.join(""))}else{common.hideLoading()}}})},getFastNews:function(a){a.info_type_list="0,1,0,0,0,0";common.getRelatedInfo(a,function(){$("#wk-newsflash").append(common.getLoading())},function(b){var d=[];if(b.fast_info.length>0){common.hideLoading();for(var c=0;c<b.fast_info.length;c++){d.push("<tr id='fast_"+b.fast_info[c].info_id+"' data-fastnews-timestamp=\""+b.fast_info[c].timestamp+'"><td><label>');d.push(Utility.unixToDate(b.fast_info[c].timestamp).substring(10,16));d.push("</label></td><td>");d.push(b.fast_info[c].summary);d.push("</td></tr>")}$("#wk-newsflash .wk-news-list table>tbody").append(d.join(""))}else{if(a.start_id==0){common.hideLoading();d.push('<div class="wk-news-no"><img src="static/imgs/i/nonews.png"><span>暂无相关快讯</span></div>');$("#wk-newsflash .mCSB_container").html(d.join(""))}else{common.hideLoading()}}})},getLineChart:function(f,a,d,e,c){var b=echarts.init(document.getElementById(f));b.showLoading();b.setOption({color:["rgb(243, 104, 97)","rgb(76, 93, 186)","rgb(118, 172, 245)"],tooltip:{trigger:"axis",formatter:function(i){var g="";g+=i[0].name+"<br>";for(var h in i){if(i[h].value&&i[h].value!=0){if(i[0].name==i[h].name){g+="<label style='color: "+i[h].color+";font-size: 18px;'>●</label>&nbsp;&nbsp;"+i[h].seriesName+":"+Utility.formatNum(i[h].value)+"<br>"}}}return g}},grid:{top:"12%",left:"6%",right:"5%",bottom:"0",containLabel:true},legend:{left:"left",data:["查看","搜索","关注"],padding:[0,0,0,15]},xAxis:{type:"category",boundaryGap:false,data:a},yAxis:{type:"value",position:"right",scale:true,min:"dataMin",max:"dataMax"},calculable:false,series:[{name:"查看",type:"line",smooth:true,data:d},{name:"搜索",type:"line",smooth:true,data:e},{name:"关注",type:"line",smooth:true,data:c}]});b.hideLoading();window.onresize=b.resize},getTreemap:function(wk_treemap_data){for(var x in wk_treemap_data){if(Utility.timeRange("09:15","09:25")){$("#"+wk_treemap_data[x].key).html('<div class="wk-hotmap-no"><img src="static/imgs/i/nonews.png"><span>自由竞价时间,暂无数据</span></div>')}else{var myChart=echarts.init(document.getElementById(""+wk_treemap_data[x].key+""));var cdata=[];for(var y in wk_treemap_data[x].value){if(wk_treemap_data[x].key.indexOf("wk-stock")==0){var tname=wk_treemap_data[x].value[y].name;var tcode=wk_treemap_data[x].value[y].code;var tvalue=(parseFloat(wk_treemap_data[x].value[y].value)*100).toFixed(2);var tpricelevel=wk_treemap_data[x].value[y].price_level;var tstop=wk_treemap_data[x].value[y].stop;if(tstop==1){cdata.push('{name:"'+tname+"\\n("+tcode+")\\n"+(tvalue>0?"+":"")+tvalue+'%"')}else{cdata.push('{name:"'+tname+"\\n("+tcode+")\\n"+(tvalue>0?"+":"")+tvalue+'%"')}cdata.push("value:"+wk_treemap_data[x].value[y].count);cdata.push("itemStyle:{normal:{color:'"+Utility.getTreeMapColor(tpricelevel)+"'}}");if(tpricelevel==-1){cdata.push("label:{normal:{textStyle:{color:'#23a64c'}}}}")}else{if(tpricelevel==1){cdata.push("label:{normal:{textStyle:{color:'#f54545'}}}}")}else{cdata.push("label:{normal:{textStyle:{color:'#fff'}}}}")}}}else{var tsvalue=(parseFloat(wk_treemap_data[x].value[y].value)*100).toFixed(2);cdata.push('{name:"'+wk_treemap_data[x].value[y].name+"\\n"+(tsvalue>0?"+":"")+tsvalue+'%"');cdata.push("value:"+wk_treemap_data[x].value[y].count);cdata.push("itemStyle:{normal:{color:'"+Utility.getTreeMapColor(wk_treemap_data[x].value[y].price_level)+"'}}");if(wk_treemap_data[x].value[y].price_level==-1){cdata.push("label:{normal:{textStyle:{color:'#23a64c'}}}}")}else{if(wk_treemap_data[x].value[y].price_level==1){cdata.push("label:{normal:{textStyle:{color:'#f54545'}}}}")}else{cdata.push("label:{normal:{textStyle:{color:'#fff'}}}}")}}}}myChart.setOption({tooltip:{formatter:"{b}"},series:[{type:"treemap",breadcrumb:{show:false},roam:false,nodeClick:"link",width:"100%",height:"100%",itemStyle:{normal:{borderWidth:1}},data:eval("["+cdata.join(",")+"]")}]});window.onresize=myChart.resize}}},getHotRecord:function(a,b,c){$.ajax({url:"ajax/ajax_get_hotrecord.php",type:"post",dataType:"json",cache:false,data:a,beforeSend:function(){b&&b()},success:function(d){c&&c(d)}})},getRealTimeHot:function(a,b,c){$.ajax({url:"ajax/ajax_get_real_time_hot.php",type:"post",dataType:"json",cache:false,data:a,beforeSend:function(){b&&b()},success:function(d){c&&c(d)}})},getSingleRealTimeHot:function(a,b,c){$.ajax({url:"ajax/ajax_get_single_real_time_hot.php",type:"post",dataType:"json",cache:false,data:a,beforeSend:function(){b&&b()},success:function(d){c&&c(d)}})},getHyAndGnHot:function(a,b,c){$.ajax({url:"ajax/ajax_get_hy_and_gn_hot.php",type:"post",dataType:"json",cache:false,data:a,beforeSend:function(){b&&b()},success:function(d){c&&c(d)}})},getStockBase:function(a,b,c){$.ajax({url:"ajax/ajax_get_stock_base.php",type:"post",dataType:"json",cache:false,data:a,beforeSend:function(){b&&b()},success:function(d){c&&c(d)}})},getRelateSHG:function(a,b,c){$.ajax({url:"ajax/ajax_get_relate_shg.php",type:"post",dataType:"json",cache:false,data:a,beforeSend:function(){b&&b()},success:function(d){c&&c(d)}})},getRateLine:function(a,b,c){$.ajax({url:"ajax/ajax_get_rateline.php",type:"post",dataType:"json",cache:false,data:a,beforeSend:function(){b&&b()},success:function(d){c&&c(d)}})},buildRateLine:function(k,m,l){var a=[];var g=[];var d=[];if(l.body&&l.body.list.length>0){var h=l.body.list;if(m==="today"){for(var e=0;e<h.length;e++){a.push(Utility.unixToTime(h[e].trade_time*1000));g.push(h[e].day_yield);d.push(h[e].hs300_day_yield)}}else{for(var c=0;c<h.length;c++){a.push(h[c].date);g.push(h[c].adjusted_day_yield);d.push(h[c].hs300_adjusted_day_yield)}}}var b=echarts.init(document.getElementById("wk-rate-line-pic"));var f={tooltip:{trigger:"axis"},color:["rgb(151,47,134)","rgb(65,77,92)"],legend:{data:[k,"沪深300"],bottom:"0"},grid:{top:"8px",left:"0",right:"0",bottom:"10%",containLabel:true},xAxis:{type:"category",boundaryGap:false,data:a},yAxis:{type:"value",position:"right"},series:[{name:k,type:"line",smooth:true,data:JSON.parse("["+g.reverse()+"]")},{name:"沪深300",type:"line",smooth:true,data:JSON.parse("["+d.reverse()+"]")}]};b.setOption(f);window.onresize=b.resize},buildStockTable:function(a){var c=[];a.sort(function(f,e){return e.value-f.value});for(var d=0;d<a.length;d++){var b=a[d].value;c.push("<tr>");c.push("<td>"+(d+1)+"</td>");c.push("<td><a href='stocks.php?stock="+a[d].code+"' target='_blank'>"+a[d].name+"</a></td>");c.push("<td class='"+common.getUpDownColor(a[d].price_level)+"'>"+a[d].price+"</td>");c.push("<td class='"+common.getUpDownColor(a[d].price_change_ratio)+"'>"+(a[d].price_change_ratio*100).toFixed(2)+"%</td>");c.push("<td>"+a[d].hot+"</td>");c.push("<td class='"+common.getUpDownColor(b)+"'>"+(b>0?"+":"")+b+"</td>");c.push("<td>"+a[d].count+"</td>");c.push("</tr>")}return c.join("")},buildOtherTable:function(b,a){var d=[];b.sort(function(g,f){return f.value-g.value});for(var e=0;e<b.length;e++){var c=b[e].value;d.push("<tr>");d.push("<td>"+(e+1)+"</td>");d.push("<td><a href='"+a+".php?name="+b[e].name+"' target='_blank'>"+b[e].name+"</a></td>");d.push("<td>"+b[e].hot+"</td>");d.push("<td class='"+common.getUpDownColor(c)+"'>"+(c>0?"+":"")+c+"</td>");d.push("<td>"+b[e].count+"</td>");d.push("</tr>")}return d.join("")},buildHotmapTable:function(b,a){var d=[];if(b.length>0){if(a=="stock"){for(var c=0;c<b.length;c++){d.push("<tr><td>"+(c+1)+"</td>");d.push('<td><a href="stocks.php?stock='+b[c].code+'" target="_blank">'+b[c].name+"</a></td>");d.push("<td>"+b[c].value+"</td>");d.push("<td>"+b[c].increment+Utility.getHotUpDown(b[c].increment)+"</td>");d.push('<td class="'+Utility.getPriceColor(b[c].mark_z_d)+'">'+b[c].price+"</td></tr>")}}else{for(var c=0;c<b.length;c++){d.push("<tr><td>"+(c+1)+"</td>");d.push('<td><a href="'+a+".php?name="+b[c].name+'" target="_blank">'+b[c].name+"</a></td>");d.push("<td>"+b[c].value+"</td>");d.push("<td>"+b[c].increment+Utility.getHotUpDown(b[c].increment)+"</td></tr>")}}}return d.join("")},buildHotmap:function(buildId,buildData,buildType){var myChart=echarts.init(document.getElementById(buildId));myChart.hideLoading();var cdata=[];for(var y in buildData){if(buildType=="stock"){var tname=buildData[y].name;var tcode=buildData[y].code;var tvalue=buildData[y].value;var tpricelevel=buildData[y].price_level;var tstop=buildData[y].stop;if(tstop==1){cdata.push('{name:"'+tname+"\\n("+tcode+")\\n"+(tvalue>0?"+":"")+tvalue+'"')}else{cdata.push('{name:"'+tname+"\\n("+tcode+")\\n"+(tvalue>0?"+":"")+tvalue+'"')}cdata.push("value:"+buildData[y].count);cdata.push("itemStyle:{normal:{color:'"+Utility.getTreeMapColor(tpricelevel)+"'}}");if(tpricelevel==-1){cdata.push("label:{normal:{textStyle:{color:'#23a64c'}}}}")}else{if(tpricelevel==1){cdata.push("label:{normal:{textStyle:{color:'#f54545'}}}}")}else{cdata.push("label:{normal:{textStyle:{color:'#fff'}}}}")}}}else{var tsvalue=buildData[y].value;cdata.push('{name:"'+buildData[y].name+"\\n"+(tsvalue>0?"+":"")+tsvalue+'"');cdata.push("value:"+buildData[y].count);cdata.push("itemStyle:{normal:{color:'"+Utility.getTreeMapColor(buildData[y].price_level)+"'}}");if(buildData[y].price_level==-1){cdata.push("label:{normal:{textStyle:{color:'#23a64c'}}}}")}else{if(buildData[y].price_level==1){cdata.push("label:{normal:{textStyle:{color:'#f54545'}}}}")}else{cdata.push("label:{normal:{textStyle:{color:'#fff'}}}}")}}}}myChart.setOption({tooltip:{formatter:"{b}"},series:[{type:"treemap",breadcrumb:{show:false},roam:false,nodeClick:"link",width:"100%",height:"100%",itemStyle:{normal:{borderWidth:1}},data:eval("["+cdata.join(",")+"]")}]});window.onresize=myChart.resize},initRelateSHG:function(b,a){common.getRelateSHG({query_type:b,key_name:a},function(){$(".relate-infos").html('关联资讯<i class="fa fa-circle-o-notch fa-spin fa-fw"></i>')},function(c){if(c.status==1){var f=[];if(c.industry.length>0){f.push("<span>关联行业&nbsp;:&nbsp;</span>");for(var d in c.industry){f.push("<a href='industry.php?name="+c.industry[d].industry+"' target='_blank'>"+c.industry[d].industry+"</a>")}}if(c.stock.length>0){f.push("<span>关联股票&nbsp;:&nbsp;</span>");for(var e in c.stock){f.push("<a href='stocks.php?stock="+c.stock[e].stock_code+"' target='_blank'>"+c.stock[e].stock_name+"</a>")}}if(c.notion.length>0){f.push("<span>关联概念&nbsp;:&nbsp;</span>");for(var g in c.notion){f.push("<a href='concept.php?name="+c.notion[g].section+"' target='_blank'>"+c.notion[g].section+"</a>")}}$(".relate-infos").html("关联资讯"+f.join(""))}})},getUpDownColor:function(a){return a>0?"wk-red":a<0?"wk-green":"wk-gray"},getLoading:function(){var a=[];a.push('<div id="loading">');a.push('		<div id="loading-center">');a.push('			<div id="loading-center-absolute">');a.push('				<div class="object"></div>');a.push('				<div class="object"></div>');a.push('				<div class="object"></div>');a.push('				<div class="object"></div>');a.push('				<div class="object"></div>');a.push('				<div class="object"></div>');a.push('				<div class="object"></div>');a.push('				<div class="object"></div>');a.push('				<div class="object"></div>');a.push('				<div class="object"></div>');a.push("			</div>");a.push("		</div>");a.push("	</div>");return a.join("")},hideLoading:function(){$("#loading").remove()}};